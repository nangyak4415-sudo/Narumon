<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NARUMON | Next-Gen HR Intelligence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;500;700;900&family=Prompt:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- นำเข้า Chart.js สำหรับวาดกราฟ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* =========================================
           0. CORE VARIABLES & RESET
           ========================================= */
        :root {
            /* Default (Galaxy) Theme Variables */
            --color-bg: #03030a;
            --color-primary: #00f3ff;
            --color-secondary: #bc13fe;
            --color-success: #00ffa3;
            --color-warning: #ffb800;
            --color-danger: #ff4d4d;
            --color-text: #ffffff;
            --color-text-muted: rgba(255, 255, 255, 0.7);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.12);
            --dropdown-bg: #0a0c1a;
            --font-main: 'Inter', 'Prompt', sans-serif;
            --font-display: 'Orbitron', sans-serif;
            --easing: cubic-bezier(0.23, 1, 0.32, 1);
            --accent-glow: rgba(0, 243, 255, 0.5);
            --panel-width: 340px;
        }

        /* --- THEME OVERRIDES --- */
        body.theme-forest {
            --color-bg: #051a0a;
            --color-primary: #4ade80; /* Emerald */
            --color-secondary: #facc15; /* Sunlight */
            --color-success: #22c55e;
            --color-warning: #ea580c;
            --dropdown-bg: #022c0c;
            --glass-bg: rgba(20, 83, 45, 0.15);
            --glass-border: rgba(74, 222, 128, 0.2);
            --accent-glow: rgba(74, 222, 128, 0.5);
        }

        body.theme-ocean {
            --color-bg: #020b1a;
            --color-primary: #38bdf8; /* Sky Blue */
            --color-secondary: #818cf8; /* Indigo */
            --color-success: #2dd4bf; /* Teal */
            --color-warning: #fbbf24;
            --dropdown-bg: #082f49;
            --glass-bg: rgba(56, 189, 248, 0.1);
            --glass-border: rgba(56, 189, 248, 0.2);
            --accent-glow: rgba(56, 189, 248, 0.5);
        }

        /* NEW THEME: FUTURE CITY */
        body.theme-futurecity {
            --color-bg: #0a0e17; /* Dark Graphite */
            --color-primary: #00f3ff; /* Electric Blue */
            --color-secondary: #bd00ff; /* Soft Purple */
            --color-success: #00ff9d;
            --color-warning: #ffbe0c;
            --dropdown-bg: #111625;
            --glass-bg: rgba(0, 243, 255, 0.05);
            --glass-border: rgba(0, 243, 255, 0.3);
            --accent-glow: rgba(0, 243, 255, 0.7);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-font-smoothing: antialiased; }
        body { background-color: var(--color-bg); color: var(--color-text); font-family: var(--font-main); overflow-x: hidden; width: 100vw; min-height: 100vh; transition: background-color 0.8s var(--easing); }

        /* =========================================
           1. THEME ENGINE LAYERS
           ========================================= */
        #theme-background-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
            background: radial-gradient(circle at center, transparent 0%, var(--color-bg) 95%);
            transition: background 0.8s ease;
        }
        
        body.theme-futurecity #theme-background-layer {
            background: linear-gradient(to bottom, #05070a 0%, #1a2035 100%);
        }

        #theme-particle-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1; pointer-events: none;
        }

        #app-root {
            position: relative; z-index: 10;
            width: 100%; min-height: 100vh;
        }

        .vignette { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, transparent 0%, var(--color-bg) 95%); z-index: 2; pointer-events: none; transition: background 0.8s ease; }
        .grid-overlay { position: fixed; bottom: -20%; left: -50%; width: 200%; height: 100%; background-image: linear-gradient(rgba(0, 243, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px); background-size: 100px 100px; transform: perspective(500px) rotateX(60deg); z-index: 2; opacity: 0.15; animation: gridMove 20s linear infinite; pointer-events: none; }
        @keyframes gridMove { 0% { transform: perspective(500px) rotateX(60deg) translateY(0); } 100% { transform: perspective(500px) rotateX(60deg) translateY(100px); } }

        body.theme-forest .grid-overlay { background-image: linear-gradient(rgba(74, 222, 128, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(74, 222, 128, 0.05) 1px, transparent 1px); }
        body.theme-ocean .grid-overlay { background-image: linear-gradient(rgba(56, 189, 248, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(56, 189, 248, 0.05) 1px, transparent 1px); }
        body.theme-futurecity .grid-overlay { 
            background-image: linear-gradient(rgba(189, 0, 255, 0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(0, 243, 255, 0.05) 1px, transparent 1px); 
            opacity: 0.2;
        }

        /* =========================================
           2. NAVIGATION BAR
           ========================================= */
        .navbar { position: fixed; top: 0; left: 0; width: 100%; height: 90px; display: flex; justify-content: space-between; align-items: center; padding: 0 40px; z-index: 100; background: rgba(5, 5, 16, 0.8); backdrop-filter: blur(20px); border-bottom: 1px solid var(--glass-border); transition: all 0.4s var(--easing); }
        body.theme-forest .navbar { background: rgba(5, 26, 10, 0.8); }
        body.theme-ocean .navbar { background: rgba(2, 11, 26, 0.8); }
        body.theme-futurecity .navbar { background: rgba(10, 14, 23, 0.9); border-bottom: 1px solid rgba(0, 243, 255, 0.2); }

        .logo-container { display: flex; align-items: center; cursor: pointer; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .logo-container:hover { transform: scale(1.05); }
        .logo-text { display: flex; flex-direction: column; align-items: flex-start; justify-content: center; }
        .logo-title { font-family: var(--font-display); font-weight: 700; font-size: 22px; letter-spacing: 2px; background: linear-gradient(90deg, #fff, var(--color-primary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1; }
        .logo-subtitle { font-size: 10px; letter-spacing: 3px; color: var(--color-primary); font-weight: 500; margin-top: 5px; text-transform: uppercase; line-height: 1; }

        .nav-links { display: flex; gap: 40px; list-style: none; align-items: center; }
        .nav-item a { text-decoration: none; color: var(--color-text-muted); font-size: 15px; font-weight: 600; letter-spacing: 1.5px; text-transform: uppercase; position: relative; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); cursor: pointer; padding: 8px 0; }
        .nav-item a:hover, .nav-item.active a { color: #fff; text-shadow: 0 0 12px rgba(255, 255, 255, 0.5); }
        .nav-item a::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0%; height: 2px; background: var(--color-primary); box-shadow: 0 0 10px var(--color-primary); transition: width 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .nav-item a:hover::after, .nav-item.active a::after { width: 100%; }

        .theme-toggle-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--color-text);
            width: 40px; height: 40px;
            border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            transition: all 0.3s var(--easing);
            font-size: 1.2rem;
            margin-left: 10px;
        }
        .theme-toggle-btn:hover {
            border-color: var(--color-primary);
            box-shadow: 0 0 15px var(--accent-glow);
            transform: scale(1.05);
        }

        .lang-toggle-btn {
            background: transparent;
            border: 1px solid var(--glass-border);
            color: var(--color-text);
            width: 40px; height: 40px;
            border-radius: 8px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            transition: all 0.3s var(--easing);
            font-size: 1rem; font-weight: 700; font-family: var(--font-display);
        }
        .lang-toggle-btn:hover {
            border-color: var(--color-primary);
            box-shadow: 0 0 15px var(--accent-glow);
            transform: scale(1.05);
        }

        /* =========================================
           3. THEME PANEL
           ========================================= */
        .theme-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4);
            z-index: 998;
            opacity: 0; pointer-events: none;
            transition: opacity 0.35s ease;
        }
        .theme-overlay.open { opacity: 1; pointer-events: all; }

        .theme-panel {
            position: fixed; top: 0; right: -340px;
            width: var(--panel-width); height: 100%;
            background: var(--dropdown-bg);
            backdrop-filter: blur(30px);
            border-left: 1px solid var(--glass-border);
            z-index: 999;
            transition: right 0.35s cubic-bezier(0.16, 1, 0.3, 1);
            padding: 40px 30px;
            display: flex; flex-direction: column;
            box-shadow: -10px 0 40px rgba(0,0,0,0.5);
        }
        .theme-panel.open { right: 0; }

        .panel-header { margin-bottom: 40px; border-bottom: 1px solid var(--glass-border); padding-bottom: 20px; }
        .panel-title { font-family: var(--font-display); font-size: 1.5rem; color: #fff; margin-bottom: 8px; }
        .panel-subtitle { font-size: 0.85rem; color: var(--color-text-muted); }

        .theme-option {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .theme-option:hover { background: rgba(255,255,255,0.06); }
        .theme-option.active { border-color: var(--color-primary); background: rgba(255,255,255,0.08); box-shadow: 0 0 20px var(--glass-bg); }
        .theme-option.active::before {
            content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 4px; background: var(--color-primary);
        }

        .theme-preview {
            height: 60px;
            border-radius: 8px;
            margin-bottom: 12px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .preview-galaxy { background: linear-gradient(135deg, #03030a, #1a0b2e); }
        .preview-forest { background: linear-gradient(135deg, #051a0a, #0f3d1b); }
        .preview-ocean  { background: linear-gradient(135deg, #020b1a, #0c2e4e); }
        .preview-futurecity { background: linear-gradient(135deg, #0a0e17, #2d1b4e); }

        .theme-name { font-weight: 600; color: #fff; display: block; margin-bottom: 4px; }
        .theme-desc { font-size: 0.75rem; color: var(--color-text-muted); }
        .panel-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--glass-border); font-size: 0.75rem; color: var(--color-text-muted); text-align: center; }

        /* =========================================
           4. MAIN CONTENT
           ========================================= */
        main { position: relative; z-index: 10; width: 100%; padding: 120px 20px 80px; max-width: 1400px; margin: 0 auto; display: none; }
        #home-page { height: 100vh; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        
        /* NEW: LED Flow Effect for Hero Texts (Orange, Blue, White) */
        .hero-main-title { 
            font-family: var(--font-display); font-size: clamp(3rem, 15vw, 8rem); font-weight: 900; line-height: 1; letter-spacing: -2px; position: relative; 
            background: linear-gradient(to right, #ff6a00, #0066ff, #ffffff, #ff6a00);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 3s linear infinite;
            filter: drop-shadow(0 0 20px rgba(255, 106, 0, 0.4));
            -webkit-text-stroke: 1px rgba(255,255,255,0.1);
        }
        
        .hero-role {
            font-family: var(--font-display); font-size: clamp(1.5rem, 4vw, 2.5rem); font-weight: 700; letter-spacing: 8px; text-transform: uppercase; margin-top: 10px; display: block;
            background: linear-gradient(to right, #ffffff, #ff6a00, #0066ff, #ffffff);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 3.5s linear infinite;
            filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.4));
        }
        
        .hero-subtitle { 
            font-family: var(--font-display); font-size: clamp(1rem, 3vw, 1.5rem); letter-spacing: 12px; text-transform: uppercase; margin-top: 15px; display: block; 
            background: linear-gradient(to right, #0066ff, #ffffff, #ff6a00, #0066ff);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 4.5s linear infinite;
            filter: drop-shadow(0 0 10px rgba(0, 102, 255, 0.4));
        }
        
        .hero-org-name { 
            font-family: var(--font-display); font-size: clamp(1rem, 2.5vw, 1.4rem); letter-spacing: 3px; text-transform: uppercase; margin: 25px 0 30px; display: block; 
            background: linear-gradient(to right, #ff6a00, #0066ff, #ffffff, #ff6a00);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 6s linear infinite;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.3));
        }

        .cta-container { display: flex; gap: 24px; margin-top: 40px; }
        .btn { padding: 16px 40px; font-family: var(--font-main); font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; border: none; cursor: pointer; border-radius: 4px; transition: 0.3s; }
        .btn-primary { background: linear-gradient(90deg, var(--color-primary), var(--color-secondary)); color: #fff; }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 0 30px rgba(0, 243, 255, 0.4); }

        /* =========================================
           5. DASHBOARD CENTER PAGE
           ========================================= */
        #dashboard-center-page { 
            max-width: 1000px; 
            padding-top: 140px; 
            margin: 0 auto; 
            text-align: center; 
        }
        .dc-title { 
            font-family: var(--font-display); 
            font-size: 3.5rem; 
            font-weight: 900; 
            margin-bottom: 12px; 
            letter-spacing: 2px; 
            
            /* Multi-Color LED Effect (Flow Right) */
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff, #bc13fe);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 3s linear infinite;
            filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.5));
        }
        .dc-subtitle { 
            font-size: 1.15rem; 
            font-weight: 600; 
            margin-bottom: 50px; 
            
            /* Multi-Color LED Effect for Subtitle (Flow Right) */
            background: linear-gradient(to right, #00ffa3, #00f3ff, #bc13fe, #ffb800, #00ffa3, #00f3ff);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 4.5s linear infinite;
            filter: drop-shadow(0 0 8px rgba(0, 243, 255, 0.3));
        }

        .dc-cards-container { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 40px; 
            width: 100%;
        }

        /* อนิเมชั่นไฟ LED หมุน */
        @keyframes spinLED {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .dc-card {
            width: 100%; 
            max-width: 800px; /* ทำให้การ์ดยาว(กว้าง)ขึ้น */
            min-height: 180px; /* ทำให้การ์ดสูงขึ้น */
            background: rgba(10, 15, 30, 0.8);
            border-radius: 24px;
            padding: 40px 50px;
            display: flex; 
            align-items: center; 
            gap: 40px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), 0 0 20px rgba(0, 102, 255, 0.15), 0 0 20px rgba(255, 106, 0, 0.1);
            position: relative;
            overflow: hidden;
            text-align: left;
            opacity: 0;
            transform: translateY(30px);
            z-index: 1;
        }
        .dc-card.animate { opacity: 1; transform: translateY(0); }

        /* ชั้นที่ 1: แสง Multi-color วิ่งจากซ้ายไปขวา */
        .dc-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff);
            background-size: 200% auto;
            animation: textLedFlowRight 5s linear infinite;
            border-radius: 24px;
            z-index: -2;
            opacity: 0.6; /* เพิ่มระดับแสงฐาน */
            transition: opacity 0.4s ease, filter 0.4s ease;
        }

        /* ชั้นที่ 2: กรอบกระจกสีเข้มบังตรงกลางไว้ให้เห็นแค่ขอบไฟ */
        .dc-card::after {
            content: '';
            position: absolute;
            inset: 2px; /* ความหนาของเส้นไฟขอบ */
            background: linear-gradient(145deg, #0a0f1e, #111a30);
            border-radius: 22px;
            z-index: -1;
        }

        /* ดันเนื้อหา (ข้อความ/ตัวเลข) ให้อยู่ชั้นบนสุด */
        .dc-card > * {
            position: relative;
            z-index: 2;
        }

        /* เอฟเฟกต์ตอน Hover (สว่างขึ้น, ขอบเรืองแสงและวิ่งเร็วขึ้น) */
        .dc-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0,0,0,0.9), 0 0 60px rgba(0, 102, 255, 0.6), 0 0 60px rgba(255, 106, 0, 0.6), 0 0 80px rgba(255, 255, 255, 0.3);
        }
        .dc-card:hover::before { 
            opacity: 1;
            filter: blur(8px) brightness(1.5); /* เรืองแสงทะลุกรอบมากขึ้น 3 ระดับ */
            animation: textLedFlowRight 2s linear infinite; 
        }

        /* ตกแต่งฟอนต์เรืองแสง (01, 02, 03) ให้มีสีวิ่ง */
        .dc-card-number {
            font-family: var(--font-display);
            font-size: 4.5rem; /* ขยายตัวเลข */
            font-weight: 900;
            
            /* Multi-Color LED Effect (Flow Right) */
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff);
            background-size: 300% auto; /* ขยายความกว้างสีให้ไล่เฉดเนียนขึ้น */
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 4s linear infinite;
            
            -webkit-text-stroke: 1px rgba(255, 255, 255, 0.2);
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            min-width: 100px;
            padding-right: 12px; /* เพิ่ม Padding ป้องกันขอบสีแหว่ง/ขาดตรงขวาตัวเลข */
            filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.5));
        }
        .dc-card:hover .dc-card-number { 
            -webkit-text-stroke: 2px rgba(255, 255, 255, 0.9);
            filter: drop-shadow(0 0 20px #00f3ff) drop-shadow(0 0 40px #bc13fe) drop-shadow(0 0 60px #ffffff); 
            animation-duration: 1.5s; /* วิ่งเร็วขึ้นเมื่อ Hover */
            transform: scale(1.1) rotate(-5deg); /* เพิ่มลูกเล่นตอน Hover ให้เลขเด้ง */
        }

        .dc-card-content h3 { 
            font-family: var(--font-display);
            font-size: 1.8rem; 
            color: #fff; 
            margin-bottom: 12px; 
            font-weight: 700; 
            letter-spacing: 1px;
            text-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
            transition: 0.4s;
        }
        .dc-card:hover .dc-card-content h3 {
            color: #ffffff;
            text-shadow: 0 0 25px #0066ff, 0 0 50px #ff6a00, 0 0 70px rgba(255,255,255,0.8);
        }

        .dc-card-content p { 
            font-size: 1.1rem; 
            color: rgba(255, 255, 255, 0.7); 
            line-height: 1.6; 
            margin: 0; 
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.1);
        }

        /* NEW: Badge for Coming Soon in Dashboard Center */
        .dc-card-badge {
            position: absolute;
            top: 24px;
            right: 24px;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            background: rgba(189, 0, 255, 0.15);
            color: #d8b4fe;
            border: 1px solid rgba(189, 0, 255, 0.3);
            box-shadow: 0 0 15px rgba(189, 0, 255, 0.2);
            z-index: 10;
        }

        /* REPORTS LIST (UPDATED DESIGN) */
        #reports-page { max-width: 1000px; margin: 0 auto; }
        .reports-header { text-align: center; margin-bottom: 64px; }
        .reports-title { 
            font-family: var(--font-display); 
            font-size: clamp(2.5rem, 5vw, 4rem); 
            font-weight: 900; 
            margin-bottom: 16px; 
            
            /* Multi-Color LED Effect (Flow Right) */
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff, #bc13fe);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 3s linear infinite;
            filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.5));
        }
        .reports-subtitle { 
            font-size: 1.15rem; 
            font-weight: 600; 
            
            /* Multi-Color LED Effect for Subtitle (Flow Right) */
            background: linear-gradient(to right, #00ffa3, #00f3ff, #bc13fe, #ffb800, #00ffa3, #00f3ff);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 4.5s linear infinite;
            filter: drop-shadow(0 0 8px rgba(0, 243, 255, 0.3));
        }
        
        .reports-list { display: flex; flex-direction: column; align-items: center; gap: 32px; width: 100%; }
        
        .report-card { 
            width: 100%;
            max-width: 900px; /* ทำให้การ์ดยาวขึ้น */
            min-height: 160px; /* ทำให้การ์ดสูงขึ้น */
            background: rgba(10, 15, 30, 0.8); 
            border-radius: 24px; 
            padding: 32px 40px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            opacity: 0; 
            transform: translateY(30px);
            position: relative; 
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5);
            z-index: 1;
        }
        .report-card.animate { opacity: 1; transform: translateY(0); }
        
        /* ชั้นที่ 1: แสง Multi-color วิ่งจากซ้ายไปขวา */
        .report-card::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff);
            background-size: 200% auto;
            animation: textLedFlowRight 5s linear infinite;
            border-radius: 24px;
            z-index: -2;
            opacity: 0.6; /* เพิ่มระดับแสงฐาน */
            transition: opacity 0.4s ease, filter 0.4s ease;
        }
        
        /* ชั้นที่ 2: กรอบกระจกสีเข้มบังตรงกลางไว้ */
        .report-card::after {
            content: '';
            position: absolute;
            inset: 2px;
            background: linear-gradient(145deg, #0a0f1e, #111a30);
            border-radius: 22px;
            z-index: -1;
        }

        /* ดันเนื้อหาให้อยู่บนสุด */
        .report-card > * { position: relative; z-index: 2; }

        /* เอฟเฟกต์ตอน Hover */
        .report-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 25px 50px rgba(0,0,0,0.9), 0 0 60px rgba(0, 102, 255, 0.6), 0 0 60px rgba(255, 106, 0, 0.6), 0 0 80px rgba(255, 255, 255, 0.3); }
        .report-card:hover::before {
            opacity: 1;
            filter: blur(8px) brightness(1.5); /* เรืองแสงทะลุกรอบมากขึ้น 3 ระดับ */
            animation: textLedFlowRight 2s linear infinite; 
        }
        
        .report-info { display: flex; align-items: center; gap: 32px; flex: 1; }
        
        /* ตกแต่งฟอนต์เรืองแสงใน Report ให้มีสีวิ่ง */
        .report-number { 
            font-family: var(--font-display); 
            font-size: 3.5rem; 
            font-weight: 900; 
            
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff);
            background-size: 300% auto; /* ขยายความกว้างสีให้ไล่เฉดเนียนขึ้น */
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 4s linear infinite;
            
            -webkit-text-stroke: 1px rgba(255, 255, 255, 0.2);
            margin-right: 15px; 
            min-width: 80px; 
            padding-right: 12px; /* เพิ่ม Padding ป้องกันขอบสีแหว่ง/ขาดตรงขวาตัวเลข */
            text-align: center;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 0 15px rgba(0, 243, 255, 0.5));
        }
        .report-card:hover .report-number { 
            -webkit-text-stroke: 2px rgba(255, 255, 255, 0.9);
            filter: drop-shadow(0 0 20px #00f3ff) drop-shadow(0 0 40px #bc13fe) drop-shadow(0 0 60px #ffffff);
            animation-duration: 1.5s;
            transform: scale(1.1) rotate(-5deg);
        }

        .report-icon { 
            width: 60px; height: 60px; 
            background: rgba(0, 243, 255, 0.05); 
            border: 1px solid rgba(0, 243, 255, 0.3); 
            border-radius: 16px; 
            display: flex; align-items: center; justify-content: center; 
            color: var(--color-primary); 
            font-size: 1.8rem;
            transition: 0.4s;
            box-shadow: 0 0 25px rgba(0, 243, 255, 0.2);
        }
        .report-card:hover .report-icon {
            background: linear-gradient(135deg, #0066ff, #ff6a00); color: #fff; box-shadow: 0 0 40px rgba(0, 102, 255, 0.8), 0 0 40px rgba(255, 106, 0, 0.8), inset 0 0 20px rgba(255,255,255,0.6); transform: scale(1.1) rotate(5deg); border-color: transparent;
        }

        .report-text-group { display: flex; flex-direction: column; gap: 6px; }

        .report-name { 
            font-family: var(--font-display); font-size: 1.5rem; font-weight: 700; color: #fff; 
            transition: 0.4s; letter-spacing: 1px; text-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
        }
        .report-card:hover .report-name {
            color: #ffffff; text-shadow: 0 0 25px #0066ff, 0 0 50px #ff6a00, 0 0 70px rgba(255,255,255,0.8);
        }

        .report-desc { font-size: 1rem; color: rgba(255, 255, 255, 0.7); text-shadow: 0 0 5px rgba(255, 255, 255, 0.1); }

        .status-badge {
            position: absolute; top: 32px; right: 32px; padding: 8px 16px; border-radius: 20px;
            font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
            display: flex; align-items: center; gap: 8px;
            backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); pointer-events: none; z-index: 3;
        }
        .status-active { background: rgba(0, 255, 163, 0.15); color: var(--color-success); border-color: rgba(0, 255, 163, 0.4); box-shadow: 0 0 20px rgba(0, 255, 163, 0.2); }
        .status-draft { background: rgba(255, 184, 0, 0.15); color: var(--color-warning); border-color: rgba(255, 184, 0, 0.4); box-shadow: 0 0 20px rgba(255, 184, 0, 0.2); }
        .status-coming { background: rgba(189, 0, 255, 0.15); color: #d8b4fe; border-color: rgba(189, 0, 255, 0.4); box-shadow: 0 0 20px rgba(189, 0, 255, 0.2); }
        .status-dot { width: 8px; height: 8px; background: currentColor; border-radius: 50%; box-shadow: 0 0 10px currentColor; }

        /* --- DASHBOARD STYLES (SHARED) --- */
        .db-header-row { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 40px; }
        .db-title-group h1 { font-size: 2.25rem; font-weight: 700; color: #fff; margin-bottom: 8px; }
        .db-title-group p { font-size: 1.1rem; color: var(--color-text-muted); font-weight: 300; }
        .btn-back-link { background: transparent; border: 1px solid var(--glass-border); color: var(--color-text-muted); padding: 8px 16px; border-radius: 8px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 8px; }
        .btn-back-link:hover { color: #fff; border-color: var(--color-primary); background: rgba(255,255,255,0.05); }

        /* POLISHED KPI CARDS (GLOW & LED EFFECT) */
        .kpi-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; margin-bottom: 56px; }
        .kpi-block { 
            background: rgba(5, 10, 20, 0.6); 
            backdrop-filter: blur(32px); 
            border: 1px solid var(--accent-glow); 
            border-radius: 16px; 
            padding: 32px; 
            border-top: 4px solid var(--accent);
            animation: fadeUp 0.8s var(--easing) forwards;
            opacity: 0;
            box-shadow: 0 0 20px var(--accent-glow), inset 0 0 15px rgba(255,255,255,0.02); 
            position: relative;
            overflow: hidden;
            transition: all 0.4s var(--easing);
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left;
        }
        .kpi-block::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: skewX(-20deg); animation: shine 4s infinite; pointer-events: none;
        }
        @keyframes shine { 0% { left: -100%; } 20% { left: 200%; } 100% { left: 200%; } }
        
        .kpi-block:hover { 
            transform: translateY(-5px); 
            background: rgba(10, 15, 30, 0.8); 
            box-shadow: 0 0 40px var(--accent), inset 0 0 20px var(--accent-glow); 
            border-color: var(--accent);
        }
        
        .kpi-value { 
            font-size: 5rem; 
            font-weight: 900; 
            font-family: var(--font-display); 
            color: #fff; 
            line-height: 1; 
            margin-bottom: 12px;
            text-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent-glow); 
            letter-spacing: -2px; 
        }
        .kpi-label { 
            font-size: 1.25rem; 
            color: #fff; 
            font-weight: 700; 
            font-family: var(--font-display);
            letter-spacing: 1px;
            text-shadow: 0 0 10px var(--accent-glow);
            margin-bottom: 16px;
        }

        .kpi-block[data-type="total"] { --accent: var(--color-primary); --accent-glow: rgba(0, 243, 255, 0.4); }
        .kpi-block[data-type="rates"] { --accent: var(--color-secondary); --accent-glow: rgba(188, 19, 254, 0.4); }
        .kpi-block[data-type="hired"] { --accent: var(--color-success); --accent-glow: rgba(0, 255, 163, 0.4); justify-content: flex-start; }
        .kpi-block[data-type="delayed"] { --accent: var(--color-warning); --accent-glow: rgba(255, 184, 0, 0.4); }

        .kpi-block[data-type="hired"] .kpi-label { margin-bottom: 24px; color: #fff; }

        /* STATUS CARD LIST DESIGN */
        .kpi-list-container { display: flex; flex-direction: column; width: 100%; }
        .kpi-list-row { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .kpi-list-row:not(:last-child) { padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); margin-bottom: 12px; }
        .kpi-list-left { display: flex; align-items: center; gap: 12px; }
        .kpi-dot { width: 10px; height: 10px; border-radius: 50%; display: block; box-shadow: 0 0 10px currentColor; }
        .dot-success { background-color: var(--color-success); color: var(--color-success); }
        .dot-waiting { background-color: var(--color-primary); color: var(--color-primary); }
        .dot-missing { background-color: var(--color-danger); color: var(--color-danger); }
        
        .kpi-list-label { font-size: 1.05rem; color: #fff; font-weight: 600; font-family: var(--font-display); letter-spacing: 0.5px; text-shadow: 0 0 8px rgba(255,255,255,0.3); }
        .kpi-list-value { font-size: 2rem; font-weight: 900; font-family: var(--font-display); color: #fff; line-height: 1; }
        .val-success { text-shadow: 0 0 15px var(--color-success); }
        .val-waiting { text-shadow: 0 0 15px var(--color-primary); }
        .val-missing { color: var(--color-danger); text-shadow: 0 0 20px var(--color-danger); }

        /* FILTERS - POLISHED */
        .filter-wrap { 
            background: var(--dropdown-bg); 
            padding: 24px 40px; 
            border-radius: 24px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            margin-bottom: 64px; 
            display: flex; gap: 40px; align-items: center; justify-content: flex-start; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.4); 
        }
        .filter-item { display: flex; flex-direction: column; gap: 8px; }
        .filter-item label { font-size: 0.85rem; color: rgba(255,255,255,0.7); font-weight: 500; letter-spacing: 0.5px; text-transform: uppercase; }
        .filter-control { 
            background: rgba(255,255,255,0.03); 
            border: 1px solid var(--glass-border); 
            color: #fff; 
            padding: 12px 40px 12px 20px; 
            border-radius: 12px; 
            font-family: var(--font-main); 
            outline: none; cursor: pointer; transition: 0.3s; 
            min-width: 260px; font-size: 0.95rem; font-weight: 500;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.5)' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }
        .filter-control option { background-color: var(--dropdown-bg); color: #fff; padding: 12px; }
        .filter-control:hover { border-color: rgba(255,255,255,0.3); background-color: rgba(255,255,255,0.05); }
        .filter-control:focus { border-color: var(--color-primary); box-shadow: 0 0 0 2px rgba(0, 243, 255, 0.2); }

        /* MONTH HEADER - GLOWING TEXT */
        .month-container, .section-month { margin-bottom: 56px; animation: fadeUp 0.6s var(--easing) forwards; opacity: 0; }
        .month-title-row, .month-header { 
            font-size: 1.8rem; 
            font-weight: 900; 
            color: #fff; 
            margin-bottom: 24px; 
            padding-bottom: 8px;
            display: flex; align-items: center; gap: 20px; 
            text-transform: uppercase; letter-spacing: 3px;
            font-family: var(--font-display);
            text-shadow: 0 0 15px var(--color-primary), 0 0 30px var(--color-primary);
        }
        .month-title-row::after, .month-header::after { 
            content: ''; flex-grow: 1; height: 2px; 
            background: linear-gradient(90deg, var(--color-primary), transparent); 
            box-shadow: 0 0 10px var(--color-primary);
        }
        
        .job-grid-view, .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: 24px; }
        
        /* WORKFORCE POSITION CARD (LED BORDER EFFECT) */
        .work-card { 
            --led-color: var(--color-primary);
            --led-glow: rgba(0, 243, 255, 0.2);
            background: rgba(5, 10, 20, 0.5); 
            backdrop-filter: blur(15px); 
            border: 1px solid var(--led-glow); 
            border-radius: 20px; 
            padding: 28px; 
            position: relative; 
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            animation: fadeUp 0.6s var(--easing) forwards; 
            opacity: 0; 
            display: flex; flex-direction: column;
            box-shadow: 0 0 15px var(--led-glow), inset 0 0 10px var(--led-glow);
        }
        .work-card:hover { 
            transform: translateY(-8px) scale(1.02); 
            border-color: var(--led-color); 
            background: rgba(10, 15, 30, 0.8); 
            box-shadow: 0 0 30px var(--led-color), inset 0 0 20px var(--led-glow), 0 20px 40px rgba(0, 0, 0, 0.8); 
            z-index: 10;
        }
        .job-badge { position: absolute; top: 24px; right: 24px; padding: 6px 14px; border-radius: 12px; font-size: 0.8rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 6px; box-shadow: 0 0 10px currentColor; }
        .badge-pending { background: rgba(245, 158, 11, 0.2); color: var(--color-warning); border: 1px solid var(--color-warning); }
        .badge-hired { background: rgba(16, 185, 129, 0.2); color: var(--color-success); border: 1px solid var(--color-success); }
        .badge-progress { background: rgba(0, 243, 255, 0.2); color: var(--color-primary); border: 1px solid var(--color-primary); }
        .badge-delayed { background: rgba(255, 77, 77, 0.2); color: var(--color-danger); border: 1px solid var(--color-danger); }
        .badge-notstarted { background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.8); border: 1px solid rgba(255, 255, 255, 0.4); box-shadow: none; }
        
        .job-header-text { 
            font-size: 1.4rem; 
            font-weight: 800; 
            color: #fff; 
            margin-bottom: 16px; 
            line-height: 1.4; 
            padding-right: 110px; 
            min-height: 3.6em;
            font-family: var(--font-display);
            text-shadow: 0 0 15px var(--led-color);
            letter-spacing: 0.5px;
        }
        .meta-line { font-size: 0.9rem; color: var(--color-text-muted); margin-bottom: 8px; display: flex; align-items: center; gap: 10px; }
        .card-bottom { margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.08); display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; text-align: center; }
        .footer-col { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .footer-label { font-size: 0.75rem; color: rgba(255,255,255,0.6); margin-bottom: 4px; font-weight: 500; }
        .footer-value { font-size: 1.25rem; font-weight: 700; color: #fff; }
        .val-p-rate { color: var(--color-primary); }
        .val-p-hired { color: var(--color-success); }
        .val-p-missing { color: var(--color-warning); }

        /* BENEFIT SMART TASK DASHBOARD STYLES */
        .alert-box { 
            padding: 16px 24px; border-radius: 12px; margin-bottom: 24px; 
            font-weight: 600; font-family: var(--font-main);
            display: flex; align-items: center; gap: 12px; 
            animation: fadeUp 0.5s var(--easing) forwards; 
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .alert-danger { background: rgba(255, 77, 77, 0.15); border: 1px solid rgba(255, 77, 77, 0.4); color: #ff4d4d; }
        .alert-success { background: rgba(0, 255, 163, 0.15); border: 1px solid rgba(0, 255, 163, 0.4); color: var(--color-success); }
        .alert-warning { background: rgba(255, 184, 0, 0.15); border: 1px solid rgba(255, 184, 0, 0.4); color: var(--color-warning); margin-top: 12px; }
        
        /* KPI Glow Effects */
        @keyframes textGradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        #bn-kpi-total-tasks, #bn-kpi-completed, #bn-kpi-progress, #bn-kpi-pending,
        #sl-kpi-total-tasks, #sl-kpi-completed, #sl-kpi-progress, #sl-kpi-pending,
        #wl-kpi-total-tasks, #wl-kpi-completed, #wl-kpi-progress, #wl-kpi-pending {
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textGradientShift 4s ease-in-out infinite;
            font-weight: 900;
        }
        #bn-kpi-total-tasks, #sl-kpi-total-tasks, #wl-kpi-total-tasks { background-image: linear-gradient(90deg, #ffffff, #00f3ff, #ffffff); text-shadow: 0 0 20px rgba(0,243,255,0.3); }
        #bn-kpi-completed, #sl-kpi-completed, #wl-kpi-completed { background-image: linear-gradient(90deg, #00ffa3, #00b373, #00ffa3); text-shadow: 0 0 20px rgba(0,255,163,0.3); }
        #bn-kpi-progress, #sl-kpi-progress, #wl-kpi-progress { background-image: linear-gradient(90deg, #ffb800, #ff8c00, #ffb800); text-shadow: 0 0 20px rgba(255,184,0,0.3); }
        #bn-kpi-pending, #sl-kpi-pending, #wl-kpi-pending { background-image: linear-gradient(90deg, #ff4d4d, #ff1a1a, #ff4d4d); text-shadow: 0 0 20px rgba(255,77,77,0.3); }

        /* Neon Pulse Animations */
        @keyframes neonPulseRed {
            0%, 100% { box-shadow: 0 0 8px rgba(255, 77, 77, 0.3), inset 0 0 8px rgba(255, 77, 77, 0.1); border-color: rgba(255, 77, 77, 0.5); text-shadow: 0 0 8px rgba(255, 77, 77, 0.5); }
            50% { box-shadow: 0 0 16px rgba(255, 77, 77, 0.6), inset 0 0 12px rgba(255, 77, 77, 0.2); border-color: rgba(255, 77, 77, 1); text-shadow: 0 0 15px rgba(255, 77, 77, 0.8); }
        }
        @keyframes neonPulseGreen {
            0%, 100% { box-shadow: 0 0 8px rgba(0, 255, 163, 0.3), inset 0 0 8px rgba(0, 255, 163, 0.1); border-color: rgba(0, 255, 163, 0.5); text-shadow: 0 0 8px rgba(0, 255, 163, 0.5); }
            50% { box-shadow: 0 0 16px rgba(0, 255, 163, 0.6), inset 0 0 12px rgba(0, 255, 163, 0.2); border-color: rgba(0, 255, 163, 1); text-shadow: 0 0 15px rgba(0, 255, 163, 0.8); }
        }
        @keyframes neonPulseYellow {
            0%, 100% { box-shadow: 0 0 8px rgba(255, 184, 0, 0.3), inset 0 0 8px rgba(255, 184, 0, 0.1); border-color: rgba(255, 184, 0, 0.5); text-shadow: 0 0 8px rgba(255, 184, 0, 0.5); }
            50% { box-shadow: 0 0 16px rgba(255, 184, 0, 0.6), inset 0 0 12px rgba(255, 184, 0, 0.2); border-color: rgba(255, 184, 0, 1); text-shadow: 0 0 15px rgba(255, 184, 0, 0.8); }
        }

        /* Animated Chart Colors Effect */
        @keyframes chartColorFlow {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }
        .chart-flow-colors {
            animation: chartColorFlow 5s linear infinite;
        }

        /* =========================================
           MANAGEMENT PAGE STYLES
           ========================================= */
        @keyframes textLedFlowRight {
            0% { background-position: 200% center; }
            100% { background-position: 0% center; }
        }

        #management-page { max-width: 1400px; padding-top: 140px; margin: 0 auto; text-align: center; }
        .mgmt-header { margin-bottom: 40px; animation: fadeUp 0.6s var(--easing) forwards; opacity: 0; }
        
        .mgmt-title { 
            font-family: var(--font-display); 
            font-size: 3.5rem; 
            font-weight: 900; 
            margin-bottom: 12px; 
            letter-spacing: 2px; 
            
            /* Multi-Color LED Effect (Flow Right) */
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff, #bc13fe);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 3s linear infinite;
            filter: drop-shadow(0 0 10px rgba(0, 243, 255, 0.4));
        }
        
        .mgmt-subtitle { 
            font-size: 1.15rem; 
            font-weight: 600;
            
            /* Multi-Color LED Effect for Subtitle (Flow Right) */
            background: linear-gradient(to right, #00ffa3, #00f3ff, #bc13fe, #ffb800, #00ffa3, #00f3ff);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textLedFlowRight 4s linear infinite;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.2));
            margin-top: 8px;
        }
        
        .mgmt-controls-card { 
            background: rgba(10, 15, 30, 0.8); backdrop-filter: blur(24px); 
            border: 1px solid var(--glass-border); border-radius: 20px; 
            padding: 32px 40px; margin-bottom: 32px; 
            display: flex; gap: 24px; align-items: flex-end; 
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,243,255,0.05); 
            text-align: left;
            animation: fadeUp 0.8s var(--easing) forwards; opacity: 0;
        }
        
        .mgmt-iframe-container { 
            width: 100%; height: 80vh; min-height: 600px; 
            background: #fff; border-radius: 20px; overflow: hidden; 
            border: 1px solid var(--color-primary); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.6), 0 0 30px var(--accent-glow); 
            display: none; opacity: 0; transform: translateY(20px); 
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            position: relative;
            flex-direction: column;
        }
        .mgmt-iframe-container.show { display: flex; opacity: 1; transform: translateY(0); }
        
        .mgmt-iframe-header {
            display: flex; justify-content: space-between; align-items: center; 
            padding: 14px 24px; background: #0a0f1e; 
            border-bottom: 1px solid rgba(0,243,255,0.2);
        }
        .mgmt-iframe-title {
            color: #fff; font-family: var(--font-display); font-weight: 700; font-size: 1.1rem;
            display: flex; align-items: center; gap: 10px;
        }
        .mgmt-btn-close {
            background: rgba(255, 77, 77, 0.1); color: #ff4d4d; 
            border: 1px solid rgba(255, 77, 77, 0.3); padding: 8px 16px; 
            border-radius: 8px; cursor: pointer; font-family: var(--font-main); 
            font-weight: 600; transition: 0.3s;
            display: flex; align-items: center; gap: 6px; font-size: 0.9rem;
        }
        .mgmt-btn-close:hover {
            background: #ff4d4d; color: #fff; transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 77, 77, 0.4);
        }
        .mgmt-iframe { width: 100%; flex: 1; border: none; }

        /* =========================================
           MANAGEMENT SELECTOR ENHANCEMENTS
           ========================================= */
        .mgmt-select-label {
            font-size: 1.15rem;
            color: var(--color-primary);
            margin-bottom: 12px;
            display: block;
            font-family: var(--font-display);
            font-weight: 700;
            letter-spacing: 0.5px;
            text-shadow: 0 0 15px rgba(0, 243, 255, 0.4);
        }
        
        /* NEW: กรอบไฟวิ่ง 3 สี (ส้ม น้ำเงิน ขาว) */
        .mgmt-select-glow-wrap {
            position: relative;
            width: 100%;
            border-radius: 14px;
            padding: 3px; /* ความหนาของเส้นขอบ */
            background-image: linear-gradient(90deg, #ff6a00, #00f3ff, #ffffff, #ff6a00);
            background-size: 200% auto;
            animation: textGradientShift 3s linear infinite; /* แอนิเมชันวิ่งสลับไปมา */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5), 0 0 15px rgba(0, 243, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .mgmt-select-glow-wrap:hover {
            transform: translateY(-3px) scale(1.01);
            /* แสง Glow กระจายตัวตอน Hover เป็นสีส้มและฟ้า */
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6), 0 0 30px rgba(255, 106, 0, 0.4), 0 0 30px rgba(0, 243, 255, 0.4);
            animation-duration: 1.2s; /* วิ่งเร็วขึ้นเมื่อนำเมาส์ชี้ */
        }
        
        .mgmt-select-enhanced {
            width: 100%;
            height: 100%;
            display: block;
            background: #0a0f1e; /* สีพื้นทึบสนิทให้ตัดกับกรอบเรืองแสง */
            border: none; /* เอาเส้นขอบเดิมออก ใช้กรอบจาก Wrap แทน */
            color: #fff;
            font-size: 1.1rem;
            font-family: var(--font-main);
            font-weight: 600;
            padding: 14px 20px;
            border-radius: 11px; /* โค้งพอดีกับกรอบนอก */
            box-shadow: inset 0 0 20px rgba(0, 243, 255, 0.05);
            transition: all 0.3s ease;
            cursor: pointer;
            appearance: none; 
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300f3ff' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 18px center;
            background-size: 22px;
        }
        
        .mgmt-select-enhanced:focus {
            outline: none;
            box-shadow: inset 0 0 20px rgba(255, 106, 0, 0.15); /* แสงเงาด้านในเปลี่ยนสีตอนกดเลือก */
        }
        
        /* NEW: อนิเมชันสีข้อความสลับ 3 สี (ส้ม ฟ้า ขาว) สำหรับ Placeholder */
        @keyframes selectTextGlowFlow {
            0% { color: #ff6a00; text-shadow: 0 0 10px rgba(255, 106, 0, 0.8); }
            33% { color: #00f3ff; text-shadow: 0 0 10px rgba(0, 243, 255, 0.8); }
            66% { color: #ffffff; text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); }
            100% { color: #ff6a00; text-shadow: 0 0 10px rgba(255, 106, 0, 0.8); }
        }
        
        /* นำคลาสนี้ไปใช้เพื่อให้ตัวอักษรวิ่ง 3 สี */
        .text-flow-animated {
            animation: selectTextGlowFlow 3s linear infinite;
        }

        /* =========================================
           CUSTOM PREMIUM DROPDOWN (แก้ปัญหา Option เปลี่ยนสีไม่ได้)
           ========================================= */
        .custom-select-wrapper { position: relative; width: 100%; height: 100%; }
        
        .custom-select-trigger {
            width: 100%; height: 100%; display: flex; align-items: center;
            background: #0a0f1e; color: #fff; font-size: 1.1rem; font-family: var(--font-main); font-weight: 600;
            padding: 14px 20px; border-radius: 11px; box-shadow: inset 0 0 20px rgba(0, 243, 255, 0.05);
            cursor: pointer; position: relative; user-select: none;
        }
        
        .custom-select-trigger::after {
            content: ''; position: absolute; right: 18px; width: 22px; height: 22px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300f3ff' stroke-width='2.5' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: center; transition: 0.3s;
        }
        
        .custom-select-wrapper.open .custom-select-trigger::after { transform: rotate(180deg); }
        
        .custom-select-options {
            position: absolute; top: calc(100% + 12px); left: 0; width: 100%;
            background: rgba(10, 15, 30, 0.95); backdrop-filter: blur(16px);
            border: 1px solid var(--color-primary); border-radius: 12px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.8), 0 0 20px rgba(0,243,255,0.2);
            z-index: 100; display: none; flex-direction: column; overflow: hidden;
            max-height: 380px; overflow-y: auto;
        }
        
        .custom-select-wrapper.open .custom-select-options {
            display: flex; animation: fadeUp 0.3s ease forwards;
        }
        
        .custom-option {
            padding: 16px 20px; cursor: pointer; border-bottom: 1px solid rgba(255,255,255,0.05);
            font-weight: 700; font-family: var(--font-main); transition: 0.2s; font-size: 1.05rem;
        }
        
        .custom-option:hover { background: rgba(0, 243, 255, 0.15); padding-left: 28px; }
        .custom-option:last-child { border-bottom: none; }
        
        /* สไตล์ Scrollbar สำหรับ Dropdown */
        .custom-select-options::-webkit-scrollbar { width: 6px; }
        .custom-select-options::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 10px; }
        
        .mgmt-select-enhanced { display: none; /* ซ่อน Select เดิมไว้ เพราะเราใช้ Custom UI แทน */ }

        /* Neon Pill Badges */
        .badge-neon {
            padding: 6px 16px; border-radius: 50px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 1px;
            background: rgba(0,0,0,0.3); backdrop-filter: blur(4px); display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease;
        }
        .badge-neon:hover { filter: brightness(1.2); box-shadow: 0 0 25px currentColor; }
        .badge-neon-completed { color: var(--color-success); animation: neonPulseGreen 4s infinite ease-in-out; }
        .badge-neon-progress { color: var(--color-warning); animation: neonPulseYellow 4s infinite ease-in-out; }
        .badge-neon-pending { color: var(--color-danger); animation: neonPulseRed 3.5s infinite ease-in-out; }

        /* Table & Scroll Styles */
        .benefit-table-wrap { 
            background: #050a14; /* เปลี่ยนเป็นสีทึบแทนเพื่อลดภาระการเรนเดอร์เบลอ */
            border: 1px solid var(--glass-border); border-radius: 16px; 
            overflow: hidden; box-shadow: 0 15px 40px rgba(0,0,0,0.4); 
            animation: fadeUp 0.8s var(--easing) forwards;
            transform: translate3d(0, 0, 0); /* บังคับใช้ GPU Acceleration */
            -webkit-transform: translate3d(0, 0, 0);
        }
        
        /* SCROLL CONTAINER: Limits to ~10 items */
        .bn-table-scroll {
            max-height: 650px; 
            overflow-y: auto; overflow-x: auto;
            scroll-behavior: auto; /* ปิด smooth scroll ที่ทำให้หน่วงตอนเลื่อนเร็วๆ */
            -webkit-overflow-scrolling: touch;
            will-change: transform, scroll-position;
        }
        .bn-table-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .bn-table-scroll::-webkit-scrollbar-track { background: rgba(255,255,255,0.02); }
        .bn-table-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 10px; }
        .bn-table-scroll::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.3); }

        .benefit-table { width: 100%; border-collapse: collapse; text-align: left; }
        .benefit-table th { 
            background: #0a0f19; /* เปลี่ยนเป็นสีทึบ ปิด backdrop-filter */
            padding: 18px 24px; font-size: 0.85rem; font-weight: 700; color: rgba(255,255,255,0.6); 
            text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); position: sticky; top: 0; z-index: 10; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            will-change: transform;
        }
        .benefit-table td { 
            padding: 18px 24px; border-bottom: 1px solid rgba(255,255,255,0.03); 
            font-size: 0.95rem; color: #fff; font-weight: 500; 
            /* ตัด transition ออกเพื่อลดภาระ CPU เฟรมเรตตอนเลื่อน */
        }
        .benefit-table tr:hover td { background: rgba(255,255,255,0.03); }
        
        /* Pending Row Highlight */
        .row-pending { background: linear-gradient(90deg, rgba(255, 77, 77, 0.08) 0%, transparent 100%) !important; border-left: 3px solid var(--color-danger); }
        .row-pending:hover td { background: rgba(255, 77, 77, 0.05) !important; }

        .bn-progress-bar { display: flex; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 20px; background: rgba(255,255,255,0.1); width: 100%; box-shadow: inset 0 1px 3px rgba(0,0,0,0.3); }
        .bn-progress-segment { height: 100%; transition: width 0.8s var(--easing); }

        /* LOAN DASHBOARD STYLES (PREMIUM TYPOGRAPHY) */
        #loan-dashboard-page { font-family: 'Prompt', sans-serif; text-shadow: 0 0 4px rgba(255, 255, 255, 0.1); }
        #loan-dashboard-page .db-title-group h1 { 
            font-family: 'Prompt', sans-serif; 
            font-weight: 700; 
            background: linear-gradient(to right, #ffffff, #a5f3fc); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            text-shadow: 0 0 12px rgba(0, 243, 255, 0.3), 0 0 24px rgba(0, 243, 255, 0.1); 
            letter-spacing: 0.5px;
        }
        #loan-dashboard-page .db-title-group p { font-family: 'Prompt', sans-serif; font-weight: 300; letter-spacing: 0.5px; color: #94a3b8; text-shadow: 0 0 8px rgba(255, 255, 255, 0.15); }
        #loan-dashboard-page .filter-item label { font-family: 'Prompt', sans-serif; font-weight: 500; letter-spacing: 1px; color: #cbd5e1; text-shadow: 0 0 8px rgba(255, 255, 255, 0.15); }
        #loan-dashboard-page .filter-control { font-family: 'Prompt', sans-serif; font-weight: 500; color: #f8fafc; text-shadow: 0 0 5px rgba(255, 255, 255, 0.2); }
        #loan-dashboard-page .benefit-table th { font-family: 'Prompt', sans-serif; font-weight: 600; letter-spacing: 1px; color: #94a3b8; text-shadow: 0 0 8px rgba(255, 255, 255, 0.15); white-space: nowrap; }
        #loan-dashboard-page .benefit-table td { white-space: nowrap; }
        
        .loan-top-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 24px; margin-bottom: 40px; }
        .loan-hero-card { background: rgba(5, 10, 20, 0.6); backdrop-filter: blur(20px); border: 1px solid var(--color-primary); box-shadow: 0 0 30px rgba(0,243,255,0.2), inset 0 0 20px rgba(0,243,255,0.1); border-radius: 24px; padding: 40px; display: flex; flex-direction: column; justify-content: center; position: relative; overflow: hidden; animation: fadeUp 0.6s var(--easing) forwards; opacity: 0; }
        .loan-hero-card::after { content: ''; position: absolute; right: -50px; bottom: -50px; width: 250px; height: 250px; background: radial-gradient(circle, rgba(0,243,255,0.15) 0%, transparent 70%); border-radius: 50%; pointer-events: none; }
        
        .loan-hero-title { font-family: 'Prompt', sans-serif; font-size: 1.5rem; font-weight: 600; color: #e2e8f0; margin-bottom: 16px; opacity: 0.9; text-shadow: 0 0 12px rgba(255, 255, 255, 0.2), 0 0 20px rgba(0, 243, 255, 0.1); letter-spacing: 0.5px; }
        .loan-hero-value { font-family: 'Orbitron', sans-serif; font-size: clamp(3rem, 5vw, 4.5rem); font-weight: 900; background: linear-gradient(135deg, var(--color-primary) 0%, #ffffff 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 15px rgba(0, 243, 255, 0.4), 0 0 30px rgba(0, 243, 255, 0.15); line-height: 1; margin-bottom: 24px; letter-spacing: 2px; display: flex; align-items: baseline; gap: 8px; }
        .loan-hero-currency { font-family: 'Prompt', sans-serif; font-size: 1.5rem; font-weight: 600; -webkit-text-fill-color: rgba(255,255,255,0.7); text-shadow: 0 0 10px rgba(255, 255, 255, 0.2); letter-spacing: 0.5px; }
        .loan-hero-meta { display: flex; gap: 16px; font-size: 1rem; color: #f8fafc; font-weight: 500; font-family: 'Prompt', sans-serif; }
        .loan-hero-badge { padding: 6px 12px; background: rgba(0,243,255,0.1); border-radius: 8px; border: 1px solid rgba(0,243,255,0.3); color: var(--color-primary); box-shadow: inset 0 0 15px rgba(0,243,255,0.2); font-weight: 500; letter-spacing: 0.5px; text-shadow: 0 0 8px rgba(0, 243, 255, 0.3); }
        
        .loan-movement-grid { display: grid; grid-template-rows: repeat(3, 1fr); gap: 16px; animation: fadeUp 0.8s var(--easing) forwards; opacity: 0; }
        .loan-move-card { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 24px 32px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .loan-move-card:hover { background: rgba(255,255,255,0.05); border-color: rgba(255,255,255,0.2); transform: translateX(-5px); box-shadow: 0 5px 20px rgba(0,243,255,0.1); }
        
        .loan-move-title { font-family: 'Prompt', sans-serif; font-size: 1.05rem; color: #cbd5e1; font-weight: 500; letter-spacing: 0.5px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.2); }
        .loan-move-value { font-family: 'Orbitron', sans-serif; font-size: 2rem; font-weight: 800; letter-spacing: 1px; }
        .val-principal { color: transparent; background: linear-gradient(to right, var(--color-success), #a7f3d0); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 12px rgba(0, 255, 163, 0.4), 0 0 24px rgba(0, 255, 163, 0.1); }
        .val-interest { color: transparent; background: linear-gradient(to right, var(--color-warning), #fef08a); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 12px rgba(255, 184, 0, 0.4), 0 0 24px rgba(255, 184, 0, 0.1); }
        .val-disburse { color: transparent; background: linear-gradient(to right, var(--color-danger), #fecaca); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 12px rgba(255, 77, 77, 0.4), 0 0 24px rgba(255, 77, 77, 0.1); }

        .loan-chart-section { background: rgba(10, 15, 25, 0.8); border: 1px solid var(--glass-border); border-radius: 24px; padding: 32px; margin-bottom: 40px; box-shadow: 0 15px 40px rgba(0,0,0,0.4); animation: fadeUp 1s var(--easing) forwards; opacity: 0; }
        .loan-chart-title { font-family: 'Prompt', sans-serif; font-size: 1.25rem; font-weight: 600; color: #f8fafc; margin-bottom: 24px; display: flex; align-items: center; justify-content: space-between; letter-spacing: 0.5px; text-shadow: 0 0 12px rgba(255, 255, 255, 0.2), 0 0 20px rgba(0, 243, 255, 0.1); }
        .loan-chart-subtitle { font-family: 'Prompt', sans-serif; font-size: 0.85rem; font-weight: 300; color: #94a3b8; letter-spacing: 0.5px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.15); }
        
        /* CHART TYPE TOGGLE STYLES */
        .chart-type-toggle { display: flex; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 4px; border: 1px solid rgba(255,255,255,0.1); }
        .chart-toggle-btn { font-family: 'Prompt', sans-serif; font-weight: 500; background: transparent; border: none; color: rgba(255,255,255,0.7); padding: 6px 16px; font-size: 0.85rem; border-radius: 6px; cursor: pointer; transition: 0.3s; letter-spacing: 0.5px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.1); }
        .chart-toggle-btn:hover { color: #fff; background: rgba(255,255,255,0.1); text-shadow: 0 0 10px rgba(255, 255, 255, 0.3); }
        .chart-toggle-btn.active { background: var(--color-primary); color: #000; font-weight: 600; box-shadow: 0 0 15px rgba(0,243,255,0.4); text-shadow: none; }

        /* =========================================
           MUTUAL FUND DASHBOARD STYLES
           ========================================= */
        .kpi-grid-7 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        /* Animated LED Border for Cards */
        .mf-kpi-card {
            background: transparent;
            border-radius: 16px; padding: 20px;
            display: flex; flex-direction: column; justify-content: center;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 20px rgba(0,0,0,0.4), 0 0 15px var(--accent-glow, rgba(255,255,255,0.05));
            animation: fadeUp 0.6s var(--easing) forwards; opacity: 0;
            position: relative;
            overflow: hidden;
            z-index: 1;
            text-align: center;
        }
        .mf-kpi-card::before {
            content: ''; position: absolute; top: 50%; left: 50%;
            width: 150%; height: 300%;
            background: conic-gradient(from 0deg, transparent 70%, var(--accent) 90%, #fff 100%);
            transform-origin: center; animation: spinLED 3s linear infinite;
            z-index: -2; opacity: 0.6; transition: 0.4s;
        }
        .mf-kpi-card::after {
            content: ''; position: absolute; inset: 2px;
            background: linear-gradient(145deg, rgba(10,15,30,0.95), rgba(5,10,20,0.98));
            border-radius: 14px; z-index: -1;
        }
        .mf-kpi-card > * { position: relative; z-index: 2; }
        .mf-kpi-card:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 15px 30px rgba(0,0,0,0.6), 0 0 30px var(--accent); }
        .mf-kpi-card:hover::before { opacity: 1; animation-duration: 1.2s; background: conic-gradient(from 0deg, transparent 40%, var(--accent) 80%, #fff 100%); }
        
        .mf-kpi-label { font-size: 0.85rem; color: var(--color-text-muted); text-transform: uppercase; font-weight: 700; margin-bottom: 8px; font-family: var(--font-display); letter-spacing: 1px; }
        .mf-kpi-value { font-size: 2.2rem; font-weight: 900; font-family: var(--font-display); color: #fff; line-height: 1; text-shadow: 0 0 15px var(--accent-glow, rgba(255,255,255,0.4)); }
        
        /* Special Title Glow */
        .mf-title-glow {
            font-family: var(--font-display);
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(to right, #00f3ff, #bc13fe, #00ffa3, #ffb800, #00f3ff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textGradientShift 4s linear infinite;
            filter: drop-shadow(0 0 10px rgba(0, 243, 255, 0.5));
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        /* Flowing Value Color */
        .val-glow-flow {
            background-image: linear-gradient(90deg, #00f3ff, #bc13fe, #00ffa3, #ffb800, #00f3ff);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: textGradientShift 3s linear infinite;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.3));
        }

        .dash-row { display: grid; gap: 24px; margin-bottom: 24px; }
        .dash-row-1 { grid-template-columns: 2fr 1fr; }
        .dash-row-2 { grid-template-columns: 1fr 2fr; }
        .dash-row-3 { grid-template-columns: 1fr 1fr; }
        
        @media (max-width: 1024px) {
            .dash-row-1, .dash-row-2, .dash-row-3 { grid-template-columns: 1fr; }
        }

        .panel-box {
            background: rgba(10, 15, 25, 0.8); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 24px; position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            animation: fadeUp 0.8s var(--easing) forwards; opacity: 0;
        }
        .panel-title { font-size: 1.1rem; font-weight: 600; color: #fff; margin-bottom: 20px; display: flex; align-items: center; justify-content: space-between; font-family: var(--font-display); letter-spacing: 0.5px; }
        .chart-wrapper { position: relative; width: 100%; height: 280px; }

        .top-list { list-style: none; }
        .top-list li { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .top-list li:last-child { border-bottom: none; }
        .top-rank { background: rgba(0,243,255,0.1); color: var(--color-primary); width: 28px; height: 28px; display: inline-flex; justify-content: center; align-items: center; border-radius: 50%; font-size: 0.8rem; font-weight: 800; margin-right: 12px; border: 1px solid rgba(0,243,255,0.3); }
        .top-name { font-size: 0.95rem; flex-grow: 1; font-weight: 500; color: #e2e8f0; }
        .top-value { font-weight: 700; font-family: var(--font-display); color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.2); }

        .mf-alert-item { background: rgba(255,255,255,0.03); border-left: 3px solid var(--color-primary); padding: 14px 16px; border-radius: 8px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; }
        .mf-alert-item:hover { background: rgba(255,255,255,0.06); transform: translateX(5px); }
        .mf-alert-used { border-color: var(--color-success); background: rgba(0, 255, 163, 0.05); }

        @media (max-width: 1024px) {
            .loan-top-grid { grid-template-columns: 1fr; }
        }

        /* =========================================
           ABOUT US (EXECUTIVE HR VISION) REVAMP
           ========================================= */
        #about-page { max-width: 1200px; padding: 120px 20px 80px; }
        .about-section { margin-bottom: 80px; animation: fadeUp 0.8s var(--easing) forwards; opacity: 0; }
        
        .about-hero { text-align: center; margin-bottom: 100px; }
        .about-title { font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 900; font-family: var(--font-display); background: linear-gradient(90deg, var(--color-primary), #00ffa3); -webkit-background-clip: text; color: transparent; margin-bottom: 24px; text-shadow: 0 0 30px rgba(0, 243, 255, 0.3); }
        .about-subtitle { font-size: 1.25rem; font-weight: 400; color: #fff; line-height: 1.6; max-width: 800px; margin: 0 auto 32px; }
        .vision-statement { font-size: 1.5rem; font-weight: 600; color: var(--color-primary); font-style: italic; max-width: 900px; margin: 0 auto 48px; text-shadow: 0 0 15px rgba(0, 243, 255, 0.2); }
        
        .exec-message-box { background: rgba(255,255,255,0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); border-radius: 24px; padding: 48px; max-width: 900px; margin: 0 auto; box-shadow: 0 20px 40px rgba(0,0,0,0.3), inset 0 0 20px rgba(0,243,255,0.05); text-align: left; }
        .exec-message-box h3 { font-size: 1.8rem; font-family: var(--font-display); color: #fff; margin-bottom: 24px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 16px; }
        .exec-message-box p { font-size: 1.1rem; color: rgba(255,255,255,0.8); line-height: 1.8; margin-bottom: 16px; }
        .exec-list { list-style: none; margin-top: 24px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
        .exec-list li { font-size: 1.1rem; color: var(--color-success); font-weight: 600; display: flex; align-items: center; gap: 12px; }
        .exec-list li::before { content: '•'; color: var(--color-primary); font-size: 1.5rem; }

        .about-section-title { font-size: 2.25rem; font-family: var(--font-display); font-weight: 700; color: #fff; margin-bottom: 40px; text-align: center; text-transform: uppercase; letter-spacing: 2px; }
        .about-section-title::after { content: ''; display: block; width: 60px; height: 3px; background: var(--color-primary); margin: 16px auto 0; box-shadow: 0 0 10px var(--color-primary); }

        .pillars-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; }
        .pillar-card { background: rgba(5, 10, 20, 0.6); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 32px; flex: 1 1 300px; max-width: 380px; transition: all 0.3s ease; opacity: 0; transform: translateY(20px); }
        .pillar-card.animate { opacity: 1; transform: translateY(0); }
        .pillar-card:hover { transform: translateY(-8px); border-color: var(--color-primary); background: rgba(10, 15, 30, 0.8); box-shadow: 0 15px 30px rgba(0,0,0,0.5), inset 0 0 20px rgba(0,243,255,0.1); }
        .pillar-icon { font-size: 2.5rem; margin-bottom: 20px; color: var(--color-primary); text-shadow: 0 0 15px var(--color-primary); }
        .pillar-title { font-size: 1.3rem; font-weight: 700; color: #fff; margin-bottom: 16px; }
        .pillar-desc { font-size: 0.95rem; color: rgba(255,255,255,0.7); line-height: 1.6; list-style: none; }
        .pillar-desc li { margin-bottom: 8px; position: relative; padding-left: 20px; }
        .pillar-desc li::before { content: '›'; position: absolute; left: 0; color: var(--color-success); font-weight: bold; }

        .roadmap-container { display: flex; flex-direction: row; justify-content: space-between; position: relative; padding: 40px 0; gap: 24px; }
        .roadmap-container::before { content: ''; position: absolute; top: 70px; left: 50px; right: 50px; height: 2px; background: rgba(255,255,255,0.1); z-index: 1; }
        .roadmap-container::after { content: ''; position: absolute; top: 70px; left: 50px; width: 0; height: 2px; background: var(--color-primary); z-index: 2; box-shadow: 0 0 10px var(--color-primary); transition: width 2s ease; }
        .about-roadmap.animate .roadmap-container::after { width: calc(100% - 100px); }
        .roadmap-item { flex: 1; text-align: center; position: relative; z-index: 3; opacity: 0; transform: translateY(20px); }
        .roadmap-item.animate { opacity: 1; transform: translateY(0); }
        .roadmap-year { width: 60px; height: 60px; background: var(--color-bg); border: 2px solid var(--color-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: var(--font-display); font-weight: 700; color: #fff; margin: 0 auto 24px; box-shadow: 0 0 15px rgba(0,243,255,0.3); transition: 0.3s; }
        .roadmap-item:hover .roadmap-year { transform: scale(1.1); box-shadow: 0 0 25px var(--color-primary); background: rgba(0,243,255,0.1); }
        .roadmap-content { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.05); padding: 24px; border-radius: 16px; text-align: left; transition: 0.3s; }
        .roadmap-item:hover .roadmap-content { border-color: rgba(255,255,255,0.15); background: rgba(255,255,255,0.05); }
        .roadmap-title { font-size: 1.2rem; font-weight: 700; color: var(--color-primary); margin-bottom: 8px; }
        .roadmap-theme { font-size: 0.9rem; color: #fff; font-weight: 600; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .roadmap-list { list-style: none; font-size: 0.9rem; color: rgba(255,255,255,0.7); line-height: 1.6; margin-bottom: 16px; }
        .roadmap-list li { margin-bottom: 6px; }
        .roadmap-kpi { font-size: 0.85rem; color: var(--color-success); font-weight: 700; padding: 8px 12px; background: rgba(0,255,163,0.1); border-radius: 8px; display: inline-block; }

        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px; }
        .metric-card { background: rgba(255,255,255,0.02); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 32px 24px; text-align: center; transition: 0.3s; opacity: 0; transform: translateY(20px); }
        .metric-card.animate { opacity: 1; transform: translateY(0); }
        .metric-card:hover { border-color: rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); transform: translateY(-5px); }
        .metric-value { font-size: 3.5rem; font-family: var(--font-display); font-weight: 900; color: #fff; line-height: 1; margin-bottom: 12px; display: flex; align-items: baseline; justify-content: center; gap: 4px; }
        .metric-value span.unit { font-size: 1.5rem; color: var(--color-primary); }
        .metric-label { font-size: 0.9rem; color: rgba(255,255,255,0.6); font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }

        .commitment-section { text-align: center; background: radial-gradient(circle at center, rgba(0,243,255,0.05) 0%, transparent 70%); padding: 60px 0; border-radius: 32px; border: 1px solid rgba(255,255,255,0.05); }
        .commitment-text { font-size: 1.25rem; color: rgba(255,255,255,0.8); max-width: 800px; margin: 0 auto 40px; line-height: 1.8; }
        .commitment-keywords { display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; font-family: var(--font-display); font-size: 1.2rem; font-weight: 700; color: var(--color-primary); }
        .commitment-keywords span { position: relative; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        @media (max-width: 768px) {
            .navbar { padding: 0 20px; }
            .nav-links { display: none; }
            .kpi-row { grid-template-columns: 1fr; }
            .filter-wrap { flex-direction: column; border-radius: 24px; padding: 24px; align-items: stretch; gap: 20px; }
            .job-grid-view, .card-grid { grid-template-columns: 1fr; }
            .db-header-row { flex-direction: column-reverse; gap: 24px; }
            .theme-panel { width: 100%; right: -100%; }
            
            /* Responsive About Us */
            .roadmap-container { flex-direction: column; padding-left: 30px; }
            .roadmap-container::before { top: 0; bottom: 0; left: 30px; width: 2px; height: 100%; }
            .roadmap-container::after { top: 0; left: 30px; width: 2px; height: 0; transition: height 2s ease; }
            .about-roadmap.animate .roadmap-container::after { width: 2px; height: 100%; }
            .roadmap-item { text-align: left; padding-left: 50px; }
            .roadmap-year { margin: 0 0 16px 0; position: absolute; left: 0; top: 0; width: 40px; height: 40px; font-size: 0.9rem; }
        }
        
        /* Large Screen Optimization */
        @media (min-width: 1441px) {
            .kpi-row { gap: 40px; }
            .job-grid-view, .card-grid { gap: 40px; }
        }

        /* =========================================
           PASSWORD MODAL STYLES (CYBERPUNK ULTRA)
           ========================================= */
        .password-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);
            z-index: 2000; display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: opacity 0.4s ease;
        }
        .password-overlay.show { opacity: 1; pointer-events: auto; }
        
        .password-box {
            background: transparent;
            border-radius: 24px; padding: 45px 35px; width: 90%; max-width: 420px;
            text-align: center; transform: translateY(30px) scale(0.95); 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; overflow: hidden;
            z-index: 1;
            /* แอนิเมชันแสง Glow รอบการ์ดเปลี่ยนสีตามไฟวิ่ง */
            animation: modalGlowFlow 6s linear infinite;
        }

        @keyframes modalGlowFlow {
            0% { box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 40px rgba(0,243,255,0.3); }
            20% { box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 40px rgba(188,19,254,0.3); }
            40% { box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 40px rgba(255,184,0,0.3); }
            60% { box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 40px rgba(0,255,163,0.3); }
            80% { box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 40px rgba(255,77,77,0.3); }
            100% { box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 40px rgba(0,243,255,0.3); }
        }
        
        /* 1. ชั้นล่างสุด: แสงไฟวิ่งหลากสี (Multi-color Flow) */
        .password-box::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: conic-gradient(
                from 0deg,
                #00f3ff, #bc13fe, #ffb800, #00ffa3, #ff4d4d, #00f3ff
            );
            animation: spinLED 6s linear infinite;
            z-index: -2;
            opacity: 1; 
            transition: opacity 0.3s ease, background 0.3s ease;
        }

        @keyframes spinLED {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* 2. ชั้นกลาง: แผ่นทึบซ้อนทับให้เห็นเฉพาะเส้นขอบไฟ */
        .password-box::after {
            content: '';
            position: absolute;
            inset: 3px; /* ความหนาของกรอบไฟ */
            background: linear-gradient(145deg, #0a0e17, #050a14);
            border-radius: 21px;
            z-index: -1;
        }
        
        /* State Colors: เวลากรอกรหัสถูก/ผิด */
        .password-box.error-state { animation: shakeError 0.5s cubic-bezier(.36,.07,.19,.97) both; box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 50px rgba(255, 77, 79, 0.6); }
        .password-box.error-state::before { background: #ff4d4f; animation: none; }

        .password-box.success-state { animation: none; box-shadow: 0 20px 50px rgba(0,0,0,0.8), 0 0 50px rgba(0, 255, 163, 0.6); }
        .password-box.success-state::before { background: #00ffa3; animation: none; }

        @keyframes shakeError {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-6px, 0, 0); }
            40%, 60% { transform: translate3d(6px, 0, 0); }
        }

        .password-overlay.show .password-box { transform: translateY(0) scale(1); }
        
        .password-content { position: relative; z-index: 1; }
        
        /* ไอคอนกุญแจกระพริบ (Pulse Effect) */
        .password-icon { 
            font-size: 3.5rem; margin-bottom: 12px; 
            background: linear-gradient(45deg, #00f3ff, #bc13fe);
            -webkit-background-clip: text; color: transparent; background-clip: text;
            text-shadow: 0 0 20px rgba(0,243,255,0.5); 
            animation: iconPulse 2s ease-in-out infinite alternate;
        }
        @keyframes iconPulse {
            from { transform: scale(1); filter: drop-shadow(0 0 10px rgba(0,243,255,0.5)); }
            to { transform: scale(1.1); filter: drop-shadow(0 0 25px rgba(188,19,254,0.8)); }
        }
        
        /* ตกแต่งหัวข้อให้มีไฟวิ่งพาดผ่านตัวหนังสือ */
        .password-box h3 { 
            font-family: var(--font-display); margin-bottom: 8px; font-size: 1.8rem; 
            letter-spacing: 3px; font-weight: 900;
            background: linear-gradient(to right, #00f3ff, #bc13fe, #ffb800, #00ffa3, #00f3ff);
            background-size: 200% auto;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: textLedFlowRight 4s linear infinite;
            filter: drop-shadow(0 0 8px rgba(255,255,255,0.2));
        }
        .password-box p { color: var(--color-text-muted); font-size: 0.95rem; margin-bottom: 28px; font-weight: 400; letter-spacing: 0.5px; }
        
        .password-input-wrap { position: relative; margin-bottom: 24px; }

        /* ================= ช่องกรอกรหัสผ่านสุดล้ำ ================= */
        #mgmt-password-input {
            width: 100%; padding: 18px 50px 18px 20px; border-radius: 16px;
            background: rgba(0,0,0,0.8); 
            border: 2px solid transparent; /* ใช้ Gradient จาก Background แทนขอบปกติ */
            color: #fff;
            font-size: 1.8rem; text-align: center; 
            font-family: var(--font-display); 
            font-weight: 700; outline: none; transition: 0.3s; 
            letter-spacing: 12px; 
            box-shadow: inset 0 0 20px rgba(0,0,0,1);
            
            /* เทคนิคสร้างเส้นขอบ Gradient หมุน และตัวหนังสือเปลี่ยนสี */
            background-image: linear-gradient(rgba(5, 10, 20, 0.9), rgba(5, 10, 20, 0.9)), linear-gradient(90deg, #00f3ff, #bc13fe, #ffb800, #00ffa3, #00f3ff);
            background-origin: border-box; background-clip: padding-box, border-box;
            background-size: 100% 100%, 200% 100%;
            animation: inputBorderFlow 3s linear infinite, passwordTextGlow 4s linear infinite;
        }

        @keyframes inputBorderFlow {
            0% { background-position: 0% 0%, 200% 0%; }
            100% { background-position: 0% 0%, 0% 0%; }
        }
        
        /* ตัวหนังสือรหัสผ่านไล่เฉดสี Glow สลับไปมา */
        @keyframes passwordTextGlow {
            0% { color: #00f3ff; text-shadow: 0 0 15px rgba(0,243,255,0.8), 0 0 30px rgba(0,243,255,0.4); }
            25% { color: #bc13fe; text-shadow: 0 0 15px rgba(188,19,254,0.8), 0 0 30px rgba(188,19,254,0.4); }
            50% { color: #ffb800; text-shadow: 0 0 15px rgba(255,184,0,0.8), 0 0 30px rgba(255,184,0,0.4); }
            75% { color: #00ffa3; text-shadow: 0 0 15px rgba(0,255,163,0.8), 0 0 30px rgba(0,255,163,0.4); }
            100% { color: #00f3ff; text-shadow: 0 0 15px rgba(0,243,255,0.8), 0 0 30px rgba(0,243,255,0.4); }
        }

        #mgmt-password-input::placeholder {
            color: rgba(255,255,255,0.2); font-size: 1.1rem; letter-spacing: 4px;
            text-shadow: none; font-family: var(--font-display); font-weight: 500;
            animation: none;
        }
        #mgmt-password-input:focus { 
            box-shadow: inset 0 0 30px rgba(0,0,0,1), 0 0 30px rgba(0,243,255,0.3); 
            /* เร่งไฟกระพริบให้ไวขึ้นตอนจิ้มพิมพ์ */
            background-image: linear-gradient(rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.95)), linear-gradient(90deg, #00f3ff, #bc13fe, #ffb800, #00ffa3, #00f3ff);
            animation-duration: 1.5s, 2s; 
        }
        #mgmt-password-input:disabled { opacity: 0.7; cursor: not-allowed; animation: none; border-color: transparent; }
        
        .toggle-password-btn {
            position: absolute; right: 18px; top: 50%; transform: translateY(-50%);
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); 
            color: rgba(255,255,255,0.6); border-radius: 50%; width: 38px; height: 38px;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: 0.3s; outline: none; z-index: 5;
        }
        .toggle-password-btn:hover { color: #fff; background: var(--color-primary); border-color: var(--color-primary); box-shadow: 0 0 20px var(--color-primary); transform: translateY(-50%) scale(1.1); }

        .auth-msg { font-size: 1rem; height: 24px; margin-bottom: 25px; font-weight: 700; font-family: var(--font-main); letter-spacing: 1px; transition: 0.3s; }
        .auth-msg.error { color: #ff4d4f; text-shadow: 0 0 15px rgba(255,77,77,0.6); }
        .auth-msg.success { color: #00ffa3; text-shadow: 0 0 15px rgba(0,255,163,0.6); }

        /* ปุ่มกดยืนยัน (ไฟวิ่ง Gradient) */
        .password-actions { display: flex; flex-direction: column; gap: 12px; }
        .password-actions .btn-primary { 
            background: linear-gradient(90deg, #00f3ff, #bc13fe); background-size: 200% auto;
            color: #fff; border: none; width: 100%; padding: 18px; border-radius: 14px;
            font-weight: 800; font-family: var(--font-display); font-size: 1.2rem;
            cursor: pointer; transition: 0.4s; text-transform: uppercase; letter-spacing: 4px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: btnGradientFlow 3s linear infinite;
        }
        @keyframes btnGradientFlow { 0% { background-position: 0% center; } 100% { background-position: 200% center; } }
        
        .password-actions .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(188,19,254,0.5), 0 0 25px rgba(0,243,255,0.5); letter-spacing: 6px; }
        
        .password-actions .btn-secondary { 
            background: transparent; color: rgba(255,255,255,0.5); border: none; padding: 12px;
            cursor: pointer; transition: 0.3s; font-size: 0.95rem; font-family: var(--font-main); font-weight: 500;
        }
        .password-actions .btn-secondary:hover { color: #ff4d4f; text-shadow: 0 0 15px rgba(255,77,77,0.6); background: transparent; transform: scale(1.05); border: none; }

    </style>
</head>
<body>

    <!-- 1. THEME LAYERS -->
    <div id="theme-background-layer"></div>
    <canvas id="theme-particle-layer"></canvas>

    <!-- 2. APP ROOT -->
    <div id="app-root">
        
        <div class="vignette"></div>
        <div class="grid-overlay"></div>

        <!-- Navigation -->
        <nav class="navbar" id="navbar">
            <div class="logo-container" onclick="showPage('home')">
                <div class="logo-text">
                    <span class="logo-title">NARUMON</span>
                    <span class="logo-subtitle">HR Phetchaburi</span>
                </div>
            </div>
            <ul class="nav-links">
                <li class="nav-item active" id="nav-home"><a onclick="showPage('home')" class="i18n" data-th="HOME" data-en="HOME">HOME</a></li>
                <li class="nav-item" id="nav-dashboard-center"><a onclick="showPage('dashboard-center')" class="i18n" data-th="DASHBOARD" data-en="DASHBOARD">DASHBOARD</a></li>
                <li class="nav-item" id="nav-reports"><a onclick="showPage('reports')" class="i18n" data-th="REPORTS" data-en="REPORTS">REPORTS</a></li>
                <li class="nav-item" id="nav-management"><a onclick="showPage('management')" class="i18n" data-th="MANAGEMENT" data-en="MANAGEMENT">MANAGEMENT</a></li>
                <li class="nav-item" id="nav-about"><a onclick="showPage('about')" class="i18n" data-th="VISION" data-en="VISION">VISION</a></li>
                <li class="theme-toggle-li" style="display: flex; gap: 8px;">
                    <button class="lang-toggle-btn" id="lang-toggle-btn" onclick="toggleLanguage()">EN</button>
                    <button class="theme-toggle-btn" onclick="toggleThemePanel()">
                        ☰
                    </button>
                </li>
            </ul>
        </nav>

        <!-- Pages -->
        <main id="home-page" style="display: flex;">
            <h1 class="hero-main-title">NARUMON</h1>
            <span class="hero-role">SUPERVISOR</span>
            <span class="hero-subtitle">HR PHETCHABURI</span>
            <span class="hero-org-name">COMPACT INTERNATIONAL (1994) CO., LTD.</span>
            <div class="cta-container">
                <button class="btn btn-primary i18n" data-th="เข้าสู่ระบบแดชบอร์ด" data-en="Enter Dashboard Center" onclick="showPage('dashboard-center')">เข้าสู่ระบบแดชบอร์ด</button>
            </div>
        </main>

        <!-- DASHBOARD CENTER PAGE -->
        <main id="dashboard-center-page">
            <h1 class="dc-title">DASHBOARD CENTER</h1>
            <p class="dc-subtitle">Select a dashboard to view detailed information</p>
            
            <div class="dc-cards-container">
                <!-- Card 1: เงินกู้พนักงาน (UNLOCKED) -->
                <div class="dc-card animate" onclick="showPage('loan-dashboard')">
                    <div class="dc-card-badge status-active" style="background: rgba(0, 255, 163, 0.15); color: var(--color-success); border-color: rgba(0, 255, 163, 0.4);">ACTIVE</div>
                    <div class="dc-card-number">01</div>
                    <div class="dc-card-content">
                        <h3>เงินกู้พนักงาน</h3>
                        <p>ระบบจัดการและตรวจสอบสถานะเงินกู้สวัสดิการพนักงาน พร้อมสถิติการอนุมัติแบบเรียลไทม์</p>
                    </div>
                </div>
                
                <!-- ===== START WELFARE UPDATE (HTML CARD) ===== -->
                <!-- Card 2: สวัสดิการพนักงาน (UNLOCKED) -->
                <div class="dc-card animate" onclick="showPage('employee-welfare-dashboard')">
                    <div class="dc-card-badge status-active" style="background: rgba(0, 255, 163, 0.15); color: var(--color-success); border-color: rgba(0, 255, 163, 0.4);">ACTIVE</div>
                    <div class="dc-card-number">02</div>
                    <div class="dc-card-content">
                        <h3>สวัสดิการพนักงาน</h3>
                        <p>แดชบอร์ดติดตามข้อมูลการเบิกจ่ายงบประมาณด้านสวัสดิการและสิทธิประโยชน์พนักงาน</p>
                    </div>
                </div>
                <!-- ===== END WELFARE UPDATE (HTML CARD) ===== -->

                <!-- Card 3: เพื่อนช่วยเพื่อน (UNLOCKED) -->
                <div class="dc-card animate" onclick="showPage('mutual-fund-dashboard')">
                    <div class="dc-card-badge status-active" style="background: rgba(0, 255, 163, 0.15); color: var(--color-success); border-color: rgba(0, 255, 163, 0.4);">ACTIVE</div>
                    <div class="dc-card-number">03</div>
                    <div class="dc-card-content">
                        <h3>เพื่อนช่วยเพื่อน</h3>
                        <p>แดชบอร์ดจัดการกองทุนและสวัสดิการโครงการเพื่อนช่วยเพื่อน (Mutual Aid Fund)</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- ABOUT US (EXECUTIVE HR VISION) -->
        <main id="about-page">
            
            <!-- Section 1: Vision -->
            <section class="about-section about-hero animate">
                <h1 class="about-title i18n" data-th="Executive HR Vision 2025–2027" data-en="Executive HR Vision 2025–2027">Executive HR Vision 2025–2027</h1>
                <h2 class="about-subtitle i18n" data-th="ขับเคลื่อนองค์กรด้วยกลยุทธ์ HR Digital Transformation<br>เพื่อสร้าง People-Centric Organization ที่เติบโตอย่างยั่งยืน" data-en="Driving the organization with HR Digital Transformation<br>to build a sustainable People-Centric Organization">ขับเคลื่อนองค์กรด้วยกลยุทธ์ HR Digital Transformation<br>เพื่อสร้าง People-Centric Organization ที่เติบโตอย่างยั่งยืน</h2>
                <div class="vision-statement i18n" data-th="“ยกระดับระบบบริหารทรัพยากรบุคคลสู่แพลตฟอร์มดิจิทัลเต็มรูปแบบ ที่เชื่อมโยงข้อมูล บุคลากร และกลยุทธ์องค์กรเข้าด้วยกันอย่างชาญฉลาด”" data-en="“Elevating HR management to a fully digital platform that intelligently connects data, people, and corporate strategy.”">“ยกระดับระบบบริหารทรัพยากรบุคคลสู่แพลตฟอร์มดิจิทัลเต็มรูปแบบ ที่เชื่อมโยงข้อมูล บุคลากร และกลยุทธ์องค์กรเข้าด้วยกันอย่างชาญฉลาด”</div>
                
                <div class="exec-message-box">
                    <h3 class="i18n" data-th="Message from HR Leadership" data-en="Message from HR Leadership">Message from HR Leadership</h3>
                    <p class="i18n" data-th="ในยุคที่องค์กรต้องปรับตัวอย่างรวดเร็ว HR ไม่ใช่เพียงฝ่ายสนับสนุน แต่คือ Strategic Partner ที่ขับเคลื่อนประสิทธิภาพ วัฒนธรรม และการเติบโตขององค์กร" data-en="In an era of rapid organizational adaptation, HR is not merely a support function, but a Strategic Partner driving efficiency, culture, and organizational growth.">ในยุคที่องค์กรต้องปรับตัวอย่างรวดเร็ว HR ไม่ใช่เพียงฝ่ายสนับสนุน แต่คือ Strategic Partner ที่ขับเคลื่อนประสิทธิภาพ วัฒนธรรม และการเติบโตขององค์กร</p>
                    <p class="i18n" data-th="เรามุ่งมั่นพัฒนา HR Platform ที่:" data-en="We are committed to developing an HR Platform that is:">เรามุ่งมั่นพัฒนา HR Platform ที่:</p>
                    <ul class="exec-list">
                        <li class="i18n" data-th="โปร่งใส ตรวจสอบได้ทุกขั้นตอน" data-en="Transparent and verifiable in every step">โปร่งใส ตรวจสอบได้ทุกขั้นตอน</li>
                        <li class="i18n" data-th="วัดผลได้ ด้วย Data เชิงประจักษ์" data-en="Measurable with empirical Data">วัดผลได้ ด้วย Data เชิงประจักษ์</li>
                        <li class="i18n" data-th="ใช้งานง่าย ตอบโจทย์พนักงานทุกคน" data-en="User-friendly, meeting every employee's needs">ใช้งานง่าย ตอบโจทย์พนักงานทุกคน</li>
                        <li class="i18n" data-th="รองรับการขยายตัวในอนาคตอย่างมั่นคง" data-en="Scalable to support future growth stably">รองรับการขยายตัวในอนาคตอย่างมั่นคง</li>
                    </ul>
                </div>
            </section>

            <!-- Section 2: Framework -->
            <section class="about-section about-framework">
                <h2 class="about-section-title i18n" data-th="HR Digital Transformation Framework" data-en="HR Digital Transformation Framework">HR Digital Transformation Framework</h2>
                <div class="pillars-grid">
                    <div class="pillar-card animate">
                        <div class="pillar-icon">📊</div>
                        <h3 class="pillar-title i18n" data-th="1. Data-Driven HR" data-en="1. Data-Driven HR">1. Data-Driven HR</h3>
                        <ul class="pillar-desc">
                            <li class="i18n" data-th="รวมศูนย์ข้อมูลทั้งหมด (Single Source of Truth)" data-en="Centralize all data (Single Source of Truth)">รวมศูนย์ข้อมูลทั้งหมด (Single Source of Truth)</li>
                            <li>Real-Time Dashboard</li>
                            <li>HR Analytics & Predictive Insights</li>
                        </ul>
                    </div>
                    <div class="pillar-card animate">
                        <div class="pillar-icon">⚙️</div>
                        <h3 class="pillar-title i18n" data-th="2. Process Automation" data-en="2. Process Automation">2. Process Automation</h3>
                        <ul class="pillar-desc">
                            <li class="i18n" data-th="ลดงาน Manual เพิ่มความแม่นยำ" data-en="Reduce manual tasks, increase accuracy">ลดงาน Manual เพิ่มความแม่นยำ</li>
                            <li class="i18n" data-th="Workflow Approval อัตโนมัติ" data-en="Automated Workflow Approval">Workflow Approval อัตโนมัติ</li>
                            <li class="i18n" data-th="ลดระยะเวลาการดำเนินงานรวม" data-en="Reduce overall operational time">ลดระยะเวลาการดำเนินงานรวม</li>
                        </ul>
                    </div>
                    <div class="pillar-card animate">
                        <div class="pillar-icon">🎯</div>
                        <h3 class="pillar-title i18n" data-th="3. People Development" data-en="3. People Development">3. People Development</h3>
                        <ul class="pillar-desc">
                            <li>Competency Framework Design</li>
                            <li>Strategic KPI Tracking</li>
                            <li>Learning Management Integration</li>
                        </ul>
                    </div>
                    <div class="pillar-card animate">
                        <div class="pillar-icon">📱</div>
                        <h3 class="pillar-title i18n" data-th="4. Employee Experience" data-en="4. Employee Experience">4. Employee Experience</h3>
                        <ul class="pillar-desc">
                            <li>Self-Service Portal (ESS)</li>
                            <li>Mobile Friendly Access</li>
                            <li>Digital Engagement Tools</li>
                        </ul>
                    </div>
                    <div class="pillar-card animate">
                        <div class="pillar-icon">🛡️</div>
                        <h3 class="pillar-title i18n" data-th="5. Governance & Compliance" data-en="5. Governance & Compliance">5. Governance & Compliance</h3>
                        <ul class="pillar-desc">
                            <li>Secure Access Control</li>
                            <li>Comprehensive Audit Trail</li>
                            <li>Policy Transparency & Ethics</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 3: Roadmap -->
            <section class="about-section about-roadmap">
                <h2 class="about-section-title i18n" data-th="3-Year HR Strategic Roadmap" data-en="3-Year HR Strategic Roadmap">3-Year HR Strategic Roadmap</h2>
                <div class="roadmap-container">
                    <div class="roadmap-item animate">
                        <div class="roadmap-year">Y 1</div>
                        <div class="roadmap-content">
                            <h3 class="roadmap-title i18n" data-th="FOUNDATION" data-en="FOUNDATION">FOUNDATION</h3>
                            <div class="roadmap-theme i18n" data-th="Theme: Build the Core" data-en="Theme: Build the Core">Theme: Build the Core</div>
                            <ul class="roadmap-list">
                                <li class="i18n" data-th="พัฒนาระบบฐานข้อมูลกลาง (HRIS)" data-en="Develop centralized database (HRIS)">พัฒนาระบบฐานข้อมูลกลาง (HRIS)</li>
                                <li class="i18n" data-th="ปรับปรุงโครงสร้างข้อมูลทั่วองค์กร" data-en="Improve organization-wide data structure">ปรับปรุงโครงสร้างข้อมูลทั่วองค์กร</li>
                                <li class="i18n" data-th="ลดเอกสาร Manual 50%" data-en="Reduce manual documents by 50%">ลดเอกสาร Manual 50%</li>
                                <li class="i18n" data-th="เริ่มใช้งาน Executive Dashboard เบื้องต้น" data-en="Initial launch of Executive Dashboard">เริ่มใช้งาน Executive Dashboard เบื้องต้น</li>
                            </ul>
                            <div class="roadmap-kpi">KPI: System Adoption > 70%</div>
                        </div>
                    </div>
                    <div class="roadmap-item animate">
                        <div class="roadmap-year">Y 2</div>
                        <div class="roadmap-content">
                            <h3 class="roadmap-title i18n" data-th="INTEGRATION" data-en="INTEGRATION">INTEGRATION</h3>
                            <div class="roadmap-theme i18n" data-th="Theme: Connect & Optimize" data-en="Theme: Connect & Optimize">Theme: Connect & Optimize</div>
                            <ul class="roadmap-list">
                                <li class="i18n" data-th="เชื่อมต่อระบบประเมินผลออนไลน์" data-en="Connect online performance evaluation system">เชื่อมต่อระบบประเมินผลออนไลน์</li>
                                <li class="i18n" data-th="Automation Workflow เต็มรูปแบบ" data-en="Full automation workflow">Automation Workflow เต็มรูปแบบ</li>
                                <li class="i18n" data-th="HR Analytics เชิงลึกแบบ Real-time" data-en="In-depth Real-time HR Analytics">HR Analytics เชิงลึกแบบ Real-time</li>
                                <li class="i18n" data-th="เริ่มใช้ Data สำหรับวางแผนกำลังคน" data-en="Initiate data usage for workforce planning">เริ่มใช้ Data สำหรับวางแผนกำลังคน</li>
                            </ul>
                            <div class="roadmap-kpi i18n" data-th="KPI: Process Time ลดลง 30%" data-en="KPI: Process Time reduced by 30%">KPI: Process Time ลดลง 30%</div>
                        </div>
                    </div>
                    <div class="roadmap-item animate">
                        <div class="roadmap-year">Y 3</div>
                        <div class="roadmap-content">
                            <h3 class="roadmap-title i18n" data-th="INTELLIGENCE" data-en="INTELLIGENCE">INTELLIGENCE</h3>
                            <div class="roadmap-theme i18n" data-th="Theme: Predict & Grow" data-en="Theme: Predict & Grow">Theme: Predict & Grow</div>
                            <ul class="roadmap-list">
                                <li>Predictive HR Analytics System</li>
                                <li>Advanced Workforce Planning Model</li>
                                <li>Employee Experience Optimization</li>
                                <li class="i18n" data-th="รองรับ Multi-Branch / Multi-Unit สากล" data-en="Support Global Multi-Branch / Multi-Unit">รองรับ Multi-Branch / Multi-Unit สากล</li>
                            </ul>
                            <div class="roadmap-kpi">KPI: Employee Engagement +20%</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 4: Metrics Preview -->
            <section class="about-section about-metrics">
                <h2 class="about-section-title i18n" data-th="Strategic HR Metrics Overview" data-en="Strategic HR Metrics Overview">Strategic HR Metrics Overview</h2>
                <div class="metrics-grid">
                    <div class="metric-card animate">
                        <div class="metric-value"><span id="metric-growth">0</span><span class="unit">%</span></div>
                        <div class="metric-label">Employee Growth Rate</div>
                    </div>
                    <div class="metric-card animate">
                        <div class="metric-value"><span id="metric-retention">0</span><span class="unit">%</span></div>
                        <div class="metric-label">Retention Rate</div>
                    </div>
                    <div class="metric-card animate">
                        <div class="metric-value"><span id="metric-training">0</span><span class="unit">h</span></div>
                        <div class="metric-label">Training Hrs / Employee</div>
                    </div>
                    <div class="metric-card animate">
                        <div class="metric-value"><span id="metric-engagement">0</span><span class="unit">%</span></div>
                        <div class="metric-label">Engagement Score</div>
                    </div>
                    <div class="metric-card animate">
                        <div class="metric-value"><span id="metric-time">0</span><span class="unit">d</span></div>
                        <div class="metric-label">Time-to-Hire</div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Commitment -->
            <section class="about-section commitment-section animate">
                <h2 class="about-section-title i18n" data-th="Building the Future of HR" data-en="Building the Future of HR" style="border:none; margin-bottom:24px;">Building the Future of HR</h2>
                <p class="commitment-text i18n" data-th="เรามุ่งมั่นพัฒนา HR ให้เป็นศูนย์กลางข้อมูลเชิงกลยุทธ์ เพื่อสนับสนุนการตัดสินใจระดับผู้บริหาร และสร้างองค์กรที่พร้อมแข่งขันในระยะยาว ด้วยความเชื่อมั่นว่าบุคลากรคือทรัพยากรที่มีค่าที่สุด" data-en="We are committed to developing HR into a strategic data center to support executive decisions and build an organization ready for long-term competition, believing that our people are our most valuable asset.">เรามุ่งมั่นพัฒนา HR ให้เป็นศูนย์กลางข้อมูลเชิงกลยุทธ์ เพื่อสนับสนุนการตัดสินใจระดับผู้บริหาร และสร้างองค์กรที่พร้อมแข่งขันในระยะยาว ด้วยความเชื่อมั่นว่าบุคลากรคือทรัพยากรที่มีค่าที่สุด</p>
                <div class="commitment-keywords">
                    <span>Smart</span> <span>•</span> 
                    <span>Transparent</span> <span>•</span> 
                    <span>Agile</span> <span>•</span> 
                    <span>Sustainable</span>
                </div>
            </section>

        </main>

        <main id="reports-page">
            <header class="reports-header">
                <h1 class="reports-title i18n" data-th="ศูนย์รายงาน" data-en="Reports Center">ศูนย์รายงาน</h1>
                <p class="reports-subtitle i18n" data-th="เลือกรายงานเพื่อดูข้อมูลรายละเอียดและการวิเคราะห์" data-en="Select a report to view detailed information and analytics.">เลือกรายงานเพื่อดูข้อมูลรายละเอียดและการวิเคราะห์</p>
            </header>
            <section class="reports-list">
                <!-- Injected via renderReportsList() -->
            </section>
        </main>

        <!-- MANAGEMENT PAGE -->
        <main id="management-page">
            <div class="mgmt-header">
                <h1 class="mgmt-title i18n" data-th="DATA MANAGEMENT" data-en="DATA MANAGEMENT">DATA MANAGEMENT</h1>
                <p class="mgmt-subtitle i18n" data-th="เลือกฐานข้อมูลเพื่อดูและแก้ไขรายละเอียดได้โดยตรง" data-en="Select a sheet to view and edit detailed information directly">เลือกฐานข้อมูลเพื่อดูและแก้ไขรายละเอียดได้โดยตรง</p>
            </div>
            
            <div class="mgmt-controls-card">
                <div class="filter-item" style="flex: 1;">
                    <label class="i18n mgmt-select-label" data-th="✨ เลือกฐานข้อมูลที่ต้องการจัดการ" data-en="✨ Select Database to Manage">✨ เลือกฐานข้อมูลที่ต้องการจัดการ</label>
                    <div class="mgmt-select-glow-wrap">
                        
                        <!-- CUSTOM DROPDOWN UI แบบมีไฟวิ่ง 3 สี -->
                        <div class="custom-select-wrapper" id="custom-select-wrap">
                            <div class="custom-select-trigger text-flow-animated" id="custom-select-trigger" onclick="toggleCustomSelect()">
                                <span class="i18n" data-th="✨ -- กรุณาคลิกเพื่อเลือกฐานข้อมูล -- ✨" data-en="✨ -- Please click to select database -- ✨">✨ -- กรุณาคลิกเพื่อเลือกฐานข้อมูล -- ✨</span>
                            </div>
                            <div class="custom-select-options" id="custom-select-options">
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('', '✨ -- กรุณาคลิกเพื่อเลือกฐานข้อมูล -- ✨', '✨ -- Please click to select database -- ✨')">
                                    <span class="i18n" data-th="✨ -- กรุณาคลิกเพื่อเลือกฐานข้อมูล -- ✨" data-en="✨ -- Please click to select database -- ✨">✨ -- กรุณาคลิกเพื่อเลือกฐานข้อมูล -- ✨</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('1IgUh9g7kYsC2tIvg0AzE5wTqMq2HinlbEWjhGxRqFEk', '📊 1. แผนอัตรากำลังพลรับเพิ่ม ประจำปี 2569', '📊 1. Workforce Addition Plan 2026')">
                                    <span class="i18n" data-th="📊 1. แผนอัตรากำลังพลรับเพิ่ม ประจำปี 2569" data-en="📊 1. Workforce Addition Plan 2026">📊 1. แผนอัตรากำลังพลรับเพิ่ม ประจำปี 2569</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('1jGvSwO-ymtAo63NYbvK7o4raGijdQezm0Iu2IEXqIE8', '🎯 2. Recruiting (สรรหาบุคลากร)', '🎯 2. Recruiting Tracking')">
                                    <span class="i18n" data-th="🎯 2. Recruiting (สรรหาบุคลากร)" data-en="🎯 2. Recruiting Tracking">🎯 2. Recruiting (สรรหาบุคลากร)</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('1ONbPfC9QtiMrGGTmNktTRlMiUxhLsbaQi4GQVjH4e5g', '💰 3. ควบคุมงบประมาณด้านเงินเดือน', '💰 3. Salary Budget Control')">
                                    <span class="i18n" data-th="💰 3. ควบคุมงบประมาณด้านเงินเดือน" data-en="💰 3. Salary Budget Control">💰 3. ควบคุมงบประมาณด้านเงินเดือน</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('1yfzlrtgIW2eXbRXAQ_3pW2e6pzdpHxm4vRt-gbKhsEQ', '🏥 4. ควบคุมแผนงบประมาณด้านสวัสดิการ', '🏥 4. Welfare Budget Control')">
                                    <span class="i18n" data-th="🏥 4. ควบคุมแผนงบประมาณด้านสวัสดิการ" data-en="🏥 4. Welfare Budget Control">🏥 4. ควบคุมแผนงบประมาณด้านสวัสดิการ</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('152oYyJbd6_gdNAh8cvlD-Ozi4qkwa3LmbPTU0N3F4OA', '🎁 5. Benefit (สิทธิประโยชน์พนักงาน)', '🎁 5. Benefit Monitoring')">
                                    <span class="i18n" data-th="🎁 5. Benefit (สิทธิประโยชน์พนักงาน)" data-en="🎁 5. Benefit Monitoring">🎁 5. Benefit (สิทธิประโยชน์พนักงาน)</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('1GECHMYtklYNeWBybjFJcwKGT1PgG5dsAMzEQdsX6fmk', '💸 6. ข้อมูลเงินกู้พนักงาน', '💸 6. Employee Loan Status')">
                                    <span class="i18n" data-th="💸 6. ข้อมูลเงินกู้พนักงาน" data-en="💸 6. Employee Loan Status">💸 6. ข้อมูลเงินกู้พนักงาน</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('1hpF_YkbGEUvNNYPa1AO9Cmsf7Y0MMUwh1SPI4i0T7_Q', '🤝 7. เพื่อนช่วยเพื่อน', '🤝 7. Mutual Aid Fund')">
                                    <span class="i18n" data-th="🤝 7. เพื่อนช่วยเพื่อน" data-en="🤝 7. Mutual Aid Fund">🤝 7. เพื่อนช่วยเพื่อน</span>
                                </div>
                                <div class="custom-option text-flow-animated" onclick="selectCustomOption('1RxK5-yKujw4AXxBYYjXiNc3naNqEUWpvOA08YlG7dDc', '🏥 8. ข้อมูลสวัสดิการพนักงาน', '🏥 8. Employee Welfare Data')">
                                    <span class="i18n" data-th="🏥 8. ข้อมูลสวัสดิการพนักงาน" data-en="🏥 8. Employee Welfare Data">🏥 8. ข้อมูลสวัสดิการพนักงาน</span>
                                </div>
                            </div>
                        </div>

                        <!-- HIDDEN NATIVE SELECT (เก็บข้อมูลไปประมวลผลต่อ) -->
                        <select id="mgmt-sheet-select" class="mgmt-select-enhanced">
                            <option value="">-- กรุณาคลิกเพื่อเลือกฐานข้อมูล --</option>
                            <option value="1IgUh9g7kYsC2tIvg0AzE5wTqMq2HinlbEWjhGxRqFEk">1. แผนอัตรากำลังพลรับเพิ่ม ประจำปี 2569</option>
                            <option value="1jGvSwO-ymtAo63NYbvK7o4raGijdQezm0Iu2IEXqIE8">2. Recruiting (สรรหาบุคลากร)</option>
                            <option value="1ONbPfC9QtiMrGGTmNktTRlMiUxhLsbaQi4GQVjH4e5g">3. ควบคุมงบประมาณด้านเงินเดือน</option>
                            <option value="1yfzlrtgIW2eXbRXAQ_3pW2e6pzdpHxm4vRt-gbKhsEQ">4. ควบคุมแผนงบประมาณด้านสวัสดิการ</option>
                            <option value="152oYyJbd6_gdNAh8cvlD-Ozi4qkwa3LmbPTU0N3F4OA">5. Benefit (สิทธิประโยชน์พนักงาน)</option>
                            <option value="1GECHMYtklYNeWBybjFJcwKGT1PgG5dsAMzEQdsX6fmk">6. ข้อมูลเงินกู้พนักงาน</option>
                            <option value="1hpF_YkbGEUvNNYPa1AO9Cmsf7Y0MMUwh1SPI4i0T7_Q">7. เพื่อนช่วยเพื่อน</option>
                            <option value="1RxK5-yKujw4AXxBYYjXiNc3naNqEUWpvOA08YlG7dDc">8. ข้อมูลสวัสดิการพนักงาน</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" style="height: 52px; border-radius: 12px; display: flex; align-items: center; gap: 8px; font-size: 1.05rem;" onclick="loadManagementSheet()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>
                    <span class="i18n" data-th="เปิดแก้ไขข้อมูล" data-en="Open Editor">เปิดแก้ไขข้อมูล</span>
                </button>
                <button class="btn-back-link" style="height: 52px; border-radius: 12px; display: flex; align-items: center; gap: 8px; font-size: 1.05rem;" onclick="openManagementSheetNewTab()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
                    <span class="i18n" data-th="เปิดแท็บใหม่" data-en="Open New Tab">เปิดแท็บใหม่</span>
                </button>
            </div>

            <!-- Management iFrame Wrapper (With Close Button) -->
            <div class="mgmt-iframe-container" id="mgmt-iframe-wrapper">
                <div class="mgmt-iframe-header">
                    <div class="mgmt-iframe-title">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="8" y1="13" x2="16" y2="13"></line><line x1="8" y1="17" x2="16" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                        <span id="mgmt-iframe-title-text" class="i18n" data-th="กำลังเตรียมข้อมูล..." data-en="Preparing data...">กำลังเตรียมข้อมูล...</span>
                    </div>
                    <button class="mgmt-btn-close" onclick="closeManagementSheet()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                        <span class="i18n" data-th="ปิดหน้าต่าง" data-en="Close">ปิดหน้าต่าง</span>
                    </button>
                </div>
                <iframe id="mgmt-iframe" class="mgmt-iframe" src="" allowfullscreen></iframe>
            </div>
        </main>

        <!-- ===== START WELFARE UPDATE (NEW DASHBOARD) ===== -->
        <main id="employee-welfare-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n mf-title-glow" data-th="สวัสดิการพนักงาน (Employee Welfare)" data-en="Employee Welfare Dashboard">สวัสดิการพนักงาน (Employee Welfare)</h1>
                    <p class="i18n" data-th="แดชบอร์ดติดตามข้อมูลการเบิกจ่ายงบประมาณด้านสวัสดิการและสิทธิประโยชน์พนักงาน" data-en="Employee Welfare & Benefits Tracking Dashboard" style="font-family: var(--font-display); color: var(--color-primary); letter-spacing: 1px; font-size: 0.9rem;">แดชบอร์ดติดตามข้อมูลการเบิกจ่ายงบประมาณด้านสวัสดิการและสิทธิประโยชน์พนักงาน</p>
                </div>
                <button class="btn-back-link" onclick="showPage('dashboard-center')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <span class="i18n" data-th="กลับสู่ Dashboard Center" data-en="Back to Center">กลับสู่ Dashboard Center</span>
                </button>
            </div>

            <!-- 0. DIVISION TABS BUTTONS (NEW) -->
            <div class="welfare-div-tabs" style="display: flex; gap: 15px; margin-bottom: 24px;">
                <button id="welfare-tab-all" onclick="welfare_setDivision('all')" style="flex: 1; padding: 12px 20px; border-radius: 8px; border: 1px solid rgba(0, 243, 255, 0.4); background: rgba(0, 243, 255, 0.1); color: var(--color-primary); font-family: var(--font-display); font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.3s; text-transform: uppercase;">All Staff</button>
                <button id="welfare-tab-mgmt" onclick="welfare_setDivision('Management Staff')" style="flex: 1; padding: 12px 20px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); background: transparent; color: rgba(255, 255, 255, 0.6); font-family: var(--font-display); font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.3s; text-transform: uppercase;">Management Staff</button>
                <button id="welfare-tab-prod" onclick="welfare_setDivision('Production Staff')" style="flex: 1; padding: 12px 20px; border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); background: transparent; color: rgba(255, 255, 255, 0.6); font-family: var(--font-display); font-weight: 600; letter-spacing: 1px; cursor: pointer; transition: all 0.3s; text-transform: uppercase;">Production Staff</button>
            </div>

            <!-- 1. KPI SECTION (UPDATED FONT SIZES) -->
            <section class="kpi-row" style="margin-bottom: 32px;">
                <div class="kpi-block" data-type="total" style="animation-delay: 0.05s;">
                    <div class="kpi-label i18n" data-th="พนักงานที่ใช้สิทธิ์" data-en="Unique Employees">พนักงานที่ใช้สิทธิ์</div>
                    <div class="kpi-value" id="ew-kpi-emp" style="font-size: 1.6rem !important;">0</div>
                    <p style="color: var(--color-text-muted); font-size: 0.85rem;">คน (Persons)</p>
                </div>
                <div class="kpi-block" data-type="rates" style="animation-delay: 0.1s;">
                    <div class="kpi-label i18n" data-th="ยอดใช้สวัสดิการรวม" data-en="Total Amount">ยอดใช้สวัสดิการรวม</div>
                    <div class="kpi-value val-glow-flow" id="ew-kpi-amount" data-val="0" style="font-size: 1.6rem !important;">0.00</div>
                    <p style="color: var(--color-text-muted); font-size: 0.85rem;">บาท (THB)</p>
                </div>
                <div class="kpi-block" data-type="delayed" style="animation-delay: 0.15s;">
                    <div class="kpi-label i18n" data-th="ค่าเฉลี่ยต่อคน" data-en="Average per Person">ค่าเฉลี่ยต่อคน</div>
                    <div class="kpi-value" id="ew-kpi-avg" data-val="0" style="font-size: 1.6rem !important;">0.00</div>
                    <p style="color: var(--color-text-muted); font-size: 0.85rem;">บาท/คน (THB/Person)</p>
                </div>
                <div class="kpi-block" data-type="hired" style="animation-delay: 0.2s; justify-content: center;">
                    <div class="kpi-label i18n" data-th="ประเภทสวัสดิการ" data-en="Benefit Types">ประเภทสวัสดิการ</div>
                    <div class="kpi-value" id="ew-kpi-types" style="color: var(--color-success); font-size: 1.6rem !important;">0</div>
                    <p style="color: var(--color-text-muted); font-size: 0.85rem;">รายการ (Categories)</p>
                </div>
            </section>

            <!-- 2. FILTER SECTION (Removed Division) -->
            <section class="filter-wrap" style="margin-bottom: 32px; padding: 20px 30px; gap: 20px; flex-wrap: wrap;">
                <div class="filter-item" style="flex: 1; min-width: 150px;">
                    <label>ไตรมาส (Quarter)</label>
                    <select id="ew-filter-quarter" class="filter-control" onchange="welfare_processAndRender()" style="min-width: 100%;">
                        <option value="all">ทั้งหมด (All Quarters)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 1; min-width: 200px;">
                    <label>แผนก (Department)</label>
                    <select id="ew-filter-dept" class="filter-control" onchange="welfare_processAndRender()" style="min-width: 100%;">
                        <option value="all">ทั้งหมด (All Departments)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 1; min-width: 200px;">
                    <label>ประเภท (Benefit Type)</label>
                    <select id="ew-filter-type" class="filter-control" onchange="welfare_processAndRender()" style="min-width: 100%;">
                        <option value="all">ทั้งหมด (All Types)</option>
                    </select>
                </div>
            </section>

            <!-- 3. CHART SECTION -->
            <div class="dash-row dash-row-1" style="grid-template-columns: 1fr;">
                <div class="panel-box" style="animation-delay: 0.3s;">
                    <div class="panel-title" style="align-items: flex-start; flex-wrap: wrap; gap: 16px;">
                        <div>แนวโน้มการเบิกจ่ายตามช่วงเวลา (Trend by Use Date)</div>
                        <div class="chart-type-toggle">
                            <button id="btn-ewtrend-line" class="chart-toggle-btn active" onclick="changeEwTrendChart('line')">Line</button>
                            <button id="btn-ewtrend-bar" class="chart-toggle-btn" onclick="changeEwTrendChart('bar')">Bar</button>
                            <button id="btn-ewtrend-area" class="chart-toggle-btn" onclick="changeEwTrendChart('area')">Area</button>
                        </div>
                    </div>
                    <div class="chart-wrapper" style="height: 300px;"><canvas id="welfare_chart_line"></canvas></div>
                </div>
            </div>
            <div class="dash-row dash-row-3">
                <div class="panel-box" style="animation-delay: 0.4s;">
                    <div class="panel-title">สัดส่วนตามประเภทสวัสดิการ (By Benefit Type)</div>
                    <div class="chart-wrapper"><canvas id="welfare_chart_donut"></canvas></div>
                </div>
                <div class="panel-box" style="animation-delay: 0.5s;">
                    <div class="panel-title">ยอดเบิกจ่ายตามแผนก (By Department)</div>
                    <div class="chart-wrapper"><canvas id="welfare_chart_bar"></canvas></div>
                </div>
            </div>

            <!-- 4. DATA TABLE -->
            <div class="panel-box" style="padding: 0; background: transparent; border: none; box-shadow: none; animation-delay: 0.6s; margin-top: 24px;">
                <div class="benefit-table-wrap">
                    <div class="bn-table-scroll" style="max-height: 500px;">
                        <table class="benefit-table">
                            <thead>
                                <tr>
                                    <th style="width: 80px; text-align: center;">รหัส (Emp ID)</th>
                                    <th>ชื่อพนักงาน (Name)</th>
                                    <th>แผนก (Dept)</th>
                                    <th>ประเภทสวัสดิการ (Benefit Type)</th>
                                    <th style="text-align: right;">ยอดเงิน (Amount)</th>
                                    <th style="text-align: center;">วันที่เบิก (Use Date)</th>
                                </tr>
                            </thead>
                            <tbody id="ew-table-body">
                                <!-- Injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
        <!-- ===== END WELFARE UPDATE (NEW DASHBOARD) ===== -->

        <!-- REPORT 1: WORKFORCE -->
        <main id="workforce-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n" data-th="แผนอัตรากำลังพลรับเพิ่ม ประจำปี 2569" data-en="Workforce Addition Plan 2026">แผนอัตรากำลังพลรับเพิ่ม ประจำปี 2569</h1>
                    <p class="i18n" data-th="แดชบอร์ดวางแผนอัตรากำลังระดับผู้บริหาร" data-en="Executive HR Workforce Planning Dashboard">แดชบอร์ดวางแผนอัตรากำลังระดับผู้บริหาร</p>
                </div>
                <button class="btn-back-link" onclick="showPage('reports')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <span class="i18n" data-th="กลับสู่ศูนย์รายงาน" data-en="Back to Center">กลับสู่ศูนย์รายงาน</span>
                </button>
            </div>

            <section class="kpi-row" id="kpi-container">
                <div class="kpi-block" data-type="total" style="animation-delay: 0.05s;">
                    <div class="kpi-value" id="kpi-total-pos">0</div>
                    <div class="kpi-label i18n" data-th="ตำแหน่งทั้งหมด" data-en="Total Positions">ตำแหน่งทั้งหมด</div>
                </div>
                <div class="kpi-block" data-type="rates" style="animation-delay: 0.1s;">
                    <div class="kpi-value" id="kpi-sum-rates">0</div>
                    <div class="kpi-label i18n" data-th="อัตราที่ต้องรับ" data-en="Required Headcount">อัตราที่ต้องรับ</div>
                </div>
                
                <div class="kpi-block" data-type="hired" style="animation-delay: 0.15s;">
                    <div class="kpi-label i18n" data-th="สถานะการรับเข้าทำงาน" data-en="Hiring Status Overview">สถานะการรับเข้าทำงาน</div>
                    <div id="kpi-hired-container"></div>
                </div>
            </section>

            <section class="filter-wrap">
                <div class="filter-item">
                    <label class="i18n" data-th="แผนก / หน่วยงาน" data-en="Department / Unit">แผนก / หน่วยงาน</label>
                    <select id="filter-dept-select" class="filter-control" onchange="processAndRender()">
                        <option value="all">ทั้งหมด (All Departments)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="เดือนที่ต้องการ" data-en="Month">เดือนที่ต้องการ</label>
                    <select id="filter-month-select" class="filter-control" onchange="processAndRender()">
                        <option value="all">ทุกเดือน (All Months)</option>
                    </select>
                </div>
            </section>

            <div id="dashboard-render-area"></div>
        </main>

        <!-- REPORT 2: RECRUITING -->
        <main id="recruiting-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n" data-th="Data Report – Recruiting 2569" data-en="Data Report – Recruiting 2026">Data Report – Recruiting 2569</h1>
                    <p class="i18n" data-th="แดชบอร์ดติดตามการสรรหาบุคลากร" data-en="Recruitment Planning Dashboard">แดชบอร์ดติดตามการสรรหาบุคลากร</p>
                </div>
                <button class="btn-back-link" onclick="showPage('reports')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <span class="i18n" data-th="กลับสู่ศูนย์รายงาน" data-en="Back to Center">กลับสู่ศูนย์รายงาน</span>
                </button>
            </div>

            <!-- KPI Summary Row -->
            <section class="kpi-row" id="recruiting-kpi-container">
                <div class="kpi-block" data-type="total" style="animation-delay: 0.05s;">
                    <div class="kpi-label i18n" data-th="จำนวนตำแหน่งที่ต้องสรรหาทั้งหมด" data-en="Total Open Positions">จำนวนตำแหน่งที่ต้องสรรหาทั้งหมด</div>
                    <div class="kpi-value" id="r-kpi-tasks">0</div>
                </div>
                <div class="kpi-block" data-type="rates" style="animation-delay: 0.1s;">
                    <div class="kpi-label i18n" data-th="จำนวนบุคลากรที่ต้องสรรหาทั้งหมด" data-en="Total Target Headcount">จำนวนบุคลากรที่ต้องสรรหาทั้งหมด</div>
                    <div class="kpi-value" id="r-kpi-total">0</div>
                </div>
                <div class="kpi-block" data-type="hired" style="animation-delay: 0.15s;">
                    <div class="kpi-label i18n" data-th="สถานะรวม" data-en="Status Overview">สถานะรวม</div>
                    <div id="r-kpi-status-container"></div>
                </div>
            </section>

            <!-- Filter Section -->
            <section class="filter-wrap">
                <div class="filter-item">
                    <label class="i18n" data-th="แผนก / ตำแหน่ง" data-en="Department / Position">แผนก / ตำแหน่ง</label>
                    <select id="rec-filter-owner" class="filter-control" onchange="processAndRenderRecruiting()">
                        <option value="all">ทั้งหมด (All Tasks)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="เดือนที่ต้องการ" data-en="Month">เดือนที่ต้องการ</label>
                    <select id="rec-filter-month" class="filter-control" onchange="processAndRenderRecruiting()">
                        <option value="all">ทุกเดือน (All Months)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="สถานะ" data-en="Status">สถานะ</label>
                    <select id="rec-filter-status" class="filter-control" onchange="processAndRenderRecruiting()">
                        <option value="all" class="i18n" data-th="ทั้งหมด (All Status)" data-en="All Status">ทั้งหมด (All Status)</option>
                        <option value="completed" class="i18n" data-th="รับแล้ว (Completed)" data-en="Completed">รับแล้ว (Completed)</option>
                        <option value="in progress" class="i18n" data-th="กำลังดำเนินการ (In Progress)" data-en="In Progress">กำลังดำเนินการ (In Progress)</option>
                        <option value="pending" class="i18n" data-th="ขาด (Pending)" data-en="Pending">ขาด (Pending)</option>
                    </select>
                </div>
            </section>

            <!-- Cards Rendering Area -->
            <div id="recruiting-render-area"></div>
        </main>

        <!-- REPORT 5: BENEFIT TASK MONITORING -->
        <main id="benefit-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n" data-th="Data Report – Benefit (Task Monitoring)" data-en="Data Report – Benefit (Task Monitoring)">Data Report – Benefit (Task Monitoring)</h1>
                    <p class="i18n" data-th="แดชบอร์ดติดตามงานและระบบแจ้งเตือนอัจฉริยะ" data-en="Smart Task Monitoring & Alert Dashboard">แดชบอร์ดติดตามงานและระบบแจ้งเตือนอัจฉริยะ</p>
                </div>
                <button class="btn-back-link" onclick="showPage('reports')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <span class="i18n" data-th="กลับสู่ศูนย์รายงาน" data-en="Back to Center">กลับสู่ศูนย์รายงาน</span>
                </button>
            </div>

            <!-- SMART ALERT SECTION -->
            <div id="benefit-alert-area"></div>

            <!-- KPI SUMMARY SECTION -->
            <section class="kpi-row" style="margin-bottom: 40px;">
                <div class="kpi-block" data-type="total" style="animation-delay: 0.05s;">
                    <div class="kpi-label i18n" data-th="ยอดรวมทั้งหมด" data-en="Total Tasks">ยอดรวมทั้งหมด</div>
                    <div class="kpi-value" id="bn-kpi-total-tasks">0</div>
                    <p class="i18n" data-th="รายการที่ต้องดำเนินการ" data-en="Actionable items" style="color: var(--color-text-muted); font-size: 0.85rem; margin-top: 8px;">รายการที่ต้องดำเนินการ</p>
                </div>
                
                <div class="kpi-block" style="animation-delay: 0.1s; grid-column: span 2;">
                    <div class="kpi-label i18n" data-th="สถานะรวม (Status Overview)" data-en="Status Overview" style="margin-bottom: 20px; color: #fff;">สถานะรวม (Status Overview)</div>
                    <div class="kpi-list-container">
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot dot-success"></span><span class="kpi-list-label i18n" data-th="✔ ทำแล้ว (Completed)" data-en="✔ Completed">✔ ทำแล้ว (Completed)</span></div>
                            <span class="kpi-list-value val-success" id="bn-kpi-completed">0</span>
                        </div>
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot" style="background-color: var(--color-warning); box-shadow: 0 0 8px var(--color-warning);"></span><span class="kpi-list-label i18n" data-th="🔄 กำลังดำเนินการ (In Progress)" data-en="🔄 In Progress">🔄 กำลังดำเนินการ (In Progress)</span></div>
                            <span class="kpi-list-value" style="color: var(--color-warning);" id="bn-kpi-progress">0</span>
                        </div>
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot dot-missing"></span><span class="kpi-list-label i18n" data-th="⏳ ยังไม่ได้ทำ (Pending)" data-en="⏳ Pending">⏳ ยังไม่ได้ทำ (Pending)</span></div>
                            <span class="kpi-list-value val-missing" id="bn-kpi-pending">0</span>
                        </div>
                    </div>
                    <!-- Combined Progress Bar -->
                    <div class="bn-progress-bar" id="bn-progress-bar-render">
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-success);"></div>
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-warning);"></div>
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-danger);"></div>
                    </div>
                </div>
            </section>

            <!-- FILTER SECTION -->
            <section class="filter-wrap" style="margin-bottom: 40px;">
                <div class="filter-item">
                    <label class="i18n" data-th="รายการงาน" data-en="Task">รายการงาน</label>
                    <select id="bn-filter-task" class="filter-control" onchange="processAndRenderBenefit()">
                        <option value="all">ทั้งหมด (All Tasks)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="เดือน" data-en="Month">เดือน</label>
                    <select id="bn-filter-month" class="filter-control" onchange="processAndRenderBenefit()">
                        <option value="all">ทุกเดือน (All Months)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="สถานะ" data-en="Status">สถานะ</label>
                    <select id="bn-filter-status" class="filter-control" onchange="processAndRenderBenefit()">
                        <option value="all" class="i18n" data-th="ทั้งหมด (All Status)" data-en="All Status">ทั้งหมด (All Status)</option>
                        <option value="completed" class="i18n" data-th="✔ ทำแล้ว (Completed)" data-en="✔ Completed">✔ ทำแล้ว (Completed)</option>
                        <option value="in progress" class="i18n" data-th="🔄 กำลังดำเนินการ (In Progress)" data-en="🔄 In Progress">🔄 กำลังดำเนินการ (In Progress)</option>
                        <option value="pending" class="i18n" data-th="⏳ ยังไม่ได้ทำ (Pending)" data-en="⏳ Pending">⏳ ยังไม่ได้ทำ (Pending)</option>
                    </select>
                </div>
            </section>

            <!-- TABLE SECTION -->
            <div class="benefit-table-wrap">
                <div class="bn-table-scroll">
                    <table class="benefit-table">
                        <thead>
                            <tr>
                                <th style="width: 80px; text-align: center;" class="i18n" data-th="ลำดับ" data-en="No.">ลำดับ</th>
                                <th class="i18n" data-th="รายการงาน" data-en="Task Name">รายการงาน</th>
                                <th class="i18n" data-th="ผู้รับผิดชอบ" data-en="Owner">ผู้รับผิดชอบ</th>
                                <th class="i18n" data-th="เดือน" data-en="Month">เดือน</th>
                                <th class="i18n" data-th="สถานะ" data-en="Status">สถานะ</th>
                                <th style="text-align: center;" class="i18n" data-th="แจ้งเตือน" data-en="Alert">แจ้งเตือน</th>
                            </tr>
                        </thead>
                        <tbody id="benefit-table-body">
                            <!-- Injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- REPORT: SALARY BUDGET CONTROL (NEW) -->
        <main id="salary-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n" data-th="Data_Report ควบคุมงบประมาณด้านเงินเดือน" data-en="Salary Budget Control">Data_Report ควบคุมงบประมาณด้านเงินเดือน</h1>
                    <p class="i18n" data-th="Dashboard for monitoring monthly salary budget control and task status" data-en="Dashboard for monitoring monthly salary budget control and task status">Dashboard for monitoring monthly salary budget control and task status</p>
                </div>
                <button class="btn-back-link" onclick="showPage('reports')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <span class="i18n" data-th="กลับสู่ศูนย์รายงาน" data-en="Back to Center">กลับสู่ศูนย์รายงาน</span>
                </button>
            </div>

            <!-- SMART ALERT SECTION -->
            <div id="salary-alert-area"></div>

            <!-- KPI SUMMARY SECTION -->
            <section class="kpi-row" style="margin-bottom: 40px;">
                <div class="kpi-block" data-type="total" style="animation-delay: 0.05s;">
                    <div class="kpi-label i18n" data-th="ยอดรวมทั้งหมด" data-en="Total Tasks">ยอดรวมทั้งหมด</div>
                    <div class="kpi-value" id="sl-kpi-total-tasks">0</div>
                    <p class="i18n" data-th="รายการที่ต้องดำเนินการ" data-en="Actionable items" style="color: var(--color-text-muted); font-size: 0.85rem; margin-top: 8px;">รายการที่ต้องดำเนินการ</p>
                </div>
                
                <div class="kpi-block" style="animation-delay: 0.1s; grid-column: span 2;">
                    <div class="kpi-label i18n" data-th="สถานะรวม (Status Overview)" data-en="Status Overview" style="margin-bottom: 20px; color: #fff;">สถานะรวม (Status Overview)</div>
                    <div class="kpi-list-container">
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot dot-success"></span><span class="kpi-list-label i18n" data-th="✔ ทำแล้ว (Completed)" data-en="✔ Completed">✔ ทำแล้ว (Completed)</span></div>
                            <span class="kpi-list-value val-success" id="sl-kpi-completed">0</span>
                        </div>
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot" style="background-color: var(--color-warning); box-shadow: 0 0 8px var(--color-warning);"></span><span class="kpi-list-label i18n" data-th="🔄 กำลังดำเนินการ (In Progress)" data-en="🔄 In Progress">🔄 กำลังดำเนินการ (In Progress)</span></div>
                            <span class="kpi-list-value" style="color: var(--color-warning);" id="sl-kpi-progress">0</span>
                        </div>
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot dot-missing"></span><span class="kpi-list-label i18n" data-th="⏳ ยังไม่ได้ทำ (Pending)" data-en="⏳ Pending">⏳ ยังไม่ได้ทำ (Pending)</span></div>
                            <span class="kpi-list-value val-missing" id="sl-kpi-pending">0</span>
                        </div>
                    </div>
                    <!-- Combined Progress Bar -->
                    <div class="bn-progress-bar" id="sl-progress-bar-render">
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-success);"></div>
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-warning);"></div>
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-danger);"></div>
                    </div>
                </div>
            </section>

            <!-- FILTER SECTION -->
            <section class="filter-wrap" style="margin-bottom: 40px;">
                <div class="filter-item">
                    <label class="i18n" data-th="รายการงบประมาณ" data-en="Budget Item">รายการงบประมาณ</label>
                    <select id="sl-filter-item" class="filter-control" onchange="processAndRenderSalary()">
                        <option value="all">ทั้งหมด (All Items)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="เดือน" data-en="Month">เดือน</label>
                    <select id="sl-filter-month" class="filter-control" onchange="processAndRenderSalary()">
                        <option value="all">ทุกเดือน (All Months)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="สถานะ" data-en="Status">สถานะ</label>
                    <select id="sl-filter-status" class="filter-control" onchange="processAndRenderSalary()">
                        <option value="all" class="i18n" data-th="ทั้งหมด (All Status)" data-en="All Status">ทั้งหมด (All Status)</option>
                        <option value="completed" class="i18n" data-th="✔ ทำแล้ว (Completed)" data-en="✔ Completed">✔ ทำแล้ว (Completed)</option>
                        <option value="in progress" class="i18n" data-th="🔄 กำลังดำเนินการ (In Progress)" data-en="🔄 In Progress">🔄 กำลังดำเนินการ (In Progress)</option>
                        <option value="pending" class="i18n" data-th="⏳ ยังไม่ได้ทำ (Pending)" data-en="⏳ Pending">⏳ ยังไม่ได้ทำ (Pending)</option>
                    </select>
                </div>
            </section>

            <!-- TABLE SECTION -->
            <div class="benefit-table-wrap">
                <div class="bn-table-scroll">
                    <table class="benefit-table">
                        <thead>
                            <tr>
                                <th style="width: 80px; text-align: center;" class="i18n" data-th="ลำดับ" data-en="No.">ลำดับ</th>
                                <th class="i18n" data-th="รายการงบประมาณ" data-en="Budget Item">รายการงบประมาณ</th>
                                <th class="i18n" data-th="ผู้รับผิดชอบ" data-en="Owner">ผู้รับผิดชอบ</th>
                                <th class="i18n" data-th="เดือน" data-en="Month">เดือน</th>
                                <th class="i18n" data-th="สถานะ" data-en="Status">สถานะ</th>
                                <th style="text-align: center;" class="i18n" data-th="แจ้งเตือน" data-en="Alert">แจ้งเตือน</th>
                            </tr>
                        </thead>
                        <tbody id="salary-table-body">
                            <!-- Injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- REPORT: WELFARE BUDGET CONTROL (NEW) -->
        <main id="welfare-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n" data-th="Data_Report ควบคุมแผนงบประมาณด้านสวัสดิการ" data-en="Welfare Budget Control">Data_Report ควบคุมแผนงบประมาณด้านสวัสดิการ</h1>
                    <p class="i18n" data-th="Dashboard for monitoring monthly welfare budget control and task status" data-en="Dashboard for monitoring monthly welfare budget control and task status">Dashboard for monitoring monthly welfare budget control and task status</p>
                </div>
                <button class="btn-back-link" onclick="showPage('reports')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <span class="i18n" data-th="กลับสู่ศูนย์รายงาน" data-en="Back to Center">กลับสู่ศูนย์รายงาน</span>
                </button>
            </div>

            <!-- SMART ALERT SECTION -->
            <div id="welfare-alert-area"></div>

            <!-- KPI SUMMARY SECTION -->
            <section class="kpi-row" style="margin-bottom: 40px;">
                <div class="kpi-block" data-type="total" style="animation-delay: 0.05s;">
                    <div class="kpi-label i18n" data-th="ยอดรวมทั้งหมด" data-en="Total Tasks">ยอดรวมทั้งหมด</div>
                    <div class="kpi-value" id="wl-kpi-total-tasks">0</div>
                    <p class="i18n" data-th="รายการที่ต้องดำเนินการ" data-en="Actionable items" style="color: var(--color-text-muted); font-size: 0.85rem; margin-top: 8px;">รายการที่ต้องดำเนินการ</p>
                </div>
                
                <div class="kpi-block" style="animation-delay: 0.1s; grid-column: span 2;">
                    <div class="kpi-label i18n" data-th="สถานะรวม (Status Overview)" data-en="Status Overview" style="margin-bottom: 20px; color: #fff;">สถานะรวม (Status Overview)</div>
                    <div class="kpi-list-container">
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot dot-success"></span><span class="kpi-list-label i18n" data-th="✔ ทำแล้ว (Completed)" data-en="✔ Completed">✔ ทำแล้ว (Completed)</span></div>
                            <span class="kpi-list-value val-success" id="wl-kpi-completed">0</span>
                        </div>
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot" style="background-color: var(--color-warning); box-shadow: 0 0 8px var(--color-warning);"></span><span class="kpi-list-label i18n" data-th="🔄 กำลังดำเนินการ (In Progress)" data-en="🔄 In Progress">🔄 กำลังดำเนินการ (In Progress)</span></div>
                            <span class="kpi-list-value" style="color: var(--color-warning);" id="wl-kpi-progress">0</span>
                        </div>
                        <div class="kpi-list-row">
                            <div class="kpi-list-left"><span class="kpi-dot dot-missing"></span><span class="kpi-list-label i18n" data-th="⏳ ยังไม่ได้ทำ (Pending)" data-en="⏳ Pending">⏳ ยังไม่ได้ทำ (Pending)</span></div>
                            <span class="kpi-list-value val-missing" id="wl-kpi-pending">0</span>
                        </div>
                    </div>
                    <!-- Combined Progress Bar -->
                    <div class="bn-progress-bar" id="wl-progress-bar-render">
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-success);"></div>
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-warning);"></div>
                        <div class="bn-progress-segment" style="width: 0%; background: var(--color-danger);"></div>
                    </div>
                </div>
            </section>

            <!-- FILTER SECTION -->
            <section class="filter-wrap" style="margin-bottom: 40px;">
                <div class="filter-item">
                    <label class="i18n" data-th="รายการงบประมาณ" data-en="Budget Item">รายการงบประมาณ</label>
                    <select id="wl-filter-item" class="filter-control" onchange="processAndRenderWelfare()">
                        <option value="all">ทั้งหมด (All Items)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="เดือน" data-en="Month">เดือน</label>
                    <select id="wl-filter-month" class="filter-control" onchange="processAndRenderWelfare()">
                        <option value="all">ทุกเดือน (All Months)</option>
                    </select>
                </div>
                <div class="filter-item">
                    <label class="i18n" data-th="สถานะ" data-en="Status">สถานะ</label>
                    <select id="wl-filter-status" class="filter-control" onchange="processAndRenderWelfare()">
                        <option value="all" class="i18n" data-th="ทั้งหมด (All Status)" data-en="All Status">ทั้งหมด (All Status)</option>
                        <option value="completed" class="i18n" data-th="✔ ทำแล้ว (Completed)" data-en="✔ Completed">✔ ทำแล้ว (Completed)</option>
                        <option value="in progress" class="i18n" data-th="🔄 กำลังดำเนินการ (In Progress)" data-en="🔄 In Progress">🔄 กำลังดำเนินการ (In Progress)</option>
                        <option value="pending" class="i18n" data-th="⏳ ยังไม่ได้ทำ (Pending)" data-en="⏳ Pending">⏳ ยังไม่ได้ทำ (Pending)</option>
                    </select>
                </div>
            </section>

            <!-- TABLE SECTION -->
            <div class="benefit-table-wrap">
                <div class="bn-table-scroll">
                    <table class="benefit-table">
                        <thead>
                            <tr>
                                <th style="width: 80px; text-align: center;" class="i18n" data-th="ลำดับ" data-en="No.">ลำดับ</th>
                                <th class="i18n" data-th="รายการงบประมาณสวัสดิการ" data-en="Welfare Budget Item">รายการงบประมาณสวัสดิการ</th>
                                <th class="i18n" data-th="ผู้รับผิดชอบ" data-en="Owner">ผู้รับผิดชอบ</th>
                                <th class="i18n" data-th="เดือน" data-en="Month">เดือน</th>
                                <th class="i18n" data-th="สถานะ" data-en="Status">สถานะ</th>
                                <th style="text-align: center;" class="i18n" data-th="แจ้งเตือน" data-en="Alert">แจ้งเตือน</th>
                            </tr>
                        </thead>
                        <tbody id="welfare-table-body">
                            <!-- Injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- DASHBOARD: EMPLOYEE LOAN (NEW) -->
        <main id="loan-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n" data-th="เงินกู้พนักงาน" data-en="Employee Loan Dashboard">เงินกู้พนักงาน</h1>
                    <p class="i18n" data-th="Dashboard ระบบจัดการและตรวจสอบสถานะเงินกู้สวัสดิการพนักงาน" data-en="Employee Welfare Loan Status & Management Dashboard">Dashboard ระบบจัดการและตรวจสอบสถานะเงินกู้สวัสดิการพนักงาน</p>
                </div>
                <button class="btn-back-link" onclick="showPage('dashboard-center')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                    <span class="i18n" data-th="กลับสู่ Dashboard Center" data-en="Back to Center">กลับสู่ Dashboard Center</span>
                </button>
            </div>

            <!-- SECTION 1 & 2: HERO KPI & MOVEMENT KPI -->
            <div class="loan-top-grid">
                <!-- HERO KPI (Left) -->
                <div class="loan-hero-card">
                    <div class="loan-hero-title i18n" data-th="ยอดคงเหลือปัจจุบัน" data-en="Current Balance">ยอดคงเหลือปัจจุบัน</div>
                    <div class="loan-hero-value">
                        <span id="ln-hero-balance" data-val="0">0.00</span>
                        <span class="loan-hero-currency">THB</span>
                    </div>
                    <div class="loan-hero-meta">
                        <div class="loan-hero-badge">เดือน <span id="ln-hero-month">-</span></div>
                        <div class="loan-hero-badge">ปี <span id="ln-hero-year">-</span></div>
                        <div class="loan-hero-badge">ไตรมาส <span id="ln-hero-quarter">-</span></div>
                    </div>
                </div>

                <!-- MOVEMENT KPI (Right) -->
                <div class="loan-movement-grid">
                    <div class="loan-move-card">
                        <div class="loan-move-title">
                            <span class="i18n" data-th="รับเงินต้นรวม" data-en="Total Principal Rcvd">รับเงินต้นรวม</span>
                            <span id="ln-move-subtitle1" style="font-size: 0.8rem; color: rgba(255,255,255,0.4); margin-left: 8px;"></span>
                        </div>
                        <div class="loan-move-value val-principal" id="ln-move-prin" data-val="0">0.00</div>
                    </div>
                    <div class="loan-move-card">
                        <div class="loan-move-title">
                            <span class="i18n" data-th="รับดอกเบี้ยรวม" data-en="Total Interest Rcvd">รับดอกเบี้ยรวม</span>
                            <span id="ln-move-subtitle2" style="font-size: 0.8rem; color: rgba(255,255,255,0.4); margin-left: 8px;"></span>
                        </div>
                        <div class="loan-move-value val-interest" id="ln-move-int" data-val="0">0.00</div>
                    </div>
                    <div class="loan-move-card">
                        <div class="loan-move-title">
                            <span class="i18n" data-th="จ่ายเงินกู้รวม" data-en="Total Disbursed">จ่ายเงินกู้รวม</span>
                            <span id="ln-move-subtitle3" style="font-size: 0.8rem; color: rgba(255,255,255,0.4); margin-left: 8px;"></span>
                        </div>
                        <div class="loan-move-value val-disburse" id="ln-move-dis" data-val="0">0.00</div>
                    </div>
                </div>
            </div>

            <!-- SECTION 3: FILTER BAR -->
            <section class="filter-wrap" style="margin-bottom: 40px; display: flex; flex-wrap: wrap; gap: 20px;">
                <div class="filter-item" style="flex: 1; min-width: 150px;">
                    <label class="i18n" data-th="ปี" data-en="Year">ปี</label>
                    <select id="ln-filter-year" class="filter-control" onchange="handleLoanFilterChange('ln-filter-year')" style="min-width: 100%;">
                        <option value="all">ทุกปี (All Years)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 1; min-width: 150px;">
                    <label class="i18n" data-th="ไตรมาส" data-en="Quarter">ไตรมาส</label>
                    <select id="ln-filter-quarter" class="filter-control" onchange="handleLoanFilterChange('ln-filter-quarter')" style="min-width: 100%;">
                        <option value="all">ทุกไตรมาส (All Quarters)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 1; min-width: 150px;">
                    <label class="i18n" data-th="เดือน" data-en="Month">เดือน</label>
                    <select id="ln-filter-month" class="filter-control" onchange="handleLoanFilterChange('ln-filter-month')" style="min-width: 100%;">
                        <option value="all">ทุกเดือน (All Months)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 2; min-width: 250px;">
                    <label class="i18n" data-th="รายการ" data-en="Item">รายการ</label>
                    <select id="ln-filter-item" class="filter-control" onchange="handleLoanFilterChange('ln-filter-item')" style="min-width: 100%;">
                        <option value="all">ทั้งหมด (All Items)</option>
                    </select>
                </div>
            </section>

            <!-- SECTION 4: TREND CHART -->
            <div class="loan-chart-section">
                <div class="loan-chart-title" style="align-items: flex-start; flex-wrap: wrap; gap: 16px;">
                    <div>
                        <span class="i18n" data-th="แนวโน้มยอดคงเหลือ (Trend Chart)" data-en="Balance Trend Chart">แนวโน้มยอดคงเหลือ (Trend Chart)</span>
                        <span class="loan-chart-subtitle i18n" style="display: block; margin-top: 4px;" data-th="*แสดงยอดคงเหลือสรุปรายปี (จากข้อมูลล่าสุดของแต่ละปี)" data-en="*Yearly Balance Trend (Latest record per year)">*แสดงยอดคงเหลือสรุปรายปี (จากข้อมูลล่าสุดของแต่ละปี)</span>
                    </div>
                    <div class="chart-type-toggle">
                        <button id="btn-chart-area" class="chart-toggle-btn active" onclick="changeLoanChartType('area')">Area</button>
                        <button id="btn-chart-smooth" class="chart-toggle-btn" onclick="changeLoanChartType('smooth')">Smooth</button>
                        <button id="btn-chart-bar" class="chart-toggle-btn" onclick="changeLoanChartType('bar')">Bar</button>
                    </div>
                </div>
                <div id="loan-chart-container" style="width: 100%; min-height: 300px; display: flex; align-items: center; justify-content: center;">
                    <!-- SVG injected by JS -->
                </div>
            </div>

            <!-- SECTION 5: DATA TABLE -->
            <div class="benefit-table-wrap">
                <div class="bn-table-scroll">
                    <table class="benefit-table">
                        <thead>
                            <tr>
                                <th class="i18n" data-th="รายการ" data-en="Item">รายการ</th>
                                <th class="i18n" data-th="รับเงินต้น" data-en="Principal" style="text-align: right;">รับเงินต้น</th>
                                <th class="i18n" data-th="รับดอกเบี้ย" data-en="Interest" style="text-align: right;">รับดอกเบี้ย</th>
                                <th class="i18n" data-th="รับดอก BANK" data-en="Bank Interest" style="text-align: right;">รับดอก BANK</th>
                                <th class="i18n" data-th="จ่ายเงินกู้" data-en="Disbursed" style="text-align: right;">จ่ายเงินกู้</th>
                                <th class="i18n" data-th="ยอดคงเหลือ" data-en="Balance" style="text-align: right; color: var(--color-primary);">ยอดคงเหลือ</th>
                                <th class="i18n" data-th="เดือน" data-en="Month" style="text-align: center;">เดือน</th>
                                <th class="i18n" data-th="ไตรมาส" data-en="Quarter" style="text-align: center;">ไตรมาส</th>
                                <th class="i18n" data-th="ปี" data-en="Year" style="text-align: center;">ปี</th>
                            </tr>
                        </thead>
                        <tbody id="loan-table-body">
                            <!-- Injected by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>

        <!-- DASHBOARD: MUTUAL AID FUND (เพื่อนช่วยเพื่อน) -->
        <main id="mutual-fund-dashboard-page">
            <div class="db-header-row">
                <div class="db-title-group">
                    <h1 class="i18n mf-title-glow" data-th="เพื่อนช่วยเพื่อน (Mutual Aid Fund)" data-en="Mutual Aid Fund Dashboard">เพื่อนช่วยเพื่อน (Mutual Aid Fund)</h1>
                    <p class="i18n" data-th="Real-time Dashboard - กองทุนช่วยเหลือพนักงาน" data-en="Real-time Dashboard - Employee Mutual Aid Fund" style="font-family: var(--font-display); color: var(--color-primary); letter-spacing: 2px; font-size: 0.9rem; text-transform: uppercase;">Real-time Dashboard - กองทุนช่วยเหลือพนักงาน</p>
                </div>
                <div style="display: flex; gap: 12px;">
                    <button class="btn-back-link" onclick="fetchMutualFundData()" style="color: var(--color-primary); border-color: var(--color-primary);">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.92-10.26l3.08 2.69"/></svg>
                        Refresh Data
                    </button>
                    <button class="btn-back-link" onclick="showPage('dashboard-center')">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        <span class="i18n" data-th="กลับสู่ Dashboard Center" data-en="Back to Center">กลับสู่ Dashboard Center</span>
                    </button>
                </div>
            </div>

            <!-- 1. Header KPIs (5 Items + Comparison) -->
            <div class="kpi-grid-7" style="grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); margin-bottom: 16px;">
                <div class="mf-kpi-card" style="--accent: #38bdf8; --accent-glow: rgba(56,189,248,0.5); animation-delay: 0.1s;">
                    <div class="mf-kpi-label">Total สมาชิก</div>
                    <div class="mf-kpi-value val-glow-flow" id="mf-kpi-total">0</div>
                </div>
                <div class="mf-kpi-card" style="--accent: #bc13fe; --accent-glow: rgba(188,19,254,0.5); animation-delay: 0.15s;">
                    <div class="mf-kpi-label">ยอดเงินรวม (฿)</div>
                    <div class="mf-kpi-value val-glow-flow" id="mf-kpi-amount">0</div>
                </div>
                <div class="mf-kpi-card" style="--accent: #ffb800; --accent-glow: rgba(255,184,0,0.5); animation-delay: 0.2s;">
                    <div class="mf-kpi-label">จำนวนแผนก</div>
                    <div class="mf-kpi-value val-glow-flow" id="mf-kpi-depts">0</div>
                </div>
                <div class="mf-kpi-card" style="--accent: #ff8a00; --accent-glow: rgba(255,138,0,0.5); animation-delay: 0.25s;">
                    <div class="mf-kpi-label">จำนวน Area</div>
                    <div class="mf-kpi-value val-glow-flow" id="mf-kpi-areas">0</div>
                </div>
                <div class="mf-kpi-card" style="--accent: #00ffa3; --accent-glow: rgba(0,255,163,0.5); animation-delay: 0.3s; justify-content: center; gap: 8px;">
                    <div class="mf-kpi-label" style="margin-bottom: 4px;">การใช้สิทธิ์ (Used)</div>
                    <div style="display: flex; justify-content: space-between; align-items: baseline; border-bottom: 1px dashed rgba(255,255,255,0.1); padding-bottom: 8px;">
                        <span style="font-size: 0.85rem; color: rgba(255,255,255,0.8); font-family: var(--font-display);">ครั้งที่ 1 :</span>
                        <div><span id="mf-kpi-used1" class="val-glow-flow" style="font-size: 1.8rem; font-weight: 900; font-family: var(--font-display);">0</span> <span style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">คน</span></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: baseline; padding-top: 4px;">
                        <span style="font-size: 0.85rem; color: rgba(255,255,255,0.8); font-family: var(--font-display);">ครั้งที่ 2 :</span>
                        <div><span id="mf-kpi-used2" class="val-glow-flow" style="font-size: 1.8rem; font-weight: 900; font-family: var(--font-display);">0</span> <span style="font-size: 0.75rem; color: rgba(255,255,255,0.5);">คน</span></div>
                    </div>
                </div>
            </div>

            <!-- 2. Filter Bar -->
            <section class="filter-wrap" style="margin-bottom: 32px; padding: 20px 30px; gap: 20px; align-items: flex-end;">
                <div class="filter-item" style="flex: 1;">
                    <label>แผนก (Department)</label>
                    <select id="mf-filter-dept" class="filter-control" onchange="processAndRenderMutualFund()" style="min-width: 100%;">
                        <option value="all">ทั้งหมด (All Departments)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 1;">
                    <label>พื้นที่ (Area)</label>
                    <select id="mf-filter-area" class="filter-control" onchange="processAndRenderMutualFund()" style="min-width: 100%;">
                        <option value="all">ทั้งหมด (All Areas)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 1;">
                    <label>การใช้สิทธิ์ (Status)</label>
                    <select id="mf-filter-status" class="filter-control" onchange="processAndRenderMutualFund()" style="min-width: 100%;">
                        <option value="all">ทั้งหมด (All Status)</option>
                        <option value="used1">ครั้งที่ 1 (Time 1)</option>
                        <option value="used2">ครั้งที่ 2 (Time 2)</option>
                        <option value="not_used">ยังไม่ใช้สิทธิ์ (Not Used)</option>
                    </select>
                </div>
                <div class="filter-item" style="flex: 0; justify-content: flex-end; padding-bottom: 2px;">
                    <button class="btn-action" onclick="resetMutualFundFilters()" style="height: 46px; border-color: var(--color-danger); color: var(--color-danger); background: rgba(255, 77, 77, 0.1);">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 4px;"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
                        Reset
                    </button>
                </div>
            </section>

            <!-- 3. Dashboard Row 1 (Trend + Mini KPIs) -->
            <div class="dash-row dash-row-1">
                <div class="panel-box" style="animation-delay: 0.1s;">
                    <div class="panel-title">
                        <div>Registration Trend <span style="font-size: 0.8rem; color: var(--color-text-muted); font-weight: 400; margin-left: 8px;">(สมาชิกใหม่ต่อปี)</span></div>
                        <div class="chart-type-toggle">
                            <button id="btn-mftrend-line" class="chart-toggle-btn active" onclick="changeMfTrendChart('line')">Line</button>
                            <button id="btn-mftrend-bar" class="chart-toggle-btn" onclick="changeMfTrendChart('bar')">Bar</button>
                            <button id="btn-mftrend-area" class="chart-toggle-btn" onclick="changeMfTrendChart('area')">Area</button>
                        </div>
                    </div>
                    <div class="chart-wrapper"><canvas id="mf-trendChart"></canvas></div>
                </div>
                <div class="panel-box" style="display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; animation-delay: 0.2s;">
                    <div class="mf-kpi-label" style="font-size: 1.2rem; color: #fff;">Avg Contribution</div>
                    <div class="mf-kpi-value val-glow-flow" id="mf-kpi-avg-contrib" style="font-size: 3.5rem; margin: 20px 0;">0 <span style="font-size: 1.5rem">฿</span></div>
                    <div style="font-size: 0.85rem; color: var(--color-text-muted);">ยอดเงินเฉลี่ยต่อสมาชิก</div>
                </div>
            </div>

            <!-- 4. Dashboard Row 2 (Pie + Bar) -->
            <div class="dash-row dash-row-2">
                <div class="panel-box" style="animation-delay: 0.4s;">
                    <div class="panel-title">
                        <div>Area Distribution</div>
                        <div class="chart-type-toggle">
                            <button id="btn-mfarea-pie" class="chart-toggle-btn active" onclick="changeMfAreaChart('pie')">Pie</button>
                            <button id="btn-mfarea-column" class="chart-toggle-btn" onclick="changeMfAreaChart('column')">Column</button>
                            <button id="btn-mfarea-line" class="chart-toggle-btn" onclick="changeMfAreaChart('line')">Line</button>
                        </div>
                    </div>
                    <div class="chart-wrapper"><canvas id="mf-areaPieChart"></canvas></div>
                </div>
                <div class="panel-box" style="animation-delay: 0.5s;">
                    <div class="panel-title">Members by Department</div>
                    <div class="chart-wrapper"><canvas id="mf-deptBarChart"></canvas></div>
                </div>
            </div>

            <!-- 5. Dashboard Row 3 (Top 5 + Alerts) -->
            <div class="dash-row dash-row-3">
                <div class="panel-box" style="animation-delay: 0.6s;">
                    <div class="panel-title">🏆 Top 5 Departments <span style="font-size: 0.8rem; color: var(--color-text-muted); font-weight: 400; margin-left: 8px;">(จำนวนสมาชิกสูงสุด)</span></div>
                    <ul class="top-list" id="mf-top-dept-list">
                        <!-- Injected via JS -->
                    </ul>
                </div>
                <div class="panel-box" style="animation-delay: 0.7s;">
                    <div class="panel-title" id="mf-alert-title">🔔 Recent Activity & Alerts</div>
                    <div id="mf-alert-container" class="bn-table-scroll" style="max-height: 250px; overflow-y: auto; padding-right: 5px;">
                        <!-- Injected via JS -->
                    </div>
                </div>
            </div>

            <!-- 6. Data Table -->
            <div class="panel-box" style="padding: 0; background: transparent; border: none; box-shadow: none; animation-delay: 0.8s;">
                <div class="benefit-table-wrap">
                    <div class="bn-table-scroll" style="max-height: 500px;">
                        <table class="benefit-table">
                            <thead>
                                <tr>
                                    <th style="width: 60px; text-align: center;">No.</th>
                                    <th>ชื่อพนักงาน (Name)</th>
                                    <th>แผนก (Dept)</th>
                                    <th>Area</th>
                                    <th style="text-align: center;">วันที่สมัคร (Reg. Date)</th>
                                    <th style="text-align: right;">ยอดเงิน (฿)</th>
                                    <th style="text-align: center;">สถานะ (Status)</th>
                                </tr>
                            </thead>
                            <tbody id="mf-table-body">
                                <!-- Injected by JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>

    </div>

    <!-- 3. THEME PANEL UI -->
    <div class="theme-overlay" id="theme-overlay" onclick="toggleThemePanel()"></div>
    <div class="theme-panel" id="theme-panel">
        <div class="panel-header">
            <div class="panel-title">Theme Experience</div>
            <div class="panel-subtitle">Personalize your workspace</div>
        </div>
        <div class="theme-option active" onclick="ThemeSystem.setTheme('galaxy')" id="opt-galaxy">
            <div class="theme-preview preview-galaxy"></div>
            <span class="theme-name">Galaxy 3D</span>
            <span class="theme-desc">UFOs, Fire Meteors & Deep Space.</span>
        </div>
        <div class="theme-option" onclick="ThemeSystem.setTheme('forest')" id="opt-forest">
            <div class="theme-preview preview-forest"></div>
            <span class="theme-name">Forest 3D</span>
            <span class="theme-desc">Swaying Trees & Windy Grass.</span>
        </div>
        <div class="theme-option" onclick="ThemeSystem.setTheme('ocean')" id="opt-ocean">
            <div class="theme-preview preview-ocean"></div>
            <span class="theme-name">Ocean 3D</span>
            <span class="theme-desc">Mountains, Day/Night Cycle & Cruise Ship.</span>
        </div>
        <div class="theme-option" onclick="ThemeSystem.setTheme('futurecity')" id="opt-futurecity">
            <div class="theme-preview preview-futurecity"></div>
            <span class="theme-name">Future City 3D</span>
            <span class="theme-desc">Executive Tech Skyline Experience.</span>
        </div>
        <div class="panel-footer">NARUMON Theme Engine v2.1</div>
    </div>

    <!-- TOAST NOTIFICATION COMPONENT -->
    <div id="toast" class="toast-notification">
        <span class="toast-icon">⚠️</span>
        <span id="toast-message">Notification</span>
    </div>

    <!-- PASSWORD MODAL (CYBERPUNK ULTRA) -->
    <div id="password-modal" class="password-overlay">
        <div class="password-box" id="password-box-container">
            <div class="password-content">
                <div class="password-icon" id="auth-icon">🔒</div>
                <h3 class="i18n" data-th="RESTRICTED AREA" data-en="RESTRICTED AREA">RESTRICTED AREA</h3>
                <p class="i18n" data-th="กรุณาใส่รหัสผ่านเพื่อเข้าสู่หน้าการจัดการข้อมูล" data-en="Please enter password to access data management.">กรุณาใส่รหัสผ่านเพื่อเข้าสู่หน้าการจัดการข้อมูล</p>
                
                <div class="password-input-wrap">
                    <input type="password" id="mgmt-password-input" placeholder="•••••••" autocomplete="off" />
                    <button type="button" class="toggle-password-btn" onclick="togglePasswordVisibility()" title="แสดงรหัสผ่าน">
                        <svg id="eye-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>
                
                <div id="auth-message" class="auth-msg"></div>

                <div class="password-actions">
                    <button class="btn btn-primary i18n" id="btn-confirm-auth" data-th="VERIFY ACCESS" data-en="VERIFY ACCESS" onclick="checkPassword()">VERIFY ACCESS</button>
                    <button class="btn btn-secondary i18n" id="btn-cancel-auth" data-th="ยกเลิก (Cancel)" data-en="Cancel" onclick="closePasswordModal()">ยกเลิก (Cancel)</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* =========================================
           PASSWORD AUTHENTICATION SYSTEM
           ========================================= */
           
        // กำหนดรหัสผ่านสำหรับเข้าแก้ไขข้อมูลที่นี่
        const ADMIN_PASSWORD = "1234"; 

        function checkPassword() {
            const input = document.getElementById('mgmt-password-input');
            const passBox = document.getElementById('password-box-container');
            const msg = document.getElementById('auth-message');
            const icon = document.getElementById('auth-icon');
            const val = input.value;

            // รีเซ็ตสถานะเก่าก่อนตรวจสอบ
            passBox.classList.remove('error-state', 'success-state');
            msg.className = 'auth-msg';
            
            if (val === "") {
                msg.textContent = "กรุณากรอกรหัสผ่าน";
                msg.classList.add('error');
                input.focus();
                return;
            }

            if (val === ADMIN_PASSWORD) {
                // กรณีใส่รหัส "ถูก" (กรอบจะกลายเป็นสีเขียวอัตโนมัติจากคลาส success-state)
                passBox.classList.add('success-state');
                msg.textContent = 'เข้าสู่ระบบแก้ไขข้อมูลสำเร็จ';
                msg.classList.add('success');
                icon.textContent = '🔓'; // เปลี่ยนไอคอนเป็นปลดล็อค
                input.disabled = true; // ล็อคช่องพิมพ์ชั่วคราว
                
                // หน่วงเวลา 1.5 วินาที ให้เห็นข้อความสำเร็จ ก่อนปิดหน้าต่าง
                setTimeout(() => {
                    closePasswordModal();
                    
                    // --- นำโค้ดสำหรับเปิดหน้าแก้ไขข้อมูลมาใส่ตรงนี้ ---
                    // เช่น showAdminPanel(); หรือ window.location.href = 'admin.html';
                    console.log("Admin Access Granted!"); 
                    
                    // คืนค่าเริ่มต้นให้ Modal เผื่อเปิดครั้งต่อไป
                    input.disabled = false;
                    input.value = '';
                    msg.textContent = '';
                    icon.textContent = '🔒';
                    passBox.classList.remove('success-state');
                }, 1500);

            } else {
                // กรณีใส่รหัส "ผิด" (กรอบจะกลายเป็นสีแดงและสั่นอัตโนมัติจากคลาส error-state)
                passBox.classList.add('error-state');
                msg.textContent = 'ใส่รหัสผ่านผิดกรุณาใส่ใหม่';
                msg.classList.add('error');
                input.value = ''; // ล้างช่องกรอก
                input.focus(); // ให้เคอร์เซอร์กลับไปที่เดิม
                
                // ถอดคลาส error ออกหลังจากแอนิเมชันสั่นจบลง (0.5วิ) เพื่อให้สั่นได้อีกถ้าผิดซ้ำ
                setTimeout(() => {
                    passBox.classList.remove('error-state');
                }, 500);
            }
        }

        // ทำให้สามารถกดปุ่ม Enter ในช่องกรอกรหัสเพื่อยืนยันได้เลย
        document.getElementById('mgmt-password-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        function closePasswordModal() {
            const modal = document.getElementById('password-modal');
            const input = document.getElementById('mgmt-password-input');
            const msg = document.getElementById('auth-message');
            const passBox = document.getElementById('password-box-container');
            
            modal.classList.remove('show');
            input.value = ''; // ล้างรหัสผ่านตอนกดปิด
            msg.textContent = ''; // ล้างข้อความแจ้งเตือน
            passBox.classList.remove('error-state', 'success-state'); // ล้างสถานะสี
        }

        // ฟังก์ชันสลับการมองเห็นรหัสผ่าน (รูปตา)
        function togglePasswordVisibility() {
            const input = document.getElementById('mgmt-password-input');
            const icon = document.getElementById('eye-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                // เปลี่ยนเป็นไอคอนตาที่ถูกขีดทับ
                icon.innerHTML = '<path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line>';
            } else {
                input.type = 'password';
                // กลับมาเป็นไอคอนตาปกติ
                icon.innerHTML = '<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle>';
            }
        }
        
        /* =========================================
           GLOBAL THEME ENGINE SYSTEM v2.1
           ========================================= */
        const ThemeSystem = {
            init() {
                this.canvas = document.getElementById('theme-particle-layer');
                this.ctx = this.canvas.getContext('2d');
                
                this.resize();
                window.addEventListener('resize', () => this.resize());
                
                const saved = localStorage.getItem('narumon-theme') || 'galaxy';
                this.setTheme(saved);
            },

            resize() {
                this.width = window.innerWidth;
                this.height = window.innerHeight;
                this.canvas.width = this.width;
                this.canvas.height = this.height;
            },

            setTheme(themeName) {
                this.current = themeName;
                localStorage.setItem('narumon-theme', themeName);
                document.body.className = `theme-${themeName}`;
                document.querySelectorAll('.theme-option').forEach(el => el.classList.remove('active'));
                const activeBtn = document.getElementById(`opt-${themeName}`);
                if(activeBtn) activeBtn.classList.add('active');

                if (this.animationId) cancelAnimationFrame(this.animationId);
                this.particles = [];
                this.initParticles(themeName);
                this.animate();
            },

            initParticles(theme) {
                this.particles = [];
                if (theme === 'galaxy') {
                    for(let i=0; i<100; i++) this.particles.push(new Star(this.width, this.height));
                    for(let i=0; i<5; i++) this.particles.push(new UFO(this.width, this.height));
                    for(let i=0; i<3; i++) this.particles.push(new Meteor(this.width, this.height));

                } else if (theme === 'forest') {
                    for(let i=0; i<50; i++) this.particles.push(new Pollen(this.width, this.height));
                    for(let i=0; i<30; i++) this.particles.push(new Leaf(this.width, this.height));
                    for(let i=0; i<8; i++) this.particles.push(new Tree(this.width, this.height, i));
                    for(let i=0; i<150; i++) this.particles.push(new Grass(this.width, this.height, i));

                } else if (theme === 'ocean') {
                    this.particles.push(new OceanSky(this.width, this.height));
                    this.particles.push(new MountainLayer(this.width, this.height));
                    this.particles.push(new WaveLayer(this.width, this.height, 0));
                    this.particles.push(new WaveLayer(this.width, this.height, 1));
                    this.particles.push(new Ship(this.width, this.height));
                    for(let i=0; i<3; i++) this.particles.push(new Dolphin(this.width, this.height));
                    this.particles.push(new WaveLayer(this.width, this.height, 2));
                    
                } else if (theme === 'futurecity') {
                    this.particles.push(new SkylineLayer(this.width, this.height, 0));
                    this.particles.push(new SkylineLayer(this.width, this.height, 1));
                    this.particles.push(new SkylineLayer(this.width, this.height, 2));
                    for(let i=0; i<15; i++) this.particles.push(new DataStream(this.width, this.height));
                    for(let i=0; i<8; i++) this.particles.push(new Drone(this.width, this.height));
                    for(let i=0; i<4; i++) this.particles.push(new Beam(this.width, this.height));
                }
            },

            animate() {
                this.ctx.clearRect(0, 0, this.width, this.height);
                this.particles.forEach(p => {
                    p.update();
                    p.draw(this.ctx);
                });
                this.animationId = requestAnimationFrame(() => this.animate());
            }
        };

        // --- ASSETS (ALL PRESERVED) ---
        class Star {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random() * this.w; this.y = Math.random() * this.h; this.size = Math.random() * 1.5; this.alpha = Math.random(); }
            update() { this.alpha = 0.5 + Math.sin(Date.now() * 0.001 * Math.random()) * 0.5; }
            draw(ctx) { ctx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI*2); ctx.fill(); }
        }
        class UFO {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random() > 0.5 ? -100 : this.w + 100; this.y = Math.random() * (this.h * 0.6); this.speed = (Math.random() * 2 + 1) * (this.x < 0 ? 1 : -1); this.lightTimer = 0; }
            update() { this.x += this.speed; this.lightTimer++; if ((this.speed > 0 && this.x > this.w + 150) || (this.speed < 0 && this.x < -150)) this.reset(); }
            draw(ctx) { ctx.save(); ctx.translate(this.x, this.y); ctx.fillStyle = 'rgba(100, 200, 255, 0.4)'; ctx.beginPath(); ctx.arc(0, -5, 15, Math.PI, 0); ctx.fill(); ctx.fillStyle = '#444'; ctx.beginPath(); ctx.ellipse(0, 0, 30, 8, 0, 0, Math.PI*2); ctx.fill(); const colors = ['#f00', '#0f0', '#00f', '#ff0']; for(let i=0; i<3; i++) { ctx.fillStyle = colors[(Math.floor(this.lightTimer/10) + i) % 4]; ctx.beginPath(); ctx.arc(-15 + (i*15), 0, 3, 0, Math.PI*2); ctx.fill(); } ctx.restore(); }
        }
        class Meteor {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random() * this.w * 1.5; this.y = -100; this.speed = Math.random() * 5 + 4; this.len = Math.random() * 100 + 50; }
            update() { this.x -= this.speed; this.y += this.speed * 0.6; if (this.x < -200 || this.y > this.h + 200) this.reset(); }
            draw(ctx) { const grad = ctx.createLinearGradient(this.x, this.y, this.x + this.len, this.y - this.len * 0.6); grad.addColorStop(0, '#ffaa00'); grad.addColorStop(1, 'transparent'); ctx.strokeStyle = grad; ctx.lineWidth = 3; ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(this.x + this.len, this.y - this.len * 0.6); ctx.stroke(); }
        }
        class Tree {
            constructor(w, h, index) { this.w = w; this.h = h; this.x = (w / 8) * index + (Math.random() * 50); this.baseY = h; this.height = 150 + Math.random() * 100; this.swayOffset = Math.random() * 100; }
            update() {}
            draw(ctx) { const sway = Math.sin((Date.now() + this.swayOffset)/1000) * 5; ctx.save(); ctx.translate(this.x, this.baseY); ctx.fillStyle = '#3e2723'; ctx.fillRect(-5, -this.height/2, 10, this.height/2); ctx.translate(0, -this.height/2); ctx.rotate(sway * Math.PI / 180); ctx.fillStyle = '#1b5e20'; ctx.beginPath(); ctx.moveTo(0, -this.height); ctx.lineTo(-40, 0); ctx.lineTo(40, 0); ctx.fill(); ctx.restore(); }
        }
        class Grass {
            constructor(w, h, i) { this.w = w; this.h = h; this.x = Math.random() * w; this.hScale = Math.random() * 20 + 30; this.swayRate = Math.random() * 0.002 + 0.001; }
            update() {}
            draw(ctx) { const sway = Math.sin(Date.now() * this.swayRate + this.x) * 10; ctx.strokeStyle = '#4ade80'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(this.x, this.h); ctx.quadraticCurveTo(this.x + sway, this.h - this.hScale/2, this.x + sway*1.5, this.h - this.hScale); ctx.stroke(); }
        }
        class Leaf {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random()*this.w; this.y = -50; this.speedY=1+Math.random(); this.ang=0; }
            update() { this.y+=this.speedY; this.x+=Math.sin(this.y*0.02); if(this.y>this.h)this.reset(); }
            draw(ctx) { ctx.save(); ctx.translate(this.x, this.y); ctx.fillStyle = '#a3e635'; ctx.beginPath(); ctx.arc(0,0,3,0,Math.PI*2); ctx.fill(); ctx.restore(); }
        }
        class Pollen {
             constructor(w, h) { this.w = w; this.h = h; this.reset(); }
             reset() { this.x = Math.random()*this.w; this.y = Math.random()*this.h; }
             update() { this.y-=0.5; this.x+=Math.sin(this.y*0.05); if(this.y<0)this.y=this.h; }
             draw(ctx) { ctx.fillStyle = '#fbbf24'; ctx.globalAlpha=0.5; ctx.beginPath(); ctx.arc(this.x,this.y,1,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1; }
        }
        class OceanSky {
            constructor(w, h) {
                this.w = w; this.h = h;
                this.stars = [];
                for(let i=0; i<150; i++) {
                    this.stars.push({ x: Math.random() * w, y: Math.random() * (h * 0.7), size: Math.random() * 1.5, twinkle: Math.random() * Math.PI * 2 });
                }
            }
            update() {}
            draw(ctx) {
                const time = Date.now();
                const cycle = (Math.sin(time * Math.PI * 2 / 30000) + 1) / 2; // 0 = Night, 1 = Day (Sunset)

                // Sky Gradient changing by cycle
                const rTop = Math.floor(5 + cycle * (30 - 5));
                const gTop = Math.floor(10 + cycle * (15 - 10));
                const bTop = Math.floor(25 + cycle * (40 - 25));

                const rBot = Math.floor(10 + cycle * (240 - 10));
                const gBot = Math.floor(25 + cycle * (100 - 25));
                const bBot = Math.floor(45 + cycle * (40 - 45));

                const grad = ctx.createLinearGradient(0, 0, 0, this.h);
                grad.addColorStop(0, `rgb(${rTop}, ${gTop}, ${bTop})`);
                grad.addColorStop(1, `rgb(${rBot}, ${gBot}, ${bBot})`);

                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, this.w, this.h);

                // Stars fading out during the day
                const starAlpha = Math.max(0, 1 - cycle * 2);
                if (starAlpha > 0) {
                    this.stars.forEach(s => {
                        const alpha = (0.3 + Math.sin(time * 0.002 + s.twinkle) * 0.7) * starAlpha;
                        ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                        ctx.beginPath(); ctx.arc(s.x, s.y, s.size, 0, Math.PI*2); ctx.fill();
                    });
                }
                
                // Orbiting Sun and Moon
                const angle = time * Math.PI * 2 / 30000;
                
                // Draw Sun
                const sunX = this.w / 2 + Math.cos(angle - Math.PI/2) * (this.w * 0.45);
                const sunY = this.h * 0.85 + Math.sin(angle - Math.PI/2) * (this.h * 0.65);
                if (sunY < this.h + 100) {
                    ctx.fillStyle = 'rgba(255, 150, 50, 0.9)'; ctx.beginPath(); ctx.arc(sunX, sunY, 60, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = 'rgba(255, 150, 50, 0.3)'; ctx.beginPath(); ctx.arc(sunX, sunY, 120, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = 'rgba(255, 100, 0, 0.1)'; ctx.beginPath(); ctx.arc(sunX, sunY, 200, 0, Math.PI*2); ctx.fill();
                }

                // Draw Moon
                const moonX = this.w / 2 + Math.cos(angle + Math.PI/2) * (this.w * 0.45);
                const moonY = this.h * 0.85 + Math.sin(angle + Math.PI/2) * (this.h * 0.65);
                if (moonY < this.h + 100) {
                    ctx.fillStyle = 'rgba(200, 220, 255, 0.9)'; ctx.beginPath(); ctx.arc(moonX, moonY, 40, 0, Math.PI*2); ctx.fill();
                    ctx.fillStyle = 'rgba(200, 220, 255, 0.1)'; ctx.beginPath(); ctx.arc(moonX, moonY, 80, 0, Math.PI*2); ctx.fill();
                }
            }
        }
        class MountainLayer {
            constructor(w, h) { this.w = w; this.h = h; this.mountains = []; this.generate(); }
            generate() {
                this.mountains.push({ x: this.w * 0.15, y: this.h - 100, w: 700, h: 350, z: 0.5 });
                this.mountains.push({ x: this.w * 0.85, y: this.h - 100, w: 900, h: 450, z: 0.4 });
                this.mountains.push({ x: this.w * 0.45, y: this.h - 120, w: 800, h: 500, z: 0.6 });
                this.mountains.push({ x: this.w * 0.65, y: this.h - 120, w: 600, h: 280, z: 0.7 });
                this.mountains.sort((a,b) => a.z - b.z);
            }
            update() {}
            draw(ctx) {
                const time = Date.now();
                const cycle = (Math.sin(time * Math.PI * 2 / 30000) + 1) / 2; 
                this.mountains.forEach(m => {
                    const r = Math.floor(5 + cycle * (80 * m.z - 5));
                    const g = Math.floor(10 + cycle * (60 * m.z - 10));
                    const b = Math.floor(20 + cycle * (70 * m.z - 20));
                    ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
                    ctx.beginPath(); ctx.moveTo(m.x - m.w/2, this.h); ctx.lineTo(m.x, this.h - m.h); ctx.lineTo(m.x + m.w/2, this.h); ctx.fill();
                });
            }
        }
        class WaveLayer {
            constructor(w, h, layerId) { this.w = w; this.h = h; this.layerId = layerId; this.offset = layerId * 100; }
            update() {}
            draw(ctx) { 
                const time = Date.now();
                const cycle = (Math.sin(time * Math.PI * 2 / 30000) + 1) / 2;
                
                let r, g, b, a;
                if (this.layerId === 0) {
                    r = 15 + cycle * (30 - 15); g = 30 + cycle * (58 - 30); b = 60 + cycle * (138 - 60); a = 1;
                } else if (this.layerId === 1) {
                    r = 20 + cycle * (37 - 20); g = 50 + cycle * (99 - 50); b = 100 + cycle * (235 - 100); a = 1;
                } else {
                    r = 30 + cycle * (56 - 30); g = 80 + cycle * (189 - 80); b = 140 + cycle * (248 - 140); a = 0.6;
                }

                ctx.fillStyle = `rgba(${Math.floor(r)}, ${Math.floor(g)}, ${Math.floor(b)}, ${a})`; 
                ctx.beginPath(); ctx.moveTo(0, this.h); 
                for(let x = 0; x <= this.w; x += 10) { 
                    const y = Math.sin(x * 0.005 + (time * 0.001) + this.offset) * 20 + (this.h - 100 + (this.layerId * 40)); 
                    ctx.lineTo(x, y); 
                } 
                ctx.lineTo(this.w, this.h); ctx.fill(); 
            }
        }
        class Ship {
            constructor(w, h) { this.w = w; this.h = h; this.x = -200; this.y = h - 140; }
            update() { this.x += 0.5; if(this.x > this.w + 200) this.x = -200; }
            draw(ctx) { 
                const time = Date.now();
                const cycle = (Math.sin(time * Math.PI * 2 / 30000) + 1) / 2;
                const bright = Math.floor(100 + cycle * 155);
                const redBright = Math.floor(100 + cycle * 139);

                ctx.save(); ctx.translate(this.x, this.y + Math.sin(time*0.002)*5); 
                ctx.fillStyle = `rgb(${bright}, ${bright}, ${bright})`; 
                ctx.fillRect(0, 20, 150, 30); 
                ctx.beginPath(); ctx.moveTo(150, 20); ctx.lineTo(190, 20); ctx.lineTo(150, 50); ctx.fill(); 
                
                ctx.fillStyle = `rgb(${redBright}, 40, 40)`; 
                ctx.fillRect(30, -10, 20, 30); ctx.fillRect(80, -10, 20, 30); 
                
                // Turn on cabin lights at night
                if (cycle < 0.3) {
                    ctx.fillStyle = 'rgba(255, 255, 150, 0.9)';
                    const wx = [10, 30, 50, 70, 90, 110, 130];
                    wx.forEach(x => ctx.fillRect(x, 30, 10, 10));
                }
                ctx.restore(); 
            }
        }
        class Dolphin {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random() * (this.w - 200) + 100; this.y = this.h; this.vy = -15 - Math.random() * 5; this.vx = (Math.random() - 0.5) * 4; this.active = false; this.wait = Math.random() * 200 + 100; }
            update() { if (this.wait > 0) { this.wait--; if(this.wait<=0) this.active=true; return; } if (this.active) { this.x += this.vx; this.y += this.vy; this.vy += 0.5; if (this.y > this.h + 50) this.reset(); } }
            draw(ctx) { if(!this.active) return; ctx.save(); ctx.translate(this.x, this.y); const angle = Math.atan2(this.vy, this.vx); ctx.rotate(angle); ctx.fillStyle = '#94a3b8'; ctx.beginPath(); ctx.ellipse(0, 0, 20, 8, 0, 0, Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.moveTo(-10, -5); ctx.lineTo(-5, -15); ctx.lineTo(0, -5); ctx.fill(); ctx.restore(); }
        }
        class SkylineLayer {
            constructor(w, h, layerId) { this.w = w; this.h = h; this.layerId = layerId; this.buildings = []; this.speed = (layerId + 1) * 0.1; this.offsetX = 0; this.color = layerId === 0 ? '#111827' : (layerId === 1 ? '#1f2937' : '#374151'); this.generate(); }
            generate() { let currentX = 0; while(currentX < this.w * 2) { const bw = 30 + Math.random() * 60; const bh = 50 + Math.random() * (this.layerId + 1) * 100; let windows = []; if(this.layerId === 2) { for(let wx=5; wx<bw-5; wx+=8) { for(let wy=10; wy<bh-10; wy+=12) { if(Math.random() > 0.3) windows.push({x: wx, y: wy}); } } } this.buildings.push({ x: currentX, w: bw, h: bh, windows: windows }); currentX += bw; } }
            update() { this.offsetX -= this.speed; if(this.offsetX < -this.w) this.offsetX = 0; }
            draw(ctx) { ctx.save(); ctx.translate(this.offsetX, 0); for(let i=0; i<2; i++) { ctx.save(); ctx.translate(i * (this.w), 0); this.buildings.forEach(b => { ctx.fillStyle = this.color; ctx.fillRect(b.x % this.w, this.h - b.h, b.w, b.h); ctx.fillStyle = `rgba(0, 243, 255, ${0.3 + Math.random()*0.4})`; b.windows.forEach(win => { if(Math.random() > 0.01) ctx.fillRect((b.x % this.w) + win.x, this.h - b.h + win.y, 4, 6); }); }); ctx.restore(); } ctx.restore(); }
        }
        class Drone {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random() > 0.5 ? -50 : this.w + 50; this.y = Math.random() * (this.h * 0.5); this.speed = (Math.random() * 1 + 0.5) * (this.x < 0 ? 1 : -1); }
            update() { this.x += this.speed; if(this.x < -100 || this.x > this.w + 100) this.reset(); }
            draw(ctx) { ctx.save(); ctx.translate(this.x, this.y); ctx.fillStyle = '#fff'; ctx.beginPath(); ctx.arc(0, 0, 2, 0, Math.PI*2); ctx.fill(); if(Math.floor(Date.now() / 200) % 2 === 0) { ctx.fillStyle = '#f00'; ctx.beginPath(); ctx.arc(0, 0, 4, 0, Math.PI*2); ctx.fill(); } ctx.restore(); }
        }
        class DataStream {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random() * this.w; this.y = this.h; this.len = Math.random() * 50 + 20; this.speed = Math.random() * 2 + 1; this.alpha = Math.random() * 0.5 + 0.2; }
            update() { this.y -= this.speed; if(this.y < 0) this.reset(); }
            draw(ctx) { ctx.strokeStyle = `rgba(0, 243, 255, ${this.alpha})`; ctx.lineWidth = 1; ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(this.x, this.y + this.len); ctx.stroke(); }
        }
        class Beam {
            constructor(w, h) { this.w = w; this.h = h; this.reset(); }
            reset() { this.x = Math.random() * this.w; this.width = Math.random() * 20 + 10; this.alpha = 0; this.state = 0; this.timer = 0; }
            update() { if(this.state === 0) { this.alpha += 0.005; if(this.alpha > 0.15) this.state = 1; } else if(this.state === 1) { this.timer++; if(this.timer > 100) this.state = 2; } else { this.alpha -= 0.005; if(this.alpha < 0) this.reset(); } }
            draw(ctx) { const grad = ctx.createLinearGradient(this.x, this.h, this.x, 0); grad.addColorStop(0, `rgba(189, 0, 255, ${this.alpha})`); grad.addColorStop(1, 'transparent'); ctx.fillStyle = grad; ctx.fillRect(this.x, 0, this.width, this.h); }
        }

        // --- GLOBAL & UI ---
        function toggleThemePanel() {
            document.getElementById('theme-panel').classList.toggle('open');
            document.getElementById('theme-overlay').classList.toggle('open');
        }

        // --- LANGUAGE SYSTEM ---
        window.currentLang = localStorage.getItem('narumon-lang') || 'th';

        function toggleLanguage() {
            window.currentLang = window.currentLang === 'th' ? 'en' : 'th';
            localStorage.setItem('narumon-lang', window.currentLang);
            applyLanguage();
        }

        function applyLanguage() {
            const langBtn = document.getElementById('lang-toggle-btn');
            if (langBtn) langBtn.innerText = window.currentLang === 'th' ? 'EN' : 'TH';

            // Update static HTML texts
            document.querySelectorAll('.i18n').forEach(el => {
                if (el.dataset[window.currentLang]) {
                    el.innerHTML = el.dataset[window.currentLang];
                }
            });

            // Re-render JS dynamic lists if visible
            if (document.getElementById('reports-page').style.display === 'block') {
                renderReportsList();
            }
            
            // Re-render currently active dashboard to update dynamic JS strings
            const activePage = Array.from(document.querySelectorAll('main')).find(m => m.style.display === 'block' || m.style.display === 'flex');
            if (activePage) {
                if (activePage.id === 'workforce-dashboard-page' && workforceRawData.length > 0) {
                    populateFilterOptions(); processAndRender();
                }
                if (activePage.id === 'recruiting-dashboard-page' && recruitingRawData.length > 0) {
                    populateRecruitingFilters(); processAndRenderRecruiting();
                }
                if (activePage.id === 'benefit-dashboard-page' && benefitRawData.length > 0) {
                    populateBenefitFilters(); processAndRenderBenefit();
                }
                if (activePage.id === 'salary-dashboard-page' && salaryRawData.length > 0) {
                    populateSalaryFilters(); processAndRenderSalary();
                }
                if (activePage.id === 'welfare-dashboard-page' && welfareRawData.length > 0) {
                    populateWelfareFilters(); processAndRenderWelfare();
                }
                if (activePage.id === 'loan-dashboard-page' && loanRawData.length > 0) {
                    updateLoanDropdowns(); processAndRenderLoan();
                }
                if (activePage.id === 'mutual-fund-dashboard-page' && mutualFundRawData.length > 0) {
                    populateMutualFundFilters(); processAndRenderMutualFund();
                }
            }
        }

        // --- REPORTS LOGIC ---
        const reportsData = [
            { id: 'workforce', title: { th: 'แผนอัตรากำลังพลรับเพิ่ม ประจำปี 2569', en: 'Workforce Addition Plan 2026' }, icon: '📈', status: 'active', route: 'workforce-dashboard', desc: { th: 'แดชบอร์ดวางแผนกำลังคน', en: 'Workforce Planning Dashboard' } },
            { id: 'recruiting', title: { th: 'Data_Report Recruiting', en: 'Data_Report Recruiting' }, icon: '👥', status: 'active', route: 'recruiting-dashboard', desc: { th: 'ระบบติดตามการสรรหา', en: 'Recruitment Tracker' } },
            { id: 'salary', title: { th: 'Data_Report ควบคุมงบประมาณด้านเงินเดือน', en: 'Salary Budget Control' }, icon: '💰', status: 'active', route: 'salary-dashboard', desc: { th: 'ควบคุมงบประมาณและสถานะงาน', en: 'Budget & Task Control' } },
            { id: 'welfare', title: { th: 'Data_Report ควบคุมแผนงบประมาณด้านสวัสดิการ', en: 'Welfare Budget Control' }, icon: '🏥', status: 'active', route: 'welfare-dashboard', desc: { th: 'ควบคุมงบประมาณและสถานะงานสวัสดิการ', en: 'Welfare Budget & Task Control' } },
            { id: 'benefits', title: { th: 'Data_Report Benefit (Task Monitor)', en: 'Benefit (Task Monitor)' }, icon: '📋', status: 'active', route: 'benefit-dashboard', desc: { th: 'แดชบอร์ดติดตามงาน', en: 'Task Monitoring Dashboard' } }
        ];

        function renderReportsList() {
            const container = document.querySelector('.reports-list');
            if(!container) return;
            
            container.innerHTML = reportsData.map((r, index) => {
                let badgeClass = '';
                let badgeText = '';
                let dotHtml = '';
                let clickAction = '';
                
                if (r.status === 'active') {
                    badgeClass = 'status-active';
                    badgeText = window.currentLang === 'th' ? 'ใช้งาน' : 'Active';
                    dotHtml = '<span class="status-dot"></span>';
                    clickAction = `showPage('${r.route}')`;
                } else if (r.status === 'draft') {
                    badgeClass = 'status-draft';
                    badgeText = window.currentLang === 'th' ? 'แบบร่าง' : 'Draft';
                    dotHtml = '';
                    clickAction = `showToast('${window.currentLang === 'th' ? 'รายงานนี้อยู่ในสถานะแบบร่าง' : 'This report is currently in Draft mode.'}')`;
                } else {
                    badgeClass = 'status-coming';
                    badgeText = window.currentLang === 'th' ? 'เร็วๆ นี้' : 'Coming Soon';
                    dotHtml = '';
                    clickAction = `showToast('${window.currentLang === 'th' ? 'ระบบนี้กำลังอยู่ระหว่างการพัฒนา' : 'This report module is under development.'}')`;
                }

                const styleDelay = `animation-delay: ${index * 0.1}s`;

                return `
                    <div class="report-card animate" onclick="${clickAction}" style="${styleDelay}">
                        <div class="status-badge ${badgeClass}">
                            ${dotHtml} ${badgeText}
                        </div>
                        <div class="report-info">
                            <span class="report-number">0${index + 1}</span>
                            <div class="report-icon">${r.icon}</div>
                            <div class="report-text-group">
                                <span class="report-name">${r.title[window.currentLang]}</span>
                                <span class="report-desc">${r.desc[window.currentLang]}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            const msgSpan = document.getElementById('toast-message');
            msgSpan.innerText = msg;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 2000);
        }

        // --- ANIMATION UTILS ---
        function animateValue(id, start, end, duration) {
            if (start === end) {
                const el = document.getElementById(id);
                if(el) el.innerHTML = end;
                return;
            }
            const obj = document.getElementById(id);
            if(!obj) return;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 4);
                obj.innerHTML = Math.floor(easeOut * (end - start) + start);
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                } else {
                    obj.innerHTML = end;
                }
            };
            window.requestAnimationFrame(step);
        }

        function animateCurrency(id, endVal) {
            const obj = document.getElementById(id);
            if (!obj) return;
            let startVal = parseFloat(obj.getAttribute('data-val')) || 0;
            if (startVal === endVal) {
                obj.innerHTML = endVal.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                return;
            }
            obj.setAttribute('data-val', endVal);
            const duration = 800;
            let startTimestamp = null;
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 4);
                const current = easeOut * (endVal - startVal) + startVal;
                obj.innerHTML = current.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                if (progress < 1) window.requestAnimationFrame(step);
                else obj.innerHTML = endVal.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            };
            window.requestAnimationFrame(step);
        }

        // --- APP LOGIC ---
        let workforceRawData = [];
        let recruitingRawData = [];
        
        const MONTH_ORDER = {
            "JAN": 1, "FEB": 2, "MAR": 3, "APR": 4, "MAY": 5, "JUN": 6, "JUL": 7, "AUG": 8, "SEP": 9, "OCT": 10, "NOV": 11, "DEC": 12,
            "Jan": 1, "Feb": 2, "Mar": 3, "Apr": 4, "May": 5, "Jun": 6, "Jul": 7, "Aug": 8, "Sep": 9, "Oct": 10, "Nov": 11, "Dec": 12,
            "January": 1, "February": 2, "March": 3, "April": 4, "May": 5, "June": 6, "July": 7, "August": 8, "September": 9, "October": 10, "November": 11, "December": 12,
            "มกราคม": 1, "กุมภาพันธ์": 2, "มีนาคม": 3, "เมษายน": 4, "พฤษภาคม": 5, "มิถุนายน": 6, "กรกฎาคม": 7, "สิงหาคม": 8, "กันยายน": 9, "ตุลาคม": 10, "พฤศจิกายน": 11, "ธันวาคม": 12,
            "11": 11, "12": 12
        };

        let isManagementUnlocked = false;

        function showPage(pageId) {
            // ระบบตรวจสอบรหัสผ่านสำหรับหน้า Management
            if (pageId === 'management' && !isManagementUnlocked) {
                const modal = document.getElementById('password-modal');
                const input = document.getElementById('mgmt-password-input');
                modal.classList.add('show');
                setTimeout(() => input.focus(), 100);
                return; // หยุดการทำงาน ไม่ให้เปลี่ยนหน้าจนกว่าจะใส่รหัสถูก
            }

            // ===== START WELFARE UPDATE (ROUTING) =====
            const pages = ['home-page', 'about-page', 'reports-page', 'workforce-dashboard-page', 'recruiting-dashboard-page', 'benefit-dashboard-page', 'salary-dashboard-page', 'welfare-dashboard-page', 'dashboard-center-page', 'loan-dashboard-page', 'mutual-fund-dashboard-page', 'management-page', 'employee-welfare-dashboard-page'];
            // ===== END WELFARE UPDATE (ROUTING) =====
            
            pages.forEach(p => {
                const el = document.getElementById(p);
                if (el) el.style.display = 'none';
            });
            const target = document.getElementById(pageId + '-page');
            if (target) target.style.display = (pageId === 'home') ? 'flex' : 'block';
            
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            let navId = `nav-${pageId.replace('-page', '')}`;
            
            // Adjust active state for sub-dashboards and reports
            if (pageId.includes('dashboard') && pageId !== 'dashboard-center') navId = 'nav-reports';
            
            // ===== START WELFARE UPDATE (NAV ID) =====
            if (pageId === 'loan-dashboard' || pageId === 'mutual-fund-dashboard' || pageId === 'employee-welfare-dashboard') navId = 'nav-dashboard-center';
            // ===== END WELFARE UPDATE (NAV ID) =====
            
            if (pageId === 'dashboard-center') navId = 'nav-dashboard-center';
            if (pageId === 'home') navId = 'nav-home';
            if (pageId === 'about') navId = 'nav-about';
            if (pageId === 'reports') navId = 'nav-reports';
            if (pageId === 'management') navId = 'nav-management';

            const navEl = document.getElementById(navId);
            if(navEl) navEl.classList.add('active');
            window.scrollTo(0, 0);
            
            if (pageId === 'workforce-dashboard') fetchWorkforceData();
            if (pageId === 'recruiting-dashboard') fetchRecruitingData();
            if (pageId === 'benefit-dashboard') fetchBenefitData();
            if (pageId === 'salary-dashboard') fetchSalaryData();
            if (pageId === 'welfare-dashboard') fetchWelfareData();
            if (pageId === 'loan-dashboard') fetchLoanData();
            if (pageId === 'mutual-fund-dashboard') fetchMutualFundData();
            
            // ===== START WELFARE UPDATE (DATA FETCH TRIGGER) =====
            if (pageId === 'employee-welfare-dashboard') welfare_fetchData();
            // ===== END WELFARE UPDATE (DATA FETCH TRIGGER) =====
            
            if (pageId === 'reports') {
                renderReportsList(); 
            }
            if (pageId === 'reports' || pageId === 'about' || pageId === 'dashboard-center' || pageId === 'management') {
                document.querySelectorAll('.animate').forEach((el, i) => {
                    el.style.animationDelay = `${i * 0.1}s`;
                    el.classList.remove('animate');
                    void el.offsetWidth;
                    el.classList.add('animate');
                });
            }
        }

        // ==========================================
        // MODULE: MANAGEMENT CENTER
        // ==========================================
        const mgmtLinks = {
            "1IgUh9g7kYsC2tIvg0AzE5wTqMq2HinlbEWjhGxRqFEk": "https://docs.google.com/spreadsheets/d/1IgUh9g7kYsC2tIvg0AzE5wTqMq2HinlbEWjhGxRqFEk/edit?usp=sharing",
            "1jGvSwO-ymtAo63NYbvK7o4raGijdQezm0Iu2IEXqIE8": "https://docs.google.com/spreadsheets/d/1jGvSwO-ymtAo63NYbvK7o4raGijdQezm0Iu2IEXqIE8/edit?usp=drive_link",
            "1ONbPfC9QtiMrGGTmNktTRlMiUxhLsbaQi4GQVjH4e5g": "https://docs.google.com/spreadsheets/d/1ONbPfC9QtiMrGGTmNktTRlMiUxhLsbaQi4GQVjH4e5g/edit?usp=drive_link",
            "1yfzlrtgIW2eXbRXAQ_3pW2e6pzdpHxm4vRt-gbKhsEQ": "https://docs.google.com/spreadsheets/d/1yfzlrtgIW2eXbRXAQ_3pW2e6pzdpHxm4vRt-gbKhsEQ/edit?usp=drive_link",
            "152oYyJbd6_gdNAh8cvlD-Ozi4qkwa3LmbPTU0N3F4OA": "https://docs.google.com/spreadsheets/d/152oYyJbd6_gdNAh8cvlD-Ozi4qkwa3LmbPTU0N3F4OA/edit?usp=sharing",
            "1GECHMYtklYNeWBybjFJcwKGT1PgG5dsAMzEQdsX6fmk": "https://docs.google.com/spreadsheets/d/1GECHMYtklYNeWBybjFJcwKGT1PgG5dsAMzEQdsX6fmk/edit?usp=drive_link",
            "1hpF_YkbGEUvNNYPa1AO9Cmsf7Y0MMUwh1SPI4i0T7_Q": "https://docs.google.com/spreadsheets/d/1hpF_YkbGEUvNNYPa1AO9Cmsf7Y0MMUwh1SPI4i0T7_Q/edit?usp=drive_link",
            "1RxK5-yKujw4AXxBYYjXiNc3naNqEUWpvOA08YlG7dDc": "https://docs.google.com/spreadsheets/d/1RxK5-yKujw4AXxBYYjXiNc3naNqEUWpvOA08YlG7dDc/edit?usp=sharing"
        };

        // --- Custom Dropdown Scripts ---
        function toggleCustomSelect() {
            document.getElementById('custom-select-wrap').classList.toggle('open');
        }

        // เพิ่มฟังก์ชันสำหรับอัปเดตค่าเมื่อเลือก Dropdown 
        function selectCustomOption(value, textTh, textEn) {
            // 1. อัปเดตค่าให้ select ที่ซ่อนอยู่เพื่อส่งไปประมวลผล
            const selectEl = document.getElementById('mgmt-sheet-select');
            if (selectEl) selectEl.value = value;
            
            // 2. อัปเดตข้อความบนปุ่มที่ผู้ใช้มองเห็น
            const trigger = document.getElementById('custom-select-trigger');
            if (trigger) {
                trigger.innerHTML = `<span class="i18n" data-th="${textTh}" data-en="${textEn}">${window.currentLang === 'th' ? textTh : textEn}</span>`;
                trigger.classList.remove('text-flow-animated'); // เอาไฟวิ่งออกเมื่อเลือกแล้ว
            }
            
            // 3. ปิด Dropdown
            const wrap = document.getElementById('custom-select-wrap');
            if (wrap) wrap.classList.remove('open');
        }

        function applyLanguage() {
            const langBtn = document.getElementById('lang-toggle-btn');
            if (langBtn) langBtn.innerText = window.currentLang === 'th' ? 'EN' : 'TH';

            // Update static HTML texts
            document.querySelectorAll('.i18n').forEach(el => {
                if (el.dataset[window.currentLang]) {
                    el.innerHTML = el.dataset[window.currentLang];
                }
            });

            // Re-render JS dynamic lists if visible
            if (document.getElementById('reports-page').style.display === 'block') {
                renderReportsList();
            }
            
            // Re-render currently active dashboard to update dynamic JS strings
            const activePage = Array.from(document.querySelectorAll('main')).find(m => m.style.display === 'block' || m.style.display === 'flex');
            if (activePage) {
                if (activePage.id === 'workforce-dashboard-page' && workforceRawData.length > 0) {
                    populateFilterOptions(); processAndRender();
                }
                if (activePage.id === 'recruiting-dashboard-page' && recruitingRawData.length > 0) {
                    populateRecruitingFilters(); processAndRenderRecruiting();
                }
                if (activePage.id === 'benefit-dashboard-page' && benefitRawData.length > 0) {
                    populateBenefitFilters(); processAndRenderBenefit();
                }
                if (activePage.id === 'salary-dashboard-page' && salaryRawData.length > 0) {
                    populateSalaryFilters(); processAndRenderSalary();
                }
                if (activePage.id === 'welfare-dashboard-page' && welfareRawData.length > 0) {
                    populateWelfareFilters(); processAndRenderWelfare();
                }
                if (activePage.id === 'loan-dashboard-page' && loanRawData.length > 0) {
                    updateLoanDropdowns(); processAndRenderLoan();
                }
                if (activePage.id === 'mutual-fund-dashboard-page' && mutualFundRawData.length > 0) {
                    populateMutualFundFilters(); processAndRenderMutualFund();
                }
                // ===== START WELFARE UPDATE (LANGUAGE SUPPORT) =====
                if (activePage.id === 'employee-welfare-dashboard-page' && typeof welfare_rawData !== 'undefined' && welfare_rawData.length > 0) {
                    welfare_populateFilters(); welfare_processAndRender();
                }
                // ===== END WELFARE UPDATE (LANGUAGE SUPPORT) =====
            }
        }

        function checkPassword() {
            const input = document.getElementById('mgmt-password-input');
            const passBox = document.getElementById('password-box-container');
            const msg = document.getElementById('auth-message');
            const icon = document.getElementById('auth-icon');
            const val = input.value;

            // รีเซ็ตสถานะเก่าก่อน
            passBox.classList.remove('error-state', 'success-state');
            msg.className = 'auth-msg';
            void passBox.offsetWidth; // บังคับ reflow ให้เล่นแอนิเมชันซ้ำได้

            if (val === "") {
                passBox.classList.add('error-state');
                msg.textContent = "กรุณากรอกรหัสผ่านก่อน";
                msg.classList.add('error');
                input.focus();
                return;
            }

            // ตั้งรหัสผ่านที่นี่ (รองรับทั้งคำว่า Narumon และ 1234)
            if (val === 'Narumon' || val === '1234') {
                // ใส่รหัสถูก (กรอบเขียว)
                passBox.classList.add('success-state');
                msg.textContent = 'เข้าสู่ระบบแก้ไขข้อมูลสำเร็จ';
                msg.classList.add('success');
                icon.textContent = '🔓';
                input.disabled = true;
                
                setTimeout(() => {
                    isManagementUnlocked = true;
                    closePasswordModal();
                    showPage('management');
                }, 1500);

            } else {
                // ใส่รหัสผิด (กรอบแดง + สั่น)
                passBox.classList.add('error-state');
                msg.textContent = 'ใส่รหัสผ่านผิดกรุณาใส่ใหม่';
                msg.classList.add('error');
                input.value = '';
                input.focus();
            }
        }

        // รองรับการกด Enter เพื่อส่งรหัสผ่าน
        document.getElementById('mgmt-password-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });

        // ปิด Dropdown เมื่อคลิกที่พื้นที่ว่างอื่น
        document.addEventListener('click', function(e) {
            const wrap = document.getElementById('custom-select-wrap');
            if (wrap && !wrap.contains(e.target)) {
                wrap.classList.remove('open');
            }
        });

        function loadManagementSheet() {
            const selectEl = document.getElementById('mgmt-sheet-select');
            const selectVal = selectEl.value;
            if (!selectVal) {
                showToast(window.currentLang === 'th' ? 'กรุณาเลือกฐานข้อมูลที่ต้องการก่อน' : 'Please select a database first');
                return;
            }
            
            const iframeWrapper = document.getElementById('mgmt-iframe-wrapper');
            const iframe = document.getElementById('mgmt-iframe');
            const titleText = document.getElementById('mgmt-iframe-title-text');
            
            // ดึงชื่อชีตจาก Trigger โดยแยกรองรับ 2 ภาษา
            const triggerSpan = document.querySelector('#custom-select-trigger .i18n');
            let sheetNameTh = triggerSpan.getAttribute('data-th') || 'ฐานข้อมูล';
            let sheetNameEn = triggerSpan.getAttribute('data-en') || 'Database';
            
            // ตัดไอคอนและตัวเลขข้างหน้าออกให้ดูสะอาดขึ้น
            sheetNameTh = sheetNameTh.replace(/^[📊🎯💰🏥🎁💸🤝✨]\s*(?:[0-9]+\.\s*)?/, '').replace(/--.*--/, '').trim() || 'ฐานข้อมูล';
            sheetNameEn = sheetNameEn.replace(/^[📊🎯💰🏥🎁💸🤝✨]\s*(?:[0-9]+\.\s*)?/, '').replace(/--.*--/, '').trim() || 'Database';
            
            // อัปเดต data-attribute เพื่อให้ระบบแปลภาษา (applyLanguage) อัปเดตข้อความนี้ได้แบบ Real-time
            const prefixTh = "กำลังแก้ไข: ";
            const prefixEn = "Editing: ";
            titleText.setAttribute('data-th', prefixTh + sheetNameTh);
            titleText.setAttribute('data-en', prefixEn + sheetNameEn);
            titleText.innerText = window.currentLang === 'th' ? (prefixTh + sheetNameTh) : (prefixEn + sheetNameEn);
            
            // Add rm=minimal to hide Google Sheets menubar for cleaner embed UI
            iframe.src = mgmtLinks[selectVal] + "&rm=minimal";
            
            iframeWrapper.style.display = 'flex';
            setTimeout(() => iframeWrapper.classList.add('show'), 50);
            
            // เลื่อนจอลงมาให้เห็นหน้าต่างแก้ไขแบบพอดี
            setTimeout(() => {
                iframeWrapper.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 300);
        }

        // ฟังก์ชันปิดหน้าต่างแก้ไขข้อมูล
        function closeManagementSheet() {
            const iframeWrapper = document.getElementById('mgmt-iframe-wrapper');
            const iframe = document.getElementById('mgmt-iframe');
            
            iframeWrapper.classList.remove('show');
            setTimeout(() => {
                iframeWrapper.style.display = 'none';
                iframe.src = ''; // เคลียร์ iFrame เพื่อประหยัด Memory
                
                // เลื่อนจอกลับขึ้นไปด้านบน
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }, 500);
        }

        function openManagementSheetNewTab() {
            const selectVal = document.getElementById('mgmt-sheet-select').value;
            if (!selectVal) {
                showToast(window.currentLang === 'th' ? 'กรุณาเลือกฐานข้อมูลที่ต้องการก่อน' : 'Please select a database first');
                return;
            }
            window.open(mgmtLinks[selectVal], '_blank');
        }

        // ==========================================
        // MODULE 1: WORKFORCE DASHBOARD
        // ==========================================
        async function fetchWorkforceData() {
            const sheetId = '1IgUh9g7kYsC2tIvg0AzE5wTqMq2HinlbEWjhGxRqFEk';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            try {
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));
                const rows = json.table.rows;
                workforceRawData = rows.map(r => ({
                    division: r.c[2]?.v || '-',
                    dept: r.c[3]?.v || '-',
                    company: r.c[4]?.v || '-',
                    position: r.c[5]?.v || 'ไม่ระบุตำแหน่ง',
                    rate: parseInt(r.c[6]?.v || 0),
                    month: r.c[7]?.v || 'ไม่ระบุ',
                    status: r.c[16]?.v || '',
                    startDate: r.c[17]?.f || r.c[17]?.v || ''
                }));
                populateFilterOptions();
                processAndRender();
            } catch (err) { console.error("Fetch Error:", err); }
        }

        function populateFilterOptions() {
            const depts = [...new Set(workforceRawData.map(d => d.dept))].sort();
            const deptDropdown = document.getElementById('filter-dept-select');
            deptDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Departments)' : 'All Departments'}</option>`;
            depts.forEach(d => deptDropdown.innerHTML += `<option value="${d}">${d}</option>`);

            let months = [...new Set(workforceRawData.map(d => d.month))];
            months.sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));

            const monthDropdown = document.getElementById('filter-month-select');
            monthDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกเดือน (All Months)' : 'All Months'}</option>`;
            months.forEach(m => monthDropdown.innerHTML += `<option value="${m}">${m}</option>`);
        }

        function processAndRender() {
            const deptVal = document.getElementById('filter-dept-select').value;
            const monthVal = document.getElementById('filter-month-select').value;
            const filtered = workforceRawData.filter(item => {
                const matchDept = deptVal === 'all' || item.dept === deptVal;
                const matchMonth = monthVal === 'all' || item.month === monthVal;
                return matchDept && matchMonth;
            });
            updateKpiMetrics(filtered);
            renderDashboardGroups(filtered);
        }

        function updateKpiMetrics(data) {
            const totalPos = data.length;
            const sumRates = data.reduce((s, c) => s + c.rate, 0);
            const sumHired = data.reduce((s, c) => {
                if (c.startDate && c.startDate.trim() !== '') return s + c.rate;
                return s;
            }, 0);
            const missing = sumRates - sumHired;

            animateValue('kpi-total-pos', 0, totalPos, 800);
            animateValue('kpi-sum-rates', 0, sumRates, 800);
            
            document.getElementById('kpi-hired-container').innerHTML = `
                <div class="kpi-list-container">
                    <div class="kpi-list-row">
                        <div class="kpi-list-left">
                            <span class="kpi-dot dot-success"></span>
                            <span class="kpi-list-label">${window.currentLang === 'th' ? 'รับแล้ว' : 'Hired'}</span>
                        </div>
                        <span class="kpi-list-value">${sumHired}</span>
                    </div>
                    <div class="kpi-list-row">
                        <div class="kpi-list-left">
                            <span class="kpi-dot dot-waiting"></span>
                            <span class="kpi-list-label">${window.currentLang === 'th' ? 'รอสรรหา' : 'Pending'}</span>
                        </div>
                        <span class="kpi-list-value">${missing}</span>
                    </div>
                </div>
            `;
        }

        function renderDashboardGroups(data) {
            const container = document.getElementById('dashboard-render-area');
            container.innerHTML = '';
            
            const groupedByMonth = {};
            data.forEach(item => {
                if (!groupedByMonth[item.month]) groupedByMonth[item.month] = [];
                groupedByMonth[item.month].push(item);
            });

            const availableMonths = Object.keys(groupedByMonth).sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));
            
            if (availableMonths.length === 0) {
                container.innerHTML = `<div style="text-align: center; padding: 100px; color: var(--color-text-muted); font-weight: 300;">${window.currentLang === 'th' ? 'ไม่พบข้อมูลที่ตรงกับเงื่อนไขการค้นหา' : 'No data found matching the criteria.'}</div>`;
                return;
            }

            availableMonths.forEach((month, mIdx) => {
                const section = document.createElement('div');
                section.className = 'month-container';
                
                const monthData = groupedByMonth[month];
                const aggregatedGroups = {};

                monthData.forEach(item => {
                    const key = `${item.position}|${item.dept}|${item.company}`;
                    if (!aggregatedGroups[key]) {
                        aggregatedGroups[key] = { position: item.position, dept: item.dept, company: item.company, division: item.division, totalRate: 0, hiredRateSum: 0 };
                    }
                    aggregatedGroups[key].totalRate += item.rate;
                    if (item.startDate && item.startDate.trim() !== '') aggregatedGroups[key].hiredRateSum += item.rate;
                });

                let cardsHtml = '';
                Object.values(aggregatedGroups).forEach((group, gIdx) => {
                    const missing = Math.max(0, group.totalRate - group.hiredRateSum);
                    const isComplete = missing === 0;

                    let ledColor = isComplete ? 'var(--color-success)' : 'var(--color-warning)';
                    let ledGlow = isComplete ? 'rgba(0, 255, 163, 0.25)' : 'rgba(255, 184, 0, 0.25)';

                    cardsHtml += `
                        <div class="work-card" style="--led-color: ${ledColor}; --led-glow: ${ledGlow}; animation-delay: ${(mIdx * 0.1) + (gIdx * 0.05)}s">
                            <span class="job-badge ${isComplete ? 'badge-hired' : 'badge-pending'}">
                                ${isComplete ? (window.currentLang === 'th' ? '✓ ครบตามจำนวน' : '✓ Completed') : (window.currentLang === 'th' ? `! ขาด ${missing} อัตรา` : `! Missing ${missing}`)}
                            </span>
                            <h3 class="job-header-text">${group.position}</h3>
                            <div class="meta-line">📍 <span>${group.company}</span></div>
                            <div class="meta-line">📂 <span>${group.division} / ${group.dept}</span></div>
                            <div class="card-bottom">
                                <div class="footer-col"><span class="footer-label">${window.currentLang === 'th' ? 'อัตรา' : 'Target'}</span><span class="footer-value val-p-rate">${group.totalRate}</span></div>
                                <div class="footer-col"><span class="footer-label">${window.currentLang === 'th' ? 'รับแล้ว' : 'Hired'}</span><span class="footer-value val-p-hired">${group.hiredRateSum}</span></div>
                                <div class="footer-col"><span class="footer-label">${window.currentLang === 'th' ? 'ขาด' : 'Missing'}</span><span class="footer-value val-p-missing">${missing}</span></div>
                            </div>
                        </div>`;
                });
                section.innerHTML = `<div class="month-title-row">${month}</div><div class="job-grid-view">${cardsHtml}</div>`;
                container.appendChild(section);
            });
        }

        // ==========================================
        // MODULE 2: RECRUITING DASHBOARD
        // ==========================================
        async function fetchRecruitingData() {
            const sheetId = '1jGvSwO-ymtAo63NYbvK7o4raGijdQezm0Iu2IEXqIE8';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            
            try {
                document.getElementById('recruiting-render-area').innerHTML = '<div style="text-align: center; padding: 100px; color: var(--color-primary); font-family: var(--font-display); letter-spacing: 2px;">FETCHING INTELLIGENCE...</div>';
                
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));
                const rows = json.table.rows;
                
                recruitingRawData = rows.map(r => ({
                    no: r.c[0]?.v || '',
                    task: r.c[1]?.v || 'ไม่ระบุภารกิจ',
                    owner: r.c[2]?.v || 'ไม่ระบุ',
                    kpi: parseInt(r.c[3]?.v || 0),
                    month: r.c[4]?.v || 'ไม่ระบุเดือน',
                    status: (r.c[5]?.v || '').toString().trim()
                }));
                
                populateRecruitingFilters();
                processAndRenderRecruiting();
            } catch (err) {
                console.error("Fetch Error:", err);
                document.getElementById('recruiting-render-area').innerHTML = '<div style="text-align: center; padding: 100px; color: var(--color-danger);">Failed to load data. Please check connection.</div>';
            }
        }

        function populateRecruitingFilters() {
            const tasks = [...new Set(recruitingRawData.map(d => d.task))].sort();
            const taskDropdown = document.getElementById('rec-filter-owner');
            taskDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Tasks)' : 'All Tasks'}</option>`;
            tasks.forEach(t => {
                if(t !== 'ไม่ระบุภารกิจ' && t !== '') taskDropdown.innerHTML += `<option value="${t}">${t}</option>`;
            });

            let months = [...new Set(recruitingRawData.map(d => d.month))];
            months.sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));
            const monthDropdown = document.getElementById('rec-filter-month');
            monthDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกเดือน (All Months)' : 'All Months'}</option>`;
            months.forEach(m => {
                if(m !== 'ไม่ระบุเดือน' && m !== '') monthDropdown.innerHTML += `<option value="${m}">${m}</option>`;
            });
        }

        function processAndRenderRecruiting() {
            const taskVal = document.getElementById('rec-filter-owner').value;
            const monthVal = document.getElementById('rec-filter-month').value;
            const statusVal = document.getElementById('rec-filter-status').value;

            const filtered = recruitingRawData.filter(item => {
                const s = item.status.toLowerCase();
                const matchTask = taskVal === 'all' || item.task === taskVal;
                const matchMonth = monthVal === 'all' || item.month === monthVal;
                
                let matchStatus = false;
                const isCompleted = s === 'completed';
                const isInProgress = s === 'in progress';
                const isPending = s === 'pending';

                if (statusVal === 'all') matchStatus = true;
                else if (statusVal === 'completed' && isCompleted) matchStatus = true;
                else if (statusVal === 'in progress' && isInProgress) matchStatus = true;
                else if (statusVal === 'pending' && isPending) matchStatus = true;

                return matchTask && matchMonth && matchStatus;
            });

            updateRecruitingKpiMetrics(filtered);
            renderRecruitingGroups(filtered);
        }

        function updateRecruitingKpiMetrics(data) {
            const totalTasks = data.filter(item => item.task && item.task !== 'ไม่ระบุภารกิจ').length;
            const totalKPI = data.reduce((sum, item) => sum + item.kpi, 0);
            
            let completedCount = 0;
            let inProgressCount = 0;
            let pendingCount = 0;

            data.forEach(item => {
                const s = item.status.toLowerCase();
                if (s === 'completed') {
                    completedCount += item.kpi;
                } else if (s === 'in progress') {
                    inProgressCount += item.kpi;
                } else if (s === 'pending') {
                    pendingCount += item.kpi;
                }
            });

            animateValue('r-kpi-tasks', 0, totalTasks, 800);
            animateValue('r-kpi-total', 0, totalKPI, 800);
            
            document.getElementById('r-kpi-status-container').innerHTML = `
                <div class="kpi-list-container">
                    <div class="kpi-list-row">
                        <div class="kpi-list-left">
                            <span class="kpi-dot dot-success"></span>
                            <span class="kpi-list-label">${window.currentLang === 'th' ? 'รับแล้ว (Completed)' : 'Completed'}</span>
                        </div>
                        <span class="kpi-list-value val-success">${completedCount}</span>
                    </div>
                    <div class="kpi-list-row">
                        <div class="kpi-list-left">
                            <span class="kpi-dot" style="background-color: var(--color-primary); box-shadow: 0 0 8px var(--color-primary);"></span>
                            <span class="kpi-list-label">${window.currentLang === 'th' ? 'กำลังดำเนินการ (In Progress)' : 'In Progress'}</span>
                        </div>
                        <span class="kpi-list-value" style="color: var(--color-primary); text-shadow: 0 0 15px rgba(0,243,255,0.4);">${inProgressCount}</span>
                    </div>
                    <div class="kpi-list-row">
                        <div class="kpi-list-left">
                            <span class="kpi-dot dot-missing"></span>
                            <span class="kpi-list-label">${window.currentLang === 'th' ? 'ขาด (Pending)' : 'Pending'}</span>
                        </div>
                        <span class="kpi-list-value val-missing">${pendingCount}</span>
                    </div>
                </div>
            `;
        }

        function renderRecruitingGroups(data) {
            const renderArea = document.getElementById('recruiting-render-area');
            renderArea.innerHTML = '';

            if (data.length === 0) {
                renderArea.innerHTML = `<div style="text-align: center; padding: 100px; color: var(--color-text-muted); font-weight: 300;">${window.currentLang === 'th' ? 'ไม่พบข้อมูลที่ตรงกับเงื่อนไขการค้นหา' : 'No data found matching the criteria.'}</div>`;
                return;
            }

            const grouped = {};
            data.forEach(item => {
                if (!grouped[item.month]) grouped[item.month] = [];
                grouped[item.month].push(item);
            });

            const sortedMonths = Object.keys(grouped).sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));

            sortedMonths.forEach((month, mIdx) => {
                const section = document.createElement('div');
                section.className = 'month-container';
                
                const monthData = grouped[month];
                let cardsHtml = '';

                monthData.forEach((item, cIdx) => {
                    const s = item.status.toLowerCase();
                    let badgeClass = 'badge-notstarted';
                    let isCompleted = false;

                    let ledColor = 'rgba(255,255,255,0.4)';
                    let ledGlow = 'rgba(255,255,255,0.1)';

                    if (s === 'completed') {
                        badgeClass = 'badge-hired';
                        isCompleted = true;
                        ledColor = 'var(--color-success)';
                        ledGlow = 'rgba(0, 255, 163, 0.25)';
                    } else if (s === 'in progress') {
                        badgeClass = 'badge-progress';
                        ledColor = 'var(--color-primary)';
                        ledGlow = 'rgba(0, 243, 255, 0.25)';
                    } else if (s === 'pending') {
                        badgeClass = 'badge-delayed';
                        ledColor = 'var(--color-danger)';
                        ledGlow = 'rgba(255, 77, 77, 0.25)';
                    }

                    const hiredCount = isCompleted ? item.kpi : 0;
                    const missingCount = isCompleted ? 0 : item.kpi;
                    const animDelay = (mIdx * 0.1) + (cIdx * 0.08);

                    cardsHtml += `
                        <div class="work-card" style="--led-color: ${ledColor}; --led-glow: ${ledGlow}; animation-delay: ${animDelay}s">
                            <span class="job-badge ${badgeClass}">${item.status}</span>
                            <h3 class="job-header-text">${item.task}</h3>
                            <div class="meta-line">👤 <span>${window.currentLang === 'th' ? 'ผู้รับผิดชอบ:' : 'Owner:'} ${item.owner}</span></div>
                            <div class="card-bottom">
                                <div class="footer-col"><span class="footer-label">${window.currentLang === 'th' ? 'อัตรา (KPI)' : 'Target'}</span><span class="footer-value val-p-rate">${item.kpi}</span></div>
                                <div class="footer-col"><span class="footer-label">${window.currentLang === 'th' ? 'รับแล้ว' : 'Hired'}</span><span class="footer-value val-p-hired">${hiredCount}</span></div>
                                <div class="footer-col"><span class="footer-label">${window.currentLang === 'th' ? 'ขาด' : 'Missing'}</span><span class="footer-value val-p-missing">${missingCount}</span></div>
                            </div>
                        </div>`;
                });

                section.innerHTML = `<div class="month-title-row">${month}</div><div class="job-grid-view">${cardsHtml}</div>`;
                renderArea.appendChild(section);
            });
        }

        // ==========================================
        // MODULE 3: BENEFIT TASK MONITORING
        // ==========================================
        let benefitRawData = [];
        let isBenefitFirstLoad = true;
        
        async function fetchBenefitData() {
            const sheetId = '152oYyJbd6_gdNAh8cvlD-Ozi4qkwa3LmbPTU0N3F4OA';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            
            try {
                document.getElementById('benefit-table-body').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-primary); font-weight: 600;">FETCHING DATA...</td></tr>';
                
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));
                const rows = json.table.rows;
                
                benefitRawData = rows.map((r, index) => {
                    const statusStr = (r.c[4]?.v || '').toString().trim().toLowerCase();
                    let statusType = 'pending';
                    if (statusStr.includes('completed') || statusStr.includes('เสร็จ') || statusStr.includes('ทำแล้ว')) statusType = 'completed';
                    else if (statusStr.includes('in progress') || statusStr.includes('กำลัง')) statusType = 'in progress';
                    
                    return {
                        id: r.c[0]?.v ? parseInt(r.c[0].v, 10) : (index + 1), // Column A: ลำดับ
                        task: (r.c[1]?.v || '').toString().trim(),            // Column B: รายการงาน
                        owner: (r.c[2]?.v || '').toString().trim(),           // Column C: ผู้รับผิดชอบ
                        month: (r.c[3]?.v || '').toString().trim(),           // Column D: เดือน
                        statusRaw: r.c[4]?.v || 'Pending',                    // Column E: สถานะ
                        statusType: statusType
                    };
                }).filter(data => data.task !== '' || data.owner !== ''); // Ignore empty rows
                
                populateBenefitFilters();

                if (isBenefitFirstLoad) {
                    document.getElementById('bn-filter-month').value = 'all';
                    isBenefitFirstLoad = false;
                }

                processAndRenderBenefit();
            } catch (err) {
                console.error("Benefit Fetch Error:", err);
                document.getElementById('benefit-table-body').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-danger);">Failed to load data. Please check connection.</td></tr>';
            }
        }

        function populateBenefitFilters() {
            const tasks = [...new Set(benefitRawData.map(d => d.task))].sort();
            const taskDropdown = document.getElementById('bn-filter-task');
            taskDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Tasks)' : 'All Tasks'}</option>`;
            tasks.forEach(t => { if(t) taskDropdown.innerHTML += `<option value="${t}">${t}</option>`; });

            let months = [...new Set(benefitRawData.map(d => d.month))];
            months.sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));
            const monthDropdown = document.getElementById('bn-filter-month');
            const currentSelectedMonth = monthDropdown.value;
            monthDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกเดือน (All Months)' : 'All Months'}</option>`;
            months.forEach(m => { if(m) monthDropdown.innerHTML += `<option value="${m}">${m}</option>`; });
            if (currentSelectedMonth && months.includes(currentSelectedMonth)) {
                monthDropdown.value = currentSelectedMonth;
            }
        }

        function processAndRenderBenefit() {
            const taskVal = document.getElementById('bn-filter-task').value;
            const monthVal = document.getElementById('bn-filter-month').value;
            const statusVal = document.getElementById('bn-filter-status').value;

            // Filter Logic
            let filtered = benefitRawData.filter(data => {
                const matchTask = taskVal === 'all' || data.task === taskVal;
                const matchMonth = monthVal === 'all' || data.month === monthVal;
                const matchStatus = statusVal === 'all' || data.statusType === statusVal;
                return matchTask && matchMonth && matchStatus;
            });

            // Default Sort Behavior: Column A (id) descending
            filtered.sort((a, b) => b.id - a.id);

            updateBenefitKpiAndAlerts(filtered);
            renderBenefitTable(filtered);
        }

        function updateBenefitKpiAndAlerts(filteredData) {
            // KPI Calculations
            const totalTasks = filteredData.length;
            let completedCount = 0;
            let progressCount = 0;
            let pendingCount = 0;

            filteredData.forEach(item => {
                if (item.statusType === 'completed') completedCount++;
                else if (item.statusType === 'in progress') progressCount++;
                else pendingCount++;
            });

            animateValue('bn-kpi-total-tasks', 0, totalTasks, 800);
            animateValue('bn-kpi-completed', 0, completedCount, 800);
            animateValue('bn-kpi-progress', 0, progressCount, 800);
            animateValue('bn-kpi-pending', 0, pendingCount, 800);

            // Update Progress Bar
            const totalForPct = totalTasks || 1; 
            const compPct = (completedCount / totalForPct) * 100;
            const progPct = (progressCount / totalForPct) * 100;
            const pendPct = (pendingCount / totalForPct) * 100;
            
            document.getElementById('bn-progress-bar-render').innerHTML = `
                <div class="bn-progress-segment" style="width: ${compPct}%; background: var(--color-success);"></div>
                <div class="bn-progress-segment" style="width: ${progPct}%; background: var(--color-warning);"></div>
                <div class="bn-progress-segment" style="width: ${pendPct}%; background: var(--color-danger);"></div>
            `;

            // SMART ALERT LOGIC
            const thaiMonthsList = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];
            const currentMonthThai = thaiMonthsList[new Date().getMonth()];
            
            let currentMonthIncompleteCount = 0;
            filteredData.forEach(item => {
                if (item.month.includes(currentMonthThai) && (item.statusType === 'pending' || item.statusType === 'in progress')) {
                    currentMonthIncompleteCount++;
                }
            });

            const alertContainer = document.getElementById('benefit-alert-area');
            let alertHtml = '';

            if (pendingCount > 0) {
                alertHtml += `
                    <div class="alert-box alert-danger">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        <span>${window.currentLang === 'th' ? `คุณมี ${pendingCount} งานที่ยังไม่ได้ทำ (Pending Tasks)` : `You have ${pendingCount} pending tasks`}</span>
                    </div>`;
            }

            if (currentMonthIncompleteCount > 0) {
                alertHtml += `
                    <div class="alert-box alert-warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        <span>${window.currentLang === 'th' ? `แจ้งเตือน: งานเดือนปัจจุบัน (${currentMonthThai}) ยังดำเนินการไม่ครบ` : `Warning: Tasks for current month (${currentMonthThai}) are incomplete.`}</span>
                    </div>`;
            }

            alertContainer.innerHTML = alertHtml;
        }

        function renderBenefitTable(data) {
            const tbody = document.getElementById('benefit-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 60px; color: rgba(255,255,255,0.4);">${window.currentLang === 'th' ? 'ไม่พบข้อมูลที่ตรงกับเงื่อนไข' : 'No data found matching the criteria.'}</td></tr>`;
                return;
            }

            data.forEach(item => {
                const tr = document.createElement('tr');
                
                let badgeHtml = '';
                let alertIconHtml = '';
                let rowClass = '';
                let taskClass = 'font-weight: 600; font-family: var(--font-display); letter-spacing: 0.5px; transition: all 0.3s ease;';
                
                if (item.statusType === 'completed') {
                    badgeHtml = `<span class="badge-neon badge-neon-completed">✔ ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-success); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 10px var(--color-success);">✔</span>`;
                } else if (item.statusType === 'in progress') {
                    badgeHtml = `<span class="badge-neon badge-neon-progress">🔄 ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-warning); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 10px var(--color-warning);">🔄</span>`;
                    taskClass += ' color: var(--color-warning);';
                } else {
                    rowClass = 'row-pending';
                    badgeHtml = `<span class="badge-neon badge-neon-pending"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-danger); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 15px var(--color-danger);" title="ยังไม่ได้ทำ">⚠</span>`;
                    taskClass += ' color: var(--color-danger); text-shadow: 0 0 12px rgba(255, 77, 77, 0.6); font-weight: 800;';
                }

                if (rowClass) tr.className = rowClass;

                tr.innerHTML = `
                    <td style="text-align: center; color: rgba(255,255,255,0.5); font-family: monospace;">${item.id}</td>
                    <td style="${taskClass}">${item.task}</td>
                    <td style="color: rgba(255,255,255,0.8);">${item.owner}</td>
                    <td style="color: rgba(255,255,255,0.8);">${item.month}</td>
                    <td>${badgeHtml}</td>
                    <td style="text-align: center;">${alertIconHtml}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ==========================================
        // MODULE 4: SALARY DASHBOARD (BUDGET CONTROL)
        // ==========================================
        let salaryRawData = [];
        let isSalaryFirstLoad = true;

        async function fetchSalaryData() {
            const sheetId = '1ONbPfC9QtiMrGGTmNktTRlMiUxhLsbaQi4GQVjH4e5g';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            
            try {
                document.getElementById('salary-table-body').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-primary); font-weight: 600;">FETCHING DATA...</td></tr>';
                
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));
                const rows = json.table.rows;
                
                salaryRawData = rows.map((r, index) => {
                    const statusStr = (r.c[4]?.v || '').toString().trim().toLowerCase();
                    let statusType = 'pending';
                    if (statusStr.includes('completed') || statusStr.includes('เสร็จ')) statusType = 'completed';
                    else if (statusStr.includes('in progress') || statusStr.includes('กำลัง')) statusType = 'in progress';
                    
                    return {
                        id: r.c[0]?.v ? parseInt(r.c[0].v, 10) : (index + 1), // Column A: ลำดับ
                        item: (r.c[1]?.v || '').toString().trim(),            // Column B: รายการงบประมาณ
                        owner: (r.c[2]?.v || '').toString().trim(),           // Column C: ผู้รับผิดชอบ
                        month: (r.c[3]?.v || '').toString().trim(),           // Column D: เดือน
                        statusRaw: r.c[4]?.v || 'Pending',                    // Column E: สถานะ
                        statusType: statusType
                    };
                }).filter(data => data.item !== '' || data.owner !== ''); // Ignore empty rows
                
                populateSalaryFilters();

                if (isSalaryFirstLoad) {
                    document.getElementById('sl-filter-month').value = 'all';
                    isSalaryFirstLoad = false;
                }

                processAndRenderSalary();
            } catch (err) {
                console.error("Salary Fetch Error:", err);
                document.getElementById('salary-table-body').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-danger);">Failed to load data. Please check connection.</td></tr>';
            }
        }

        function populateSalaryFilters() {
            const items = [...new Set(salaryRawData.map(d => d.item))].sort();
            const itemDropdown = document.getElementById('sl-filter-item');
            itemDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Items)' : 'All Items'}</option>`;
            items.forEach(t => { if(t) itemDropdown.innerHTML += `<option value="${t}">${t}</option>`; });

            let months = [...new Set(salaryRawData.map(d => d.month))];
            months.sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));
            const monthDropdown = document.getElementById('sl-filter-month');
            const currentSelectedMonth = monthDropdown.value;
            monthDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกเดือน (All Months)' : 'All Months'}</option>`;
            months.forEach(m => { if(m) monthDropdown.innerHTML += `<option value="${m}">${m}</option>`; });
            if (currentSelectedMonth && months.includes(currentSelectedMonth)) {
                monthDropdown.value = currentSelectedMonth;
            }
        }

        function processAndRenderSalary() {
            const itemVal = document.getElementById('sl-filter-item').value;
            const monthVal = document.getElementById('sl-filter-month').value;
            const statusVal = document.getElementById('sl-filter-status').value;

            // Filter Logic
            let filtered = salaryRawData.filter(data => {
                const matchItem = itemVal === 'all' || data.item === itemVal;
                const matchMonth = monthVal === 'all' || data.month === monthVal;
                const matchStatus = statusVal === 'all' || data.statusType === statusVal;
                return matchItem && matchMonth && matchStatus;
            });

            // Default Sort Behavior: Column A (id) descending
            filtered.sort((a, b) => b.id - a.id);

            updateSalaryKpiAndAlerts(filtered);
            renderSalaryTable(filtered);
        }

        function updateSalaryKpiAndAlerts(filteredData) {
            // KPI Calculations
            const totalTasks = filteredData.length;
            let completedCount = 0;
            let progressCount = 0;
            let pendingCount = 0;

            filteredData.forEach(item => {
                if (item.statusType === 'completed') completedCount++;
                else if (item.statusType === 'in progress') progressCount++;
                else pendingCount++;
            });

            animateValue('sl-kpi-total-tasks', 0, totalTasks, 800);
            animateValue('sl-kpi-completed', 0, completedCount, 800);
            animateValue('sl-kpi-progress', 0, progressCount, 800);
            animateValue('sl-kpi-pending', 0, pendingCount, 800);

            // Update Progress Bar
            const totalForPct = totalTasks || 1; 
            const compPct = (completedCount / totalForPct) * 100;
            const progPct = (progressCount / totalForPct) * 100;
            const pendPct = (pendingCount / totalForPct) * 100;
            
            document.getElementById('sl-progress-bar-render').innerHTML = `
                <div class="bn-progress-segment" style="width: ${compPct}%; background: var(--color-success);"></div>
                <div class="bn-progress-segment" style="width: ${progPct}%; background: var(--color-warning);"></div>
                <div class="bn-progress-segment" style="width: ${pendPct}%; background: var(--color-danger);"></div>
            `;

            // SMART ALERT LOGIC
            const thaiMonthsList = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];
            const currentMonthThai = thaiMonthsList[new Date().getMonth()];
            
            let currentMonthIncompleteCount = 0;
            filteredData.forEach(item => {
                if (item.month.includes(currentMonthThai) && (item.statusType === 'pending' || item.statusType === 'in progress')) {
                    currentMonthIncompleteCount++;
                }
            });

            const alertContainer = document.getElementById('salary-alert-area');
            let alertHtml = '';

            if (pendingCount > 0) {
                alertHtml += `
                    <div class="alert-box alert-danger">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        <span>${window.currentLang === 'th' ? `คุณมี ${pendingCount} งานที่ยังไม่ได้ทำ (Pending Tasks)` : `You have ${pendingCount} pending tasks`}</span>
                    </div>`;
            }

            if (currentMonthIncompleteCount > 0) {
                alertHtml += `
                    <div class="alert-box alert-warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        <span>${window.currentLang === 'th' ? `แจ้งเตือน: งบประมาณเดือนปัจจุบัน (${currentMonthThai}) ยังดำเนินการไม่ครบ` : `Warning: Budget tasks for current month (${currentMonthThai}) are incomplete.`}</span>
                    </div>`;
            }

            alertContainer.innerHTML = alertHtml;
        }

        function renderSalaryTable(data) {
            const tbody = document.getElementById('salary-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 60px; color: rgba(255,255,255,0.4);">${window.currentLang === 'th' ? 'ไม่พบข้อมูลงบประมาณที่ตรงกับเงื่อนไข' : 'No budget data found matching the criteria.'}</td></tr>`;
                return;
            }

            data.forEach(item => {
                const tr = document.createElement('tr');
                
                let badgeHtml = '';
                let alertIconHtml = '';
                let rowClass = '';
                let taskClass = 'font-weight: 600; font-family: var(--font-display); letter-spacing: 0.5px; transition: all 0.3s ease;';
                
                if (item.statusType === 'completed') {
                    badgeHtml = `<span class="badge-neon badge-neon-completed">✔ ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-success); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 10px var(--color-success);">✔</span>`;
                } else if (item.statusType === 'in progress') {
                    badgeHtml = `<span class="badge-neon badge-neon-progress">🔄 ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-warning); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 10px var(--color-warning);">🔄</span>`;
                    taskClass += ' color: var(--color-warning);';
                } else {
                    rowClass = 'row-pending';
                    badgeHtml = `<span class="badge-neon badge-neon-pending"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-danger); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 15px var(--color-danger);" title="ยังไม่ได้ทำ">⚠</span>`;
                    taskClass += ' color: var(--color-danger); text-shadow: 0 0 12px rgba(255, 77, 77, 0.6); font-weight: 800;';
                }

                if (rowClass) tr.className = rowClass;

                tr.innerHTML = `
                    <td style="text-align: center; color: rgba(255,255,255,0.5); font-family: monospace;">${item.id}</td>
                    <td style="${taskClass}">${item.item}</td>
                    <td style="color: rgba(255,255,255,0.8);">${item.owner}</td>
                    <td style="color: rgba(255,255,255,0.8);">${item.month}</td>
                    <td>${badgeHtml}</td>
                    <td style="text-align: center;">${alertIconHtml}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ==========================================
        // MODULE 5: WELFARE DASHBOARD (BUDGET CONTROL)
        // ==========================================
        let welfareRawData = [];
        let isWelfareFirstLoad = true;

        async function fetchWelfareData() {
            const sheetId = '1yfzlrtgIW2eXbRXAQ_3pW2e6pzdpHxm4vRt-gbKhsEQ';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            
            try {
                document.getElementById('welfare-table-body').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-primary); font-weight: 600;">FETCHING WELFARE DATA...</td></tr>';
                
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47, text.length - 2));
                const rows = json.table.rows;
                
                // Safe Array Access
                const col = (r, idx) => (r.c && r.c[idx]) ? r.c[idx].v : '';
                
                welfareRawData = rows.map((r, index) => {
                    const statusStr = String(col(r, 4)).trim().toLowerCase();
                    let statusType = 'pending';
                    if (statusStr.includes('completed') || statusStr.includes('เสร็จ') || statusStr.includes('ทำแล้ว')) statusType = 'completed';
                    else if (statusStr.includes('in progress') || statusStr.includes('กำลัง')) statusType = 'in progress';
                    
                    const idVal = col(r, 0);
                    return {
                        id: idVal ? parseInt(idVal, 10) : (index + 1),        // Column A: ลำดับ
                        item: String(col(r, 1)).trim(),                       // Column B: รายการงบประมาณสวัสดิการ
                        owner: String(col(r, 2)).trim(),                      // Column C: ผู้รับผิดชอบ
                        month: String(col(r, 3)).trim(),                      // Column D: เดือน
                        statusRaw: col(r, 4) ? String(col(r, 4)).trim() : 'Pending', // Column E: สถานะ
                        statusType: statusType
                    };
                }).filter(data => data.item !== '' && data.item !== 'null'); // Ignore empty rows
                
                populateWelfareFilters();

                if (isWelfareFirstLoad) {
                    document.getElementById('wl-filter-month').value = 'all';
                    isWelfareFirstLoad = false;
                }

                processAndRenderWelfare();
            } catch (err) {
                console.error("Welfare Fetch Error:", err);
                document.getElementById('welfare-table-body').innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-danger);">Failed to load data. Please check connection.</td></tr>';
            }
        }

        function populateWelfareFilters() {
            const items = [...new Set(welfareRawData.map(d => d.item))].filter(Boolean).sort();
            const itemDropdown = document.getElementById('wl-filter-item');
            const currItem = itemDropdown.value;
            itemDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Items)' : 'All Items'}</option>`;
            items.forEach(t => itemDropdown.innerHTML += `<option value="${t}">${t}</option>`);
            if (currItem && items.includes(currItem)) itemDropdown.value = currItem;

            let months = [...new Set(welfareRawData.map(d => d.month))].filter(Boolean);
            months.sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));
            const monthDropdown = document.getElementById('wl-filter-month');
            const currMonth = monthDropdown.value;
            monthDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกเดือน (All Months)' : 'All Months'}</option>`;
            months.forEach(m => monthDropdown.innerHTML += `<option value="${m}">${m}</option>`);
            if (currMonth && months.includes(currMonth)) monthDropdown.value = currMonth;
        }

        function processAndRenderWelfare() {
            const itemVal = document.getElementById('wl-filter-item').value;
            const monthVal = document.getElementById('wl-filter-month').value;
            const statusVal = document.getElementById('wl-filter-status').value;

            // Filter Logic
            let filtered = welfareRawData.filter(data => {
                const matchItem = itemVal === 'all' || data.item === itemVal;
                const matchMonth = monthVal === 'all' || data.month === monthVal;
                const matchStatus = statusVal === 'all' || data.statusType === statusVal;
                return matchItem && matchMonth && matchStatus;
            });

            // Default Sort Behavior: Column A (id) descending
            filtered.sort((a, b) => b.id - a.id);

            updateWelfareKpiAndAlerts(filtered);
            renderWelfareTable(filtered);
        }

        function updateWelfareKpiAndAlerts(filteredData) {
            const totalTasks = filteredData.length;
            let completedCount = 0;
            let progressCount = 0;
            let pendingCount = 0;

            filteredData.forEach(item => {
                if (item.statusType === 'completed') completedCount++;
                else if (item.statusType === 'in progress') progressCount++;
                else pendingCount++;
            });

            animateValue('wl-kpi-total-tasks', 0, totalTasks, 800);
            animateValue('wl-kpi-completed', 0, completedCount, 800);
            animateValue('wl-kpi-progress', 0, progressCount, 800);
            animateValue('wl-kpi-pending', 0, pendingCount, 800);

            const totalForPct = totalTasks || 1; 
            const compPct = (completedCount / totalForPct) * 100;
            const progPct = (progressCount / totalForPct) * 100;
            const pendPct = (pendingCount / totalForPct) * 100;
            
            document.getElementById('wl-progress-bar-render').innerHTML = `
                <div class="bn-progress-segment" style="width: ${compPct}%; background: var(--color-success);"></div>
                <div class="bn-progress-segment" style="width: ${progPct}%; background: var(--color-warning);"></div>
                <div class="bn-progress-segment" style="width: ${pendPct}%; background: var(--color-danger);"></div>
            `;

            // SMART ALERT LOGIC
            const thaiMonthsList = ["มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"];
            const currentMonthThai = thaiMonthsList[new Date().getMonth()];
            
            let currentMonthIncompleteCount = 0;
            filteredData.forEach(item => {
                if (item.month.includes(currentMonthThai) && (item.statusType === 'pending' || item.statusType === 'in progress')) {
                    currentMonthIncompleteCount++;
                }
            });

            const alertContainer = document.getElementById('welfare-alert-area');
            let alertHtml = '';

            if (pendingCount > 0) {
                alertHtml += `
                    <div class="alert-box alert-danger">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>
                        <span>${window.currentLang === 'th' ? `คุณมี ${pendingCount} งานสวัสดิการที่ยังไม่ได้ทำ (Pending Tasks)` : `You have ${pendingCount} pending welfare tasks`}</span>
                    </div>`;
            }

            if (currentMonthIncompleteCount > 0) {
                alertHtml += `
                    <div class="alert-box alert-warning">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>
                        <span>${window.currentLang === 'th' ? `แจ้งเตือน: แผนสวัสดิการเดือนปัจจุบัน (${currentMonthThai}) ยังดำเนินการไม่ครบ` : `Warning: Welfare tasks for current month (${currentMonthThai}) are incomplete.`}</span>
                    </div>`;
            }

            alertContainer.innerHTML = alertHtml;
        }

        function renderWelfareTable(data) {
            const tbody = document.getElementById('welfare-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 60px; color: rgba(255,255,255,0.4);">${window.currentLang === 'th' ? 'ไม่พบข้อมูลสวัสดิการที่ตรงกับเงื่อนไข' : 'No welfare data found matching the criteria.'}</td></tr>`;
                return;
            }

            data.forEach(item => {
                const tr = document.createElement('tr');
                
                let badgeHtml = '';
                let alertIconHtml = '';
                let rowClass = '';
                let taskClass = 'font-weight: 600; font-family: var(--font-display); letter-spacing: 0.5px; transition: all 0.3s ease;';
                
                if (item.statusType === 'completed') {
                    badgeHtml = `<span class="badge-neon badge-neon-completed">✔ ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-success); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 10px var(--color-success);">✔</span>`;
                } else if (item.statusType === 'in progress') {
                    badgeHtml = `<span class="badge-neon badge-neon-progress">🔄 ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-warning); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 10px var(--color-warning);">🔄</span>`;
                    taskClass += ' color: var(--color-warning);';
                } else {
                    rowClass = 'row-pending';
                    badgeHtml = `<span class="badge-neon badge-neon-pending"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> ${item.statusRaw}</span>`;
                    alertIconHtml = `<span style="color: var(--color-danger); font-weight: bold; font-size: 1.2rem; text-shadow: 0 0 15px var(--color-danger);" title="ยังไม่ได้ทำ">⚠</span>`;
                    taskClass += ' color: var(--color-danger); text-shadow: 0 0 12px rgba(255, 77, 77, 0.6); font-weight: 800;';
                }

                if (rowClass) tr.className = rowClass;

                tr.innerHTML = `
                    <td style="text-align: center; color: rgba(255,255,255,0.5); font-family: monospace;">${item.id}</td>
                    <td style="${taskClass}">${item.item}</td>
                    <td style="color: rgba(255,255,255,0.8);">${item.owner}</td>
                    <td style="color: rgba(255,255,255,0.8);">${item.month}</td>
                    <td>${badgeHtml}</td>
                    <td style="text-align: center;">${alertIconHtml}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ==========================================
        // MODULE 6: EMPLOYEE LOAN DASHBOARD (NEW)
        // ==========================================
        let loanRawData = [];
        let isLoanFirstLoad = true;
        let currentLoanChartType = 'area';

        function changeLoanChartType(type) {
            currentLoanChartType = type;
            document.querySelectorAll('.chart-toggle-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-chart-${type}`).classList.add('active');
            processAndRenderLoan(); // Trigger re-render with new chart type
        }

        async function fetchLoanData() {
            if (loanRawData.length > 0 && !isLoanFirstLoad) {
                processAndRenderLoan();
                return;
            }

            const sheetId = '1GECHMYtklYNeWBybjFJcwKGT1PgG5dsAMzEQdsX6fmk';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            
            try {
                document.getElementById('loan-table-body').innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 60px; color: var(--color-primary); font-weight: 600; font-family: var(--font-display); letter-spacing: 2px;">FETCHING LOAN DATA...</td></tr>';
                
                const response = await fetch(url);
                const text = await response.text();
                
                // ตรวจสอบกรณีไม่ได้เปิดสิทธิ์ Share Sheet เป็น Public
                if (text.includes('<html')) {
                    throw new Error("ไม่สามารถเข้าถึงข้อมูลได้ (กรุณาตรวจสอบว่าตั้งค่า Share Google Sheet เป็น 'Anyone with the link' แล้วหรือไม่)");
                }

                // วิธีตัด String JSON ที่ปลอดภัย ป้องกัน Error ถ้า Google ปรับเปลี่ยนโครงสร้าง
                const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\);/);
                if (!match) throw new Error("รูปแบบข้อมูลที่ได้รับจาก Google Sheet ไม่ถูกต้อง");
                
                const json = JSON.parse(match[1]);
                
                // ตรวจสอบ Error จาก Google Visualization API (เช่น ชื่อ Sheet ผิด)
                if (json.status === 'error') {
                    throw new Error("ข้อผิดพลาดจาก Sheet: " + (json.errors[0]?.message || 'Unknown error'));
                }

                const rows = json.table.rows;
                
                // Safe Parser for Numbers
                const parseAmt = (val) => {
                    if (val === null || val === undefined || val === '') return 0;
                    if (typeof val === 'number') return val;
                    const parsed = parseFloat(String(val).replace(/,/g, '').trim());
                    return isNaN(parsed) ? 0 : parsed;
                };

                // Safe array access ป้องกันกรณีบางคอลัมน์ปล่อยว่างแล้ว Google API ส่งค่ากลับมาไม่ครบ
                const col = (r, idx) => {
                    if (!r || !r.c || !r.c[idx]) return '';
                    const val = r.c[idx].v;
                    return (val === null || val === undefined) ? '' : val;
                };
                
                loanRawData = rows.map((r, i) => {
                    const itemVal = String(col(r, 0)).trim();
                    const monthVal = String(col(r, 5)).trim();
                    return {
                        originalIndex: i, // สำหรับเรียงลำดับเวลาในเดือนเดียวกัน
                        item: itemVal,
                        principal: parseAmt(col(r, 1)),
                        interestBase: parseAmt(col(r, 2)),
                        interestBank: parseAmt(col(r, 3)),
                        disbursed: parseAmt(col(r, 4)),
                        month: monthVal,
                        balance: parseAmt(col(r, 6)),
                        quarter: String(col(r, 7)).trim(),
                        year: parseInt(col(r, 8)) || new Date().getFullYear()
                    };
                }).filter(d => d.item !== '' && d.item !== 'null'); // กรองเฉพาะแถวที่ไม่ได้กรอกชื่อรายการออก
                
                if (loanRawData.length === 0) {
                    throw new Error("ไม่พบแถวข้อมูลใน Sheet (คุณอาจใช้ชื่อ Sheet ผิด หรือตารางว่างเปล่า)");
                }

                if (isLoanFirstLoad) {
                    document.getElementById('ln-filter-year').value = 'all';
                    document.getElementById('ln-filter-quarter').value = 'all';
                    document.getElementById('ln-filter-month').value = 'all';
                    document.getElementById('ln-filter-item').value = 'all';
                    isLoanFirstLoad = false;
                }

                updateLoanDropdowns();
                processAndRenderLoan();
            } catch (err) {
                console.error("Loan Fetch Error:", err);
                let errMsg = 'Failed to load loan data. Please check connection and data format.';
                if (err.message) {
                    errMsg += `<br><span style="font-size: 0.9rem; font-weight: 400; opacity: 0.8; margin-top: 8px; display: inline-block; color: #ff8a8a;">[Details: ${err.message}]</span>`;
                }
                document.getElementById('loan-table-body').innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 60px; color: var(--color-danger); line-height: 1.6;">${errMsg}</td></tr>`;
                
                // สั่งล้างข้อมูลด้านบนหากพัง
                updateLoanKPIs([]);
            }
        }

        // --- SMART FILTER LOGIC ---
        function handleLoanFilterChange(changedId) {
            // Reset lower-level dropdowns when a higher-level dropdown changes
            if (changedId === 'ln-filter-year') {
                document.getElementById('ln-filter-quarter').value = 'all';
                document.getElementById('ln-filter-month').value = 'all';
            } else if (changedId === 'ln-filter-quarter') {
                document.getElementById('ln-filter-month').value = 'all';
            }
            
            updateLoanDropdowns();
            processAndRenderLoan();
        }

        function updateLoanDropdowns() {
            const yearDropdown = document.getElementById('ln-filter-year');
            const quarterDropdown = document.getElementById('ln-filter-quarter');
            const monthDropdown = document.getElementById('ln-filter-month');
            const itemDropdown = document.getElementById('ln-filter-item');

            const yearVal = yearDropdown.value;
            const quarterVal = quarterDropdown.value;
            const monthVal = monthDropdown.value;
            const itemVal = itemDropdown.value;

            // 1. Year Dropdown (always shows all available years)
            const years = [...new Set(loanRawData.map(d => d.year))].filter(y => y > 0).sort((a,b) => b - a);
            yearDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกปี (All Years)' : 'All Years'}</option>`;
            years.forEach(y => yearDropdown.innerHTML += `<option value="${y}">${y}</option>`);
            if (years.includes(parseInt(yearVal))) yearDropdown.value = yearVal;
            else yearDropdown.value = 'all';

            // 2. Quarter Dropdown (depends on Year)
            let availableQuarters = [];
            if (yearDropdown.value !== 'all') {
                availableQuarters = [...new Set(loanRawData.filter(d => String(d.year) === yearDropdown.value).map(d => d.quarter))].filter(Boolean).sort();
            } else {
                availableQuarters = [...new Set(loanRawData.map(d => d.quarter))].filter(Boolean).sort();
            }
            quarterDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกไตรมาส (All Quarters)' : 'All Quarters'}</option>`;
            availableQuarters.forEach(q => quarterDropdown.innerHTML += `<option value="${q}">${q}</option>`);
            if (availableQuarters.includes(quarterVal)) quarterDropdown.value = quarterVal;
            else quarterDropdown.value = 'all';

            // 3. Month Dropdown (depends on Year and Quarter)
            let monthData = loanRawData;
            if (yearDropdown.value !== 'all') monthData = monthData.filter(d => String(d.year) === yearDropdown.value);
            if (quarterDropdown.value !== 'all') monthData = monthData.filter(d => d.quarter === quarterDropdown.value);
            
            let availableMonths = [...new Set(monthData.map(d => d.month))].filter(Boolean);
            availableMonths.sort((a, b) => (MONTH_ORDER[a] || 99) - (MONTH_ORDER[b] || 99));
            
            monthDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทุกเดือน (All Months)' : 'All Months'}</option>`;
            availableMonths.forEach(m => monthDropdown.innerHTML += `<option value="${m}">${m}</option>`);
            if (availableMonths.includes(monthVal)) monthDropdown.value = monthVal;
            else monthDropdown.value = 'all';

            // 4. Item Dropdown (depends on all above)
            let itemData = monthData;
            if (monthDropdown.value !== 'all') itemData = itemData.filter(d => d.month === monthDropdown.value);
            
            let availableItems = [...new Set(itemData.map(d => d.item))].filter(Boolean).sort();
            itemDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Items)' : 'All Items'}</option>`;
            availableItems.forEach(i => itemDropdown.innerHTML += `<option value="${i}">${i}</option>`);
            if (availableItems.includes(itemVal)) itemDropdown.value = itemVal;
            else itemDropdown.value = 'all';
        }

        function processAndRenderLoan() {
            const yearVal = document.getElementById('ln-filter-year').value;
            const quarterVal = document.getElementById('ln-filter-quarter').value;
            const monthVal = document.getElementById('ln-filter-month').value;
            const itemVal = document.getElementById('ln-filter-item').value;

            // --- SMOOTH FADE TRANSITION ---
            const elementsToFade = [
                document.querySelector('.loan-top-grid'),
                document.getElementById('loan-chart-container'),
                document.querySelector('#loan-dashboard-page .benefit-table-wrap')
            ];

            elementsToFade.forEach(el => {
                if(el) {
                    el.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(5px)';
                }
            });

            setTimeout(() => {
                // Filter
                let filtered = loanRawData.filter(d => {
                    const matchYear = yearVal === 'all' || String(d.year) === yearVal;
                    const matchQuarter = quarterVal === 'all' || d.quarter === quarterVal;
                    const matchMonth = monthVal === 'all' || d.month === monthVal;
                    const matchItem = itemVal === 'all' || d.item === itemVal;
                    return matchYear && matchQuarter && matchMonth && matchItem;
                });

                // Sort DESC
                filtered.sort((a, b) => {
                    if (a.year !== b.year) return b.year - a.year;
                    const monthA = MONTH_ORDER[a.month] || 0;
                    const monthB = MONTH_ORDER[b.month] || 0;
                    if (monthA !== monthB) return monthB - monthA;
                    return b.originalIndex - a.originalIndex;
                });

                updateLoanKPIs(filtered);
                renderLoanChart(filtered);
                renderLoanTable(filtered);

                // Restore visibility smoothly
                elementsToFade.forEach(el => {
                    if(el) {
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }
                });
            }, 200); // Wait for fade out to complete before updating data
        }

        function updateLoanKPIs(filtered) {
            const fmt = (val) => val.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});

            if (filtered.length === 0) {
                document.getElementById('ln-hero-balance').innerHTML = '0.00';
                document.getElementById('ln-hero-month').innerText = '-';
                document.getElementById('ln-hero-year').innerText = '-';
                document.getElementById('ln-hero-quarter').innerText = '-';
                
                document.getElementById('ln-move-prin').innerHTML = '0.00';
                document.getElementById('ln-move-int').innerHTML = '0.00';
                document.getElementById('ln-move-dis').innerHTML = '0.00';
                
                document.getElementById('ln-move-subtitle1').innerText = '';
                document.getElementById('ln-move-subtitle2').innerText = '';
                document.getElementById('ln-move-subtitle3').innerText = '';
                return;
            }

            const latestRecord = filtered[0];
            
            // Set directly to avoid width-jumping during 60fps animations
            document.getElementById('ln-hero-balance').innerHTML = fmt(latestRecord.balance);
            document.getElementById('ln-hero-month').innerText = latestRecord.month || '-';
            document.getElementById('ln-hero-year').innerText = latestRecord.year || '-';
            document.getElementById('ln-hero-quarter').innerText = latestRecord.quarter || '-';

            // Movement KPI (Sum ALL filtered data)
            const sumPrin = filtered.reduce((sum, d) => sum + d.principal, 0);
            const sumInt = filtered.reduce((sum, d) => sum + d.interestBase + d.interestBank, 0);
            const sumDis = filtered.reduce((sum, d) => sum + d.disbursed, 0);

            document.getElementById('ln-move-prin').innerHTML = fmt(sumPrin);
            document.getElementById('ln-move-int').innerHTML = fmt(sumInt);
            document.getElementById('ln-move-dis').innerHTML = fmt(sumDis);

            const subText = window.currentLang === 'th' ? '(ยอดรวมสะสมทั้งหมด)' : '(Total Accumulated)';
            document.getElementById('ln-move-subtitle1').innerText = subText;
            document.getElementById('ln-move-subtitle2').innerText = subText;
            document.getElementById('ln-move-subtitle3').innerText = subText;
        }

        function renderLoanChart(filtered) {
            const chartContainer = document.getElementById('loan-chart-container');
            if (filtered.length === 0) {
                chartContainer.innerHTML = '<div style="color: rgba(255,255,255,0.4); font-size: 1.2rem; font-family: var(--font-display);">No Data Available</div>';
                return;
            }

            const yearVal = document.getElementById('ln-filter-year').value;
            const quarterVal = document.getElementById('ln-filter-quarter').value;
            const monthVal = document.getElementById('ln-filter-month').value;

            // --- DYNAMIC AGGREGATION LEVEL LOGIC ---
            let viewLevel = 'YEAR';
            if (yearVal !== 'all') {
                viewLevel = 'QUARTER';
                if (quarterVal !== 'all') {
                    viewLevel = 'MONTH';
                }
            }

            // Grouping to get the LAST record (Latest balance) of each respective period
            const groupMap = new Map();
            
            // 'filtered' array is already sorted DESC (Year -> Month -> Row Index)
            // So the first item we encounter for a period is automatically its LATEST final balance.
            filtered.forEach(d => {
                let key = '';
                let label = '';
                let sortKey = 0;
                
                if (viewLevel === 'YEAR') {
                    key = `${d.year}`;
                    label = `ปี ${d.year}`;
                    sortKey = d.year;
                } else if (viewLevel === 'QUARTER') {
                    key = `${d.year}-${d.quarter}`;
                    label = `${d.quarter}`;
                    sortKey = parseInt(d.quarter.replace(/\D/g, '')) || 0; 
                } else if (viewLevel === 'MONTH') {
                    key = `${d.year}-${d.quarter}-${d.month}`;
                    label = `${d.month}`;
                    sortKey = MONTH_ORDER[d.month] || 0;
                }

                if (!groupMap.has(key)) {
                    groupMap.set(key, { label, balance: d.balance, sortKey });
                }
            });

            // Convert to array and sort ASC (Chronological order from left to right for Chart)
            const chartData = Array.from(groupMap.values()).sort((a, b) => a.sortKey - b.sortKey);

            // Update Dynamic Subtitle
            let subtitleText = '';
            if (viewLevel === 'YEAR') subtitleText = window.currentLang === 'th' ? '*แสดงยอดคงเหลือสรุปรายปี (จากข้อมูลล่าสุดของแต่ละปี)' : '*Yearly Balance Trend (Latest record per year)';
            else if (viewLevel === 'QUARTER') subtitleText = window.currentLang === 'th' ? `*แสดงยอดคงเหลือรายไตรมาส ของปี ${yearVal}` : `*Quarterly Balance Trend for ${yearVal}`;
            else if (viewLevel === 'MONTH') subtitleText = window.currentLang === 'th' ? `*แสดงยอดคงเหลือรายเดือน ของไตรมาส ${quarterVal} ปี ${yearVal}` : `*Monthly Balance Trend for ${quarterVal} ${yearVal}`;

            const subtitleEl = document.querySelector('.loan-chart-subtitle');
            if(subtitleEl) subtitleEl.innerText = subtitleText;

            // --- SVG RENDERER ---
            const width = 1000;
            const height = 300;
            const padX = 80;
            const padY = 50;
            const innerW = width - padX * 2;
            const innerH = height - padY * 2;

            const maxVal = Math.max(...chartData.map(d => d.balance));
            const minVal = Math.min(...chartData.map(d => d.balance));
            
            // Padding for Y axis to prevent flat line on top/bottom
            const yRange = maxVal === minVal ? maxVal * 0.2 || 100 : (maxVal - minVal);
            const yMax = maxVal + (yRange * 0.1);
            const yMin = Math.max(0, minVal - (yRange * 0.1));

            const getX = (i) => padX + (chartData.length > 1 ? (i / (chartData.length - 1)) * innerW : innerW / 2);
            const getY = (val) => padY + innerH - ((val - yMin) / (yMax - yMin) * innerH);

            let svgElements = '';

            // --- COLOR PALETTE FOR DYNAMIC STYLING ---
            const chartColors = [
                'var(--color-primary)', 
                'var(--color-success)', 
                'var(--color-warning)', 
                'var(--color-secondary)', 
                '#ff00a0', // Neon Pink
                'var(--color-danger)'
            ];

            // --- RENDER SELECTED CHART TYPE ---
            if (currentLoanChartType === 'bar') {
                const barWidth = Math.min(80, (innerW / chartData.length) * 0.5);
                chartData.forEach((d, i) => {
                    const x = getX(i);
                    const y = getY(d.balance);
                    const barH = padY + innerH - y;
                    const color = chartColors[i % chartColors.length];
                    
                    // แท่งกราฟแต่ละอันจะมี Gradient และสีขอบเป็นของตัวเอง
                    svgElements += `
                        <linearGradient id="barGrad${i}" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="0%" stop-color="${color}" stop-opacity="0.8" />
                            <stop offset="100%" stop-color="${color}" stop-opacity="0.1" />
                        </linearGradient>
                        <rect x="${x - barWidth/2}" y="${y}" width="${barWidth}" height="${Math.max(0, barH)}" fill="url(#barGrad${i})" stroke="${color}" stroke-width="2" rx="4" ry="4" filter="url(#loanGlow)" />
                    `;
                });
            } else if (currentLoanChartType === 'smooth') {
                if (chartData.length > 1) {
                    let dPath = `M ${getX(0)},${getY(chartData[0].balance)} `;
                    for(let i=0; i<chartData.length-1; i++) {
                        const x0 = getX(i), y0 = getY(chartData[i].balance);
                        const x1 = getX(i+1), y1 = getY(chartData[i+1].balance);
                        // Control points for cubic bezier (smooth horizontal ease)
                        const cp1x = x0 + (x1 - x0) / 2;
                        const cp2x = x1 - (x1 - x0) / 2;
                        dPath += `C ${cp1x},${y0} ${cp2x},${y1} ${x1},${y1} `;
                    }
                    svgElements += `<path d="${dPath}" fill="none" stroke="url(#loanMultiColorGrad)" stroke-width="4" filter="url(#loanGlow)" stroke-linecap="round" />`;
                }
            } else {
                // AREA CHART (Default)
                if (chartData.length > 1) {
                    let points = chartData.map((d, i) => `${getX(i)},${getY(d.balance)}`).join(' ');
                    svgElements += `<polygon points="${padX},${padY + innerH} ${points} ${getX(chartData.length-1)},${padY + innerH}" fill="url(#loanAreaMultiGrad)" />`;
                    svgElements += `<polyline points="${points}" fill="none" stroke="url(#loanMultiColorGrad)" stroke-width="4" filter="url(#loanGlow)" stroke-linecap="round" stroke-linejoin="round" />`;
                }
            }

            // --- RENDER MULTI-COLOR DATA POINTS & LABELS ---
            let circlesAndText = chartData.map((d, i) => {
                const x = getX(i);
                const y = getY(d.balance);
                const color = chartColors[i % chartColors.length];
                
                let valText = d.balance >= 1000000 
                    ? (d.balance / 1000000).toFixed(2) + 'M' 
                    : d.balance.toLocaleString('th-TH', {maximumFractionDigits: 0});

                return `
                    <circle cx="${x}" cy="${y}" r="6" fill="var(--color-bg)" stroke="${color}" stroke-width="3" />
                    <text x="${x}" y="${y - 18}" fill="${color}" font-family="Orbitron, sans-serif" font-weight="700" font-size="13" letter-spacing="1px" text-anchor="middle" style="text-shadow: 0 4px 10px rgba(0,0,0,0.8);">${valText}</text>
                    <text x="${x}" y="${height - padY + 28}" fill="#cbd5e1" font-family="Prompt, sans-serif" font-weight="400" font-size="13" letter-spacing="0.5px" text-anchor="middle">${d.label}</text>
                `;
            }).join('');

            svgElements += circlesAndText;

            let svgHtml = `
            <svg viewBox="0 0 ${width} ${height}" style="width:100%; height:auto; overflow:visible;">
                <defs>
                    <linearGradient id="loanMultiColorGrad" x1="0" y1="0" x2="1" y2="0">
                        <stop offset="0%" stop-color="var(--color-primary)" />
                        <stop offset="33%" stop-color="var(--color-success)" />
                        <stop offset="66%" stop-color="var(--color-warning)" />
                        <stop offset="100%" stop-color="var(--color-secondary)" />
                    </linearGradient>
                    <linearGradient id="loanAreaMultiGrad" x1="0" y1="0" x2="0" y2="1">
                        <stop offset="0%" stop-color="var(--color-secondary)" stop-opacity="0.5" />
                        <stop offset="50%" stop-color="var(--color-primary)" stop-opacity="0.1" />
                        <stop offset="100%" stop-color="var(--color-primary)" stop-opacity="0" />
                    </linearGradient>
                    <filter id="loanGlow" x="-20%" y="-20%" width="140%" height="140%">
                        <feGaussianBlur stdDeviation="6" result="blur" />
                        <feMerge>
                            <feMergeNode in="blur" />
                            <feMergeNode in="SourceGraphic" />
                        </feMerge>
                    </filter>
                </defs>
                <!-- Grid Lines -->
                <line x1="${padX}" y1="${padY}" x2="${width-padX}" y2="${padY}" stroke="rgba(255,255,255,0.1)" stroke-dasharray="4" />
                <line x1="${padX}" y1="${padY + innerH/2}" x2="${width-padX}" y2="${padY + innerH/2}" stroke="rgba(255,255,255,0.1)" stroke-dasharray="4" />
                <line x1="${padX}" y1="${padY + innerH}" x2="${width-padX}" y2="${padY + innerH}" stroke="rgba(255,255,255,0.3)" stroke-width="2" />
                
                ${svgElements}
            </svg>`;
            
            chartContainer.innerHTML = svgHtml;
        }

        function renderLoanTable(data) {
            const tbody = document.getElementById('loan-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 60px; color: #94a3b8; font-family: 'Prompt', sans-serif; font-size: 1.1rem; font-weight: 300; text-shadow: 0 0 8px rgba(255, 255, 255, 0.1);">${window.currentLang === 'th' ? 'ไม่พบข้อมูลเงินกู้ที่ตรงกับเงื่อนไข' : 'No loan data found matching the criteria.'}</td></tr>`;
                return;
            }

            data.forEach((item, index) => {
                const tr = document.createElement('tr');
                
                // Latest item gets a slight highlight
                if(index === 0) {
                    tr.style.background = 'rgba(0, 243, 255, 0.05)';
                    tr.style.borderLeft = '3px solid var(--color-primary)';
                }

                const fmt = (val) => val.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});

                tr.innerHTML = `
                    <td style="font-family: 'Prompt', sans-serif; font-weight: 500; color: #f8fafc; letter-spacing: 0.5px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);">${item.item}</td>
                    <td style="text-align: right; font-family: 'Orbitron', sans-serif; font-weight: 600; color: var(--color-success); letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(0,255,163,0.3);">${fmt(item.principal)}</td>
                    <td style="text-align: right; font-family: 'Orbitron', sans-serif; font-weight: 600; color: var(--color-warning); letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255,184,0,0.3);">${fmt(item.interestBase)}</td>
                    <td style="text-align: right; font-family: 'Orbitron', sans-serif; font-weight: 600; color: #fcd34d; letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(252,211,77,0.3);">${fmt(item.interestBank)}</td>
                    <td style="text-align: right; font-family: 'Orbitron', sans-serif; font-weight: 600; color: var(--color-danger); letter-spacing: 0.5px; text-shadow: 0 0 10px rgba(255,77,77,0.3);">${fmt(item.disbursed)}</td>
                    <td style="text-align: right; font-family: 'Orbitron', sans-serif; font-weight: 800; color: var(--color-primary); letter-spacing: 1px; text-shadow: 0 0 12px rgba(0,243,255,0.4);">${fmt(item.balance)}</td>
                    <td style="text-align: center; font-family: 'Prompt', sans-serif; font-weight: 400; color: #cbd5e1; text-shadow: 0 0 5px rgba(255, 255, 255, 0.15);">${item.month}</td>
                    <td style="text-align: center; font-family: 'Prompt', sans-serif; font-weight: 400; color: #cbd5e1; text-shadow: 0 0 5px rgba(255, 255, 255, 0.15);">${item.quarter}</td>
                    <td style="text-align: center; font-family: 'Orbitron', sans-serif; font-weight: 600; color: #f8fafc; letter-spacing: 1px; text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);">${item.year}</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // ==========================================
        // MODULE 7: MUTUAL AID FUND (เพื่อนช่วยเพื่อน)
        // ==========================================
        let mutualFundRawData = [];
        let isMutualFundFirstLoad = true;
        let mfChartInstances = {};

        // Chart Type State Variables
        let currentMfTrendChartType = 'line';
        let currentMfAreaChartType = 'pie';

        function changeMfTrendChart(type) {
            currentMfTrendChartType = type;
            document.querySelectorAll('#btn-mftrend-line, #btn-mftrend-bar, #btn-mftrend-area').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-mftrend-${type}`).classList.add('active');
            processAndRenderMutualFund(); 
        }

        function changeMfAreaChart(type) {
            currentMfAreaChartType = type;
            document.querySelectorAll('#btn-mfarea-pie, #btn-mfarea-column, #btn-mfarea-line').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-mfarea-${type}`).classList.add('active');
            processAndRenderMutualFund(); 
        }

        function resetMutualFundFilters() {
            document.getElementById('mf-filter-dept').value = 'all';
            document.getElementById('mf-filter-area').value = 'all';
            document.getElementById('mf-filter-status').value = 'all';
            processAndRenderMutualFund();
        }

        // Configure Chart.js Default styling to match NARUMON UI
        if (typeof Chart !== 'undefined') {
            Chart.defaults.color = 'rgba(255, 255, 255, 0.6)';
            Chart.defaults.font.family = "'Inter', 'Prompt', sans-serif";
            Chart.defaults.plugins.tooltip.backgroundColor = 'rgba(10, 15, 26, 0.9)';
            Chart.defaults.plugins.tooltip.titleColor = '#00f3ff';
            Chart.defaults.plugins.tooltip.padding = 12;
            Chart.defaults.plugins.tooltip.borderColor = 'rgba(0, 243, 255, 0.2)';
            Chart.defaults.plugins.tooltip.borderWidth = 1;
        }

        async function fetchMutualFundData() {
            if (mutualFundRawData.length > 0 && !isMutualFundFirstLoad) {
                processAndRenderMutualFund();
                return;
            }

            const sheetId = '1hpF_YkbGEUvNNYPa1AO9Cmsf7Y0MMUwh1SPI4i0T7_Q';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            
            try {
                document.getElementById('mf-table-body').innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 60px; color: var(--color-primary); font-weight: 600; font-family: var(--font-display); letter-spacing: 2px;">SYNCING DATA...</td></tr>';
                
                const response = await fetch(url);
                const text = await response.text();
                
                const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\);/);
                if (!match) throw new Error("Invalid response format from Google Sheets");
                
                const json = JSON.parse(match[1]);
                if (json.status === 'error') throw new Error(json.errors[0]?.message || 'Unknown error');

                const rows = json.table.rows;
                
                const parseAmt = (val) => {
                    if (!val) return 0;
                    if (typeof val === 'number') return val;
                    const parsed = parseFloat(String(val).replace(/,/g, '').trim());
                    return isNaN(parsed) ? 0 : parsed;
                };

                const col = (r, idx) => (r && r.c && r.c[idx]) ? r.c[idx].v : '';
                
                mutualFundRawData = rows.map((r, i) => {
                    const nameVal = String(col(r, 2)).trim(); // Col C
                    const deptVal = String(col(r, 3)).trim(); // Col D
                    const amtVal = parseAmt(col(r, 5));       // Col F
                    const areaVal = String(col(r, 9)).trim(); // Col J
                    
                    // Registration Date & Year Extraction (Assuming Col A / index 0)
                    const dateRaw = String(col(r, 0)?.f || col(r, 0) || '').trim();
                    let yearVal = 'N/A';
                    let yearMatch = dateRaw.match(/\b(20\d{2}|25\d{2})\b/);
                    if(yearMatch) yearVal = yearMatch[0];
                    else if(dateRaw) yearVal = 'Other';

                    // Status Check (Col H or I)
                    const hVal = String(col(r, 7)).trim();
                    const iVal = String(col(r, 8)).trim();
                    const isUsed1 = (hVal !== '' && hVal !== 'null');
                    const isUsed2 = (iVal !== '' && iVal !== 'null');
                    const isUsed = isUsed1 || isUsed2;

                    return {
                        id: i + 1,
                        name: nameVal,
                        dept: deptVal || 'Unassigned',
                        amount: amtVal,
                        area: areaVal || 'N/A',
                        dateRaw: dateRaw,
                        year: yearVal,
                        isUsed1: isUsed1,
                        isUsed2: isUsed2,
                        isUsed: isUsed
                    };
                }).filter(d => d.name !== '' && d.name !== 'null');

                if (isMutualFundFirstLoad) {
                    document.getElementById('mf-filter-dept').value = 'all';
                    document.getElementById('mf-filter-area').value = 'all';
                    document.getElementById('mf-filter-status').value = 'all';
                    isMutualFundFirstLoad = false;
                }

                populateMutualFundFilters();
                processAndRenderMutualFund();
            } catch (err) {
                console.error("Mutual Fund Fetch Error:", err);
                document.getElementById('mf-table-body').innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 60px; color: var(--color-danger); line-height: 1.6;">Failed to load data. Please check connection.<br><span style="font-size: 0.8rem; opacity: 0.7;">${err.message}</span></td></tr>`;
            }
        }

        function populateMutualFundFilters() {
            const depts = [...new Set(mutualFundRawData.map(d => d.dept))].filter(Boolean).sort();
            const areas = [...new Set(mutualFundRawData.map(d => d.area))].filter(Boolean).sort();

            const deptDropdown = document.getElementById('mf-filter-dept');
            const areaDropdown = document.getElementById('mf-filter-area');

            const currDept = deptDropdown.value;
            const currArea = areaDropdown.value;

            deptDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Departments)' : 'All Departments'}</option>`;
            depts.forEach(d => deptDropdown.innerHTML += `<option value="${d}">${d}</option>`);
            if(depts.includes(currDept)) deptDropdown.value = currDept;

            areaDropdown.innerHTML = `<option value="all">${window.currentLang === 'th' ? 'ทั้งหมด (All Areas)' : 'All Areas'}</option>`;
            areas.forEach(a => areaDropdown.innerHTML += `<option value="${a}">${a}</option>`);
            if(areas.includes(currArea)) areaDropdown.value = currArea;
        }

        function processAndRenderMutualFund() {
            const fDept = document.getElementById('mf-filter-dept').value;
            const fArea = document.getElementById('mf-filter-area').value;
            const fStatus = document.getElementById('mf-filter-status').value;

            const filteredData = mutualFundRawData.filter(d => {
                let matchDept = fDept === 'all' || d.dept === fDept;
                let matchArea = fArea === 'all' || d.area === fArea;
                let matchStatus = fStatus === 'all' || 
                                  (fStatus === 'used1' && d.isUsed1) || 
                                  (fStatus === 'used2' && d.isUsed2) || 
                                  (fStatus === 'not_used' && !d.isUsed);
                return matchDept && matchArea && matchStatus;
            });

            updateMutualFundKPIs(filteredData);
            renderMutualFundCharts(filteredData);
            renderMutualFundTopList(filteredData);
            renderMutualFundAlerts(filteredData);
            renderMutualFundTable(filteredData);
        }

        function updateMutualFundKPIs(data) {
            // 1. Total (Unique Names)
            const uniqueNames = new Set(data.map(d => d.name));
            const totalMembers = uniqueNames.size;
            
            // 2. Amount
            const totalAmount = data.reduce((sum, d) => sum + d.amount, 0);
            
            // 3. Depts
            const totalDepts = new Set(data.map(d => d.dept)).size;
            
            // 4. Areas
            const totalAreas = new Set(data.map(d => d.area)).size;
            
            // 5. Status & Comparison
            const usedCount = data.filter(d => d.isUsed).length;
            const used1Count = data.filter(d => d.isUsed1).length;
            const used2Count = data.filter(d => d.isUsed2).length;
            
            // Extra: Avg Contrib & New Members Latest Year
            const avgContrib = totalMembers > 0 ? (totalAmount / totalMembers) : 0;
            
            animateValue('mf-kpi-total', 0, totalMembers, 800);
            animateValue('mf-kpi-amount', 0, totalAmount, 800);
            animateValue('mf-kpi-depts', 0, totalDepts, 800);
            animateValue('mf-kpi-areas', 0, totalAreas, 800);

            // Update Comparison Blocks
            animateValue('mf-kpi-used1', 0, used1Count, 800);
            animateValue('mf-kpi-used2', 0, used2Count, 800);
            
            document.getElementById('mf-kpi-avg-contrib').innerHTML = `${avgContrib.toLocaleString(undefined, {maximumFractionDigits:0})} <span style="font-size: 1.5rem">฿</span>`;
        }

        function mfCreateOrUpdateChart(chartId, type, data, options) {
            if(!document.getElementById(chartId)) return;
            const ctx = document.getElementById(chartId).getContext('2d');
            if (mfChartInstances[chartId]) mfChartInstances[chartId].destroy();
            mfChartInstances[chartId] = new Chart(ctx, { type, data, options });
        }

        function renderMutualFundCharts(data) {
            if(typeof Chart === 'undefined') return;

            // --- 1. Registration Trend Chart (Line/Bar/Area) ---
            const yearCounts = {};
            data.forEach(d => {
                if(d.year !== 'N/A' && d.year !== 'Other') {
                    yearCounts[d.year] = (yearCounts[d.year] || 0) + 1;
                }
            });
            const sortedYears = Object.keys(yearCounts).sort();
            
            let trendType = currentMfTrendChartType === 'area' ? 'line' : currentMfTrendChartType; 
            let trendFill = currentMfTrendChartType === 'area';

            const trendCanvas = document.getElementById('mf-trendChart');
            const trendCtx = trendCanvas ? trendCanvas.getContext('2d') : null;
            let trendBgColor = 'rgba(0, 243, 255, 0.15)';
            let trendBorderColor = '#00f3ff';
            
            if (trendCtx) {
                // เพิ่มคลาสแอนิเมชันให้กราฟเปลี่ยนสีตลอดเวลา (RGB Flow)
                trendCanvas.classList.add('chart-flow-colors');

                // สร้างเส้นกราฟแบบไล่สีหลายๆ สีแนวนอน
                const cWidth = trendCanvas.width || 600;
                trendBorderColor = trendCtx.createLinearGradient(0, 0, cWidth, 0);
                trendBorderColor.addColorStop(0, '#00f3ff');
                trendBorderColor.addColorStop(0.25, '#bc13fe');
                trendBorderColor.addColorStop(0.5, '#ffb800');
                trendBorderColor.addColorStop(0.75, '#00ffa3');
                trendBorderColor.addColorStop(1, '#00f3ff');

                if (trendType === 'bar') {
                    // ไล่สีสำหรับกราฟแท่ง
                    trendBgColor = trendCtx.createLinearGradient(0, 0, 0, 300);
                    trendBgColor.addColorStop(0, 'rgba(0, 243, 255, 0.9)');
                    trendBgColor.addColorStop(0.5, 'rgba(188, 19, 254, 0.5)');
                    trendBgColor.addColorStop(1, 'rgba(0, 255, 163, 0.2)');
                } else {
                    // ไล่สีสำหรับกราฟ Area (บนลงล่าง ให้โปร่งแสง)
                    trendBgColor = trendCtx.createLinearGradient(0, 0, 0, 300);
                    trendBgColor.addColorStop(0, 'rgba(0, 243, 255, 0.5)');
                    trendBgColor.addColorStop(0.5, 'rgba(188, 19, 254, 0.3)');
                    trendBgColor.addColorStop(1, 'rgba(0, 243, 255, 0.0)');
                }
            }

            mfCreateOrUpdateChart('mf-trendChart', trendType, {
                labels: sortedYears,
                datasets: [{
                    label: window.currentLang === 'th' ? 'สมาชิกใหม่' : 'New Members',
                    data: sortedYears.map(y => yearCounts[y]),
                    borderColor: trendBorderColor,
                    backgroundColor: trendBgColor,
                    borderWidth: trendType === 'bar' ? 0 : 4,
                    borderRadius: trendType === 'bar' ? 6 : 0,
                    fill: trendFill,
                    tension: 0.4,
                    pointBackgroundColor: '#fff',
                    pointBorderColor: trendBorderColor,
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 8,
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#00f3ff'
                }]
            }, {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, beginAtZero: true, ticks: { precision: 0 } }
                }
            });

            // --- 2. Area Distribution Chart (Pie/Column/Line) ---
            const areaCounts = {};
            data.forEach(d => { areaCounts[d.area] = (areaCounts[d.area] || 0) + 1; });
            const areaLabels = Object.keys(areaCounts);
            const areaData = Object.values(areaCounts);

            let areaType = currentMfAreaChartType === 'pie' ? 'doughnut' : (currentMfAreaChartType === 'column' ? 'bar' : 'line');
            let areaOptions = { responsive: true, maintainAspectRatio: false };
            
            // เพิ่ม Class แอนิเมชันให้กราฟ Area
            const areaCanvas = document.getElementById('mf-areaPieChart');
            if (areaCanvas) areaCanvas.classList.add('chart-flow-colors');
            
            let areaBgColor = 'rgba(0, 243, 255, 0.6)';
            let areaBorderColor = '#00f3ff';

            if (areaType === 'doughnut') {
                areaOptions.cutout = '75%';
                areaOptions.plugins = { legend: { position: 'right', labels: { color: 'rgba(255,255,255,0.7)', font: { size: 11, family: 'Prompt' }, usePointStyle: true, padding: 15 } } };
                areaOptions.scales = { x: { display: false }, y: { display: false } };
                areaBgColor = [
                    '#00f3ff', '#bc13fe', '#00ffa3', '#ffb800', '#ff4d4d', 
                    '#38bdf8', '#818cf8', '#facc15', '#4ade80', '#fb923c'
                ];
                areaBorderColor = 'transparent';
            } else {
                areaOptions.plugins = { legend: { display: false } };
                areaOptions.scales = {
                    x: { grid: { display: false }, ticks: { font: { size: 10, family: 'Prompt' }, color: 'rgba(255,255,255,0.6)' } },
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, beginAtZero: true, ticks: { precision: 0, color: 'rgba(255,255,255,0.6)' } }
                };
                if(areaCanvas) {
                    const ctx = areaCanvas.getContext('2d');
                    areaBgColor = ctx.createLinearGradient(0, 0, 0, 300);
                    areaBgColor.addColorStop(0, 'rgba(0, 243, 255, 0.8)');
                    areaBgColor.addColorStop(1, 'rgba(188, 19, 254, 0.2)');
                    areaBorderColor = '#00f3ff';
                }
            }

            mfCreateOrUpdateChart('mf-areaPieChart', areaType, {
                labels: areaLabels,
                datasets: [{
                    label: window.currentLang === 'th' ? 'จำนวนสมาชิก' : 'Members',
                    data: areaData,
                    backgroundColor: areaBgColor,
                    borderColor: areaBorderColor,
                    borderWidth: areaType === 'doughnut' ? 0 : 2,
                    fill: areaType === 'line' ? false : true,
                    tension: 0.4
                }]
            }, areaOptions);

            // --- 3. Department Bar Chart ---
            const deptCounts = {};
            data.forEach(d => { deptCounts[d.dept] = (deptCounts[d.dept] || 0) + 1; });
            const sortedDeptEntries = Object.entries(deptCounts).sort((a, b) => b[1] - a[1]).slice(0, 10); // Top 10 for clean chart
            
            // เพิ่ม Class แอนิเมชันให้กราฟ Department
            const deptCanvas = document.getElementById('mf-deptBarChart');
            if (deptCanvas) deptCanvas.classList.add('chart-flow-colors');

            let deptBgColor = 'rgba(188, 19, 254, 0.7)';
            if(deptCanvas) {
                const ctx = deptCanvas.getContext('2d');
                // ไล่สีแนวทแยงเพื่อให้แท่งกราฟดูมีมิติมากขึ้น
                deptBgColor = ctx.createLinearGradient(0, 0, 400, 0); 
                deptBgColor.addColorStop(0, 'rgba(188, 19, 254, 0.9)');
                deptBgColor.addColorStop(0.5, 'rgba(0, 243, 255, 0.8)');
                deptBgColor.addColorStop(1, 'rgba(0, 255, 163, 0.8)');
            }

            mfCreateOrUpdateChart('mf-deptBarChart', 'bar', {
                labels: sortedDeptEntries.map(e => e[0].length > 15 ? e[0].substring(0,15)+'...' : e[0]),
                datasets: [{
                    label: window.currentLang === 'th' ? 'จำนวนสมาชิก' : 'Members',
                    data: sortedDeptEntries.map(e => e[1]),
                    backgroundColor: deptBgColor,
                    borderColor: 'transparent',
                    borderWidth: 0,
                    borderRadius: 6
                }]
            }, {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { grid: { display: false }, ticks: { font: { size: 10, family: 'Prompt' }, color: 'rgba(255,255,255,0.6)', maxRotation: 45, minRotation: 45 } },
                    y: { grid: { color: 'rgba(255,255,255,0.05)' }, beginAtZero: true, ticks: { precision: 0, color: 'rgba(255,255,255,0.6)' } }
                }
            });
        }

        function renderMutualFundTopList(data) {
            const deptCounts = {};
            data.forEach(d => { deptCounts[d.dept] = (deptCounts[d.dept] || 0) + 1; });

            const sortedDepts = Object.entries(deptCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);

            const ul = document.getElementById('mf-top-dept-list');
            const unitText = window.currentLang === 'th' ? 'คน' : 'Pax';
            ul.innerHTML = sortedDepts.map((item, idx) => `
                <li>
                    <div style="display: flex; align-items: center;">
                        <span class="top-rank">${idx + 1}</span>
                        <span class="top-name">${item[0]}</span>
                    </div>
                    <span class="top-value">${item[1]} <span style="font-size: 0.7rem; font-family: var(--font-main); color: var(--color-text-muted); font-weight: normal;">${unitText}</span></span>
                </li>
            `).join('');
            
            if(sortedDepts.length === 0) ul.innerHTML = `<li style="color: rgba(255,255,255,0.4); justify-content: center; padding: 20px;">${window.currentLang === 'th' ? 'ไม่มีข้อมูล' : 'No Data Available'}</li>`;
        }

        function renderMutualFundAlerts(data) {
            const container = document.getElementById('mf-alert-container');
            const titleEl = document.getElementById('mf-alert-title');
            let alertsHtml = '';
            
            const recentUses = data.filter(d => d.isUsed);
            
            if (titleEl) {
                const titleText = window.currentLang === 'th' ? 'คนที่ใช้สิทธิ์แล้ว' : 'Exercised';
                titleEl.innerHTML = `🔔 Recent Activity <span style="font-size: 0.8rem; color: var(--color-success); font-weight: 600; margin-left: 8px; padding: 2px 8px; background: rgba(0,255,163,0.1); border-radius: 12px; border: 1px solid rgba(0,255,163,0.3);">(${titleText} ${recentUses.length})</span>`;
            }
            
            if (recentUses.length > 0) {
                recentUses.forEach(d => {
                    let alertBadge = window.currentLang === 'th' ? 'ใช้สิทธิ์แล้ว' : 'Exercised';
                    if(d.isUsed1 && d.isUsed2) alertBadge = window.currentLang === 'th' ? 'ครั้งที่ 1, 2' : 'Time 1, 2';
                    else if(d.isUsed2) alertBadge = window.currentLang === 'th' ? 'ครั้งที่ 2' : 'Time 2';
                    else if(d.isUsed1) alertBadge = window.currentLang === 'th' ? 'ครั้งที่ 1' : 'Time 1';

                    alertsHtml += `
                        <div class="mf-alert-item mf-alert-used">
                            <div>
                                <div style="font-size: 0.9rem; font-weight: 600; color: #fff; font-family: var(--font-main);">${d.name}</div>
                                <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px;">📂 ${d.dept} | 📍 ${d.area}</div>
                            </div>
                            <span class="badge-neon badge-neon-completed" style="font-size: 0.65rem; padding: 4px 10px; min-width: auto; letter-spacing: 0;">${alertBadge}</span>
                        </div>
                    `;
                });
            } else {
                const statusTitle = window.currentLang === 'th' ? 'สถานะระบบ' : 'System Status';
                const statusDesc = window.currentLang === 'th' ? 'ไม่มีข้อมูลพนักงานที่ใช้สิทธิ์ในฟิลเตอร์นี้' : 'No employee records found for exercised rights in this filter.';
                alertsHtml += `
                    <div class="mf-alert-item" style="border-color: var(--color-warning);">
                        <div>
                            <div style="font-size: 0.9rem; font-weight: 600; color: #fff;">${statusTitle}</div>
                            <div style="font-size: 0.75rem; color: var(--color-text-muted); margin-top: 4px;">${statusDesc}</div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = alertsHtml;
        }

        function renderMutualFundTable(data) {
            const tbody = document.getElementById('mf-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 60px; color: rgba(255,255,255,0.4); font-family: var(--font-main);">${window.currentLang === 'th' ? 'ไม่พบข้อมูลที่ตรงกับเงื่อนไข' : 'No data found matching the criteria.'}</td></tr>`;
                return;
            }

            data.forEach((item, index) => {
                const tr = document.createElement('tr');
                
                let badgeText = window.currentLang === 'th' ? '✔ ใช้สิทธิ์แล้ว' : '✔ Exercised';
                if(item.isUsed1 && item.isUsed2) badgeText = window.currentLang === 'th' ? '✔ ครั้งที่ 1, 2' : '✔ Time 1, 2';
                else if(item.isUsed2) badgeText = window.currentLang === 'th' ? '✔ ครั้งที่ 2' : '✔ Time 2';
                else if(item.isUsed1) badgeText = window.currentLang === 'th' ? '✔ ครั้งที่ 1' : '✔ Time 1';

                let badgeHtml = item.isUsed 
                    ? `<span class="badge-neon badge-neon-completed" style="min-width: 100px; justify-content: center;">${badgeText}</span>`
                    : `<span class="badge-neon" style="color: var(--color-text-muted); border: 1px solid rgba(255,255,255,0.2); min-width: 100px; justify-content: center; background: transparent;">${window.currentLang === 'th' ? 'ยังไม่ใช้สิทธิ์' : 'Not Used'}</span>`;
                
                let rowClass = item.isUsed ? 'style="background: rgba(0,255,163,0.03);"' : '';

                tr.innerHTML = `
                    <td style="text-align: center; color: rgba(255,255,255,0.5); font-family: monospace;">${item.id}</td>
                    <td style="font-weight: 500; color: #f8fafc;">${item.name}</td>
                    <td style="color: rgba(255,255,255,0.7);">${item.dept}</td>
                    <td style="color: rgba(255,255,255,0.7);">${item.area}</td>
                    <td style="text-align: center; color: rgba(255,255,255,0.7); font-family: 'Prompt';">${item.dateRaw || '-'}</td>
                    <td style="text-align: right; color: var(--color-primary); font-family: var(--font-display); font-weight: 600; text-shadow: 0 0 10px rgba(0,243,255,0.3);">${item.amount.toLocaleString()}</td>
                    <td style="text-align: center;">${badgeHtml}</td>
                `;
                if(rowClass) tr.setAttribute('style', 'background: rgba(0,255,163,0.03);');
                tbody.appendChild(tr);
            });
        }

        // ===== START WELFARE UPDATE (JS LOGIC) =====
        let welfare_rawData = [];
        let welfare_isFirstLoad = true;
        let welfare_chartInstances = {};
        let welfare_currentDivision = 'all'; // เก็บค่า Division จากปุ่ม
        let currentEwTrendChartType = 'line'; // เก็บรูปแบบกราฟ Trend ปัจจุบัน

        function changeEwTrendChart(type) {
            currentEwTrendChartType = type;
            document.querySelectorAll('#btn-ewtrend-line, #btn-ewtrend-bar, #btn-ewtrend-area').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.getElementById(`btn-ewtrend-${type}`);
            if(activeBtn) activeBtn.classList.add('active');
            welfare_processAndRender();
        }

        async function welfare_fetchData() {
            if (welfare_rawData.length > 0 && !welfare_isFirstLoad) {
                welfare_processAndRender();
                return;
            }

            const sheetId = '1RxK5-yKujw4AXxBYYjXiNc3naNqEUWpvOA08YlG7dDc';
            const sheetName = 'Data';
            const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
            
            try {
                const tbody = document.getElementById('ew-table-body');
                if(tbody) tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-primary); font-weight: 600; font-family: var(--font-display); letter-spacing: 2px;">FETCHING WELFARE DATA...</td></tr>';
                
                const response = await fetch(url);
                const text = await response.text();
                
                const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S]*)\);/);
                if (!match) throw new Error("Invalid response format from Google Sheets");
                
                const json = JSON.parse(match[1]);
                if (json.status === 'error') throw new Error(json.errors[0]?.message || 'Unknown error');

                const rows = json.table.rows;
                
                const parseAmt = (val) => {
                    if (val === null || val === undefined || val === '') return 0;
                    if (typeof val === 'number') return val;
                    const parsed = parseFloat(String(val).replace(/,/g, '').trim());
                    return isNaN(parsed) ? 0 : parsed;
                };

                const col = (r, idx) => (r && r.c && r.c[idx]) ? r.c[idx].v : '';
                
                welfare_rawData = rows.map((r, i) => {
                    return {
                        id: i + 1,
                        empId: String(col(r, 0)).trim(),
                        empName: String(col(r, 1)).trim(),
                        dept: String(col(r, 2)).trim() || 'Unassigned',
                        benefitType: String(col(r, 3)).trim() || 'Unknown',
                        amount: parseAmt(col(r, 4)),
                        useDate: col(r, 5) ? String(col(r, 5)).trim() : '-',
                        area: String(col(r, 6)).trim(),
                        quarter: String(col(r, 7)).trim() || '-',
                        division: String(col(r, 8)).trim() || 'Unassigned'
                    };
                }).filter(d => d.empId !== '' && d.empId !== 'null');

                if (welfare_isFirstLoad) {
                    welfare_isFirstLoad = false;
                }

                welfare_populateFilters();
                welfare_processAndRender();
            } catch (err) {
                console.error("Welfare Fetch Error:", err);
                const tbody = document.getElementById('ew-table-body');
                if(tbody) tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 60px; color: var(--color-danger); line-height: 1.6;">Failed to load data. Please check connection.<br><span style="font-size: 0.8rem; opacity: 0.7;">${err.message}</span></td></tr>`;
            }
        }

        // ฟังก์ชันจัดการคลิกปุ่ม Tab
        function welfare_setDivision(divName) {
            if (welfare_currentDivision === divName) return; // ป้องกันการกดซ้ำเมื่ออยู่ที่เดิม
            
            welfare_currentDivision = divName;
            
            // รีเซ็ตสไตล์ปุ่มทั้งหมด (เปลี่ยน UI ทันทีไม่รอโหลด)
            ['welfare-tab-all', 'welfare-tab-mgmt', 'welfare-tab-prod'].forEach(id => {
                const btn = document.getElementById(id);
                if(btn) {
                    btn.style.background = 'transparent';
                    btn.style.borderColor = 'rgba(255, 255, 255, 0.1)';
                    btn.style.color = 'rgba(255, 255, 255, 0.6)';
                }
            });

            // แอคทีฟปุ่มที่ถูกคลิก
            let activeId = 'welfare-tab-all';
            if(divName === 'Management Staff') activeId = 'welfare-tab-mgmt';
            if(divName === 'Production Staff') activeId = 'welfare-tab-prod';

            const activeBtn = document.getElementById(activeId);
            if(activeBtn) {
                activeBtn.style.background = 'rgba(0, 243, 255, 0.1)';
                activeBtn.style.borderColor = 'rgba(0, 243, 255, 0.4)';
                activeBtn.style.color = 'var(--color-primary)';
            }

            // เรียกประมวลผล (ซึ่งตอนนี้มีระบบ Fade ป้องกันอาการหน่วงแล้ว)
            welfare_processAndRender();
        }

        function welfare_populateFilters() {
            // เอา Divisions ออกจาก dropdown เพราะใช้ Tab Buttons แทน
            const qs = [...new Set(welfare_rawData.map(d => d.quarter))].filter(Boolean).sort();
            const depts = [...new Set(welfare_rawData.map(d => d.dept))].filter(Boolean).sort();
            const types = [...new Set(welfare_rawData.map(d => d.benefitType))].filter(Boolean).sort();

            const setDropdown = (id, options, defaultLabel) => {
                const el = document.getElementById(id);
                if(!el) return;
                const currVal = el.value;
                el.innerHTML = `<option value="all">${window.currentLang === 'th' ? `ทั้งหมด (${defaultLabel})` : `All (${defaultLabel})`}</option>`;
                options.forEach(opt => {
                    if (opt !== '-' && opt !== 'Unassigned' && opt !== 'Unknown') {
                        el.innerHTML += `<option value="${opt}">${opt}</option>`;
                    }
                });
                if (options.includes(currVal)) el.value = currVal;
            };

            setDropdown('ew-filter-quarter', qs, 'Quarters');
            setDropdown('ew-filter-dept', depts, 'Departments');
            setDropdown('ew-filter-type', types, 'Benefit Types');
        }

        function welfare_processAndRender() {
            const fQ = document.getElementById('ew-filter-quarter').value;
            const fDept = document.getElementById('ew-filter-dept').value;
            const fType = document.getElementById('ew-filter-type').value;
            const fDiv = welfare_currentDivision; // รับค่าจาก State ของปุ่ม

            // --- 1. SMOOTH FADE TRANSITION ---
            // เฟดข้อมูลออกก่อนเพื่อให้ไม่บล็อก UI และปุ่มเปลี่ยนสีได้ทันที
            const elementsToFade = [
                document.querySelector('#employee-welfare-dashboard-page .kpi-row'),
                document.querySelector('#employee-welfare-dashboard-page .dash-row-1'),
                document.querySelector('#employee-welfare-dashboard-page .dash-row-3'),
                document.querySelector('#employee-welfare-dashboard-page .benefit-table-wrap')
            ];

            elementsToFade.forEach(el => {
                if(el) {
                    el.style.transition = 'opacity 0.2s ease, transform 0.2s ease';
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(10px)';
                }
            });

            // --- 2. ASYNC PROCESSING ---
            // ปล่อยให้ Browser ขยับแอนิเมชันปุ่มและ Fade ไปก่อน 150ms แล้วค่อยคำนวณกราฟ
            setTimeout(() => {
                const welfare_filteredData = welfare_rawData.filter(d => {
                    return (fQ === 'all' || d.quarter === fQ) &&
                           (fDiv === 'all' || d.division === fDiv) &&
                           (fDept === 'all' || d.dept === fDept) &&
                           (fType === 'all' || d.benefitType === fType);
                });

                welfare_updateKPIs(welfare_filteredData);
                welfare_renderCharts(welfare_filteredData);
                welfare_renderTable(welfare_filteredData);

                // --- 3. FADE IN ---
                // เฟดข้อมูลกลับเข้ามา
                elementsToFade.forEach(el => {
                    if(el) {
                        el.style.opacity = '1';
                        el.style.transform = 'translateY(0)';
                    }
                });
            }, 150);
        }

        function welfare_updateKPIs(data) {
            const uniqueEmps = new Set(data.map(d => d.empId)).size;
            const totalAmount = data.reduce((sum, d) => sum + d.amount, 0);
            const avgPerPerson = uniqueEmps > 0 ? (totalAmount / uniqueEmps) : 0;
            const uniqueTypes = new Set(data.map(d => d.benefitType)).size;

            animateValue('ew-kpi-emp', 0, uniqueEmps, 800);
            animateCurrency('ew-kpi-amount', totalAmount);
            animateCurrency('ew-kpi-avg', avgPerPerson);
            animateValue('ew-kpi-types', 0, uniqueTypes, 800);
        }

        function welfare_createChart(chartId, type, data, options) {
            if(typeof Chart === 'undefined') return;
            const canvas = document.getElementById(chartId);
            if(!canvas) return;
            const ctx = canvas.getContext('2d');
            if (welfare_chartInstances[chartId]) welfare_chartInstances[chartId].destroy();
            welfare_chartInstances[chartId] = new Chart(ctx, { type, data, options });
        }

        function welfare_renderCharts(data) {
            if(data.length === 0) {
                ['welfare_chart_donut', 'welfare_chart_bar', 'welfare_chart_line'].forEach(id => {
                    if(welfare_chartInstances[id]) {
                        welfare_chartInstances[id].destroy();
                        delete welfare_chartInstances[id];
                    }
                });
                return;
            }

            const chartColors = ['#00f3ff', '#bc13fe', '#00ffa3', '#ffb800', '#ff4d4d', '#38bdf8', '#818cf8', '#facc15', '#4ade80', '#fb923c'];

            // 1. Donut Chart (Proportion by BenefitType)
            const typeSums = {};
            data.forEach(d => { typeSums[d.benefitType] = (typeSums[d.benefitType] || 0) + d.amount; });
            const typeLabels = Object.keys(typeSums);
            const typeData = Object.values(typeSums);

            welfare_createChart('welfare_chart_donut', 'doughnut', {
                labels: typeLabels,
                datasets: [{
                    data: typeData,
                    backgroundColor: chartColors,
                    borderWidth: 0
                }]
            }, {
                responsive: true, maintainAspectRatio: false, cutout: '70%',
                plugins: { legend: { position: 'right', labels: { color: 'rgba(255,255,255,0.7)', font: { size: 11, family: 'Prompt' }, usePointStyle: true } } }
            });

            // 2. Bar Chart (Amount by Department)
            const deptSums = {};
            data.forEach(d => { deptSums[d.dept] = (deptSums[d.dept] || 0) + d.amount; });
            const sortedDepts = Object.entries(deptSums).sort((a, b) => b[1] - a[1]).slice(0, 10); // Top 10
            
            const barCanvas = document.getElementById('welfare_chart_bar');
            let barBg = 'rgba(0, 243, 255, 0.8)';
            if (barCanvas) {
                const ctx = barCanvas.getContext('2d');
                barBg = ctx.createLinearGradient(0, 0, 0, 300);
                barBg.addColorStop(0, 'rgba(0, 243, 255, 0.9)');
                barBg.addColorStop(1, 'rgba(188, 19, 254, 0.2)');
            }

            welfare_createChart('welfare_chart_bar', 'bar', {
                labels: sortedDepts.map(e => e[0].length > 15 ? e[0].substring(0,15)+'...' : e[0]),
                datasets: [{
                    label: window.currentLang === 'th' ? 'ยอดเบิกจ่าย (THB)' : 'Amount (THB)',
                    data: sortedDepts.map(e => e[1]),
                    backgroundColor: barBg,
                    borderRadius: 4
                }]
            }, {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { ticks: { color: 'rgba(255,255,255,0.6)', font: { family: 'Prompt' } }, grid: { display: false } },
                    y: { ticks: { color: 'rgba(255,255,255,0.6)' }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
            });

            // 3. Line Chart (Trend by Use Date)
            const dateSums = {};
            data.forEach(d => {
                if (d.useDate !== '-') {
                    dateSums[d.useDate] = (dateSums[d.useDate] || 0) + d.amount;
                }
            });
            const sortedDates = Object.keys(dateSums).sort((a, b) => {
                const ma = MONTH_ORDER[a.trim()] || 99;
                const mb = MONTH_ORDER[b.trim()] || 99;
                if (ma === 99 && mb === 99) return a.localeCompare(b); // กันเหนียวกรณีเป็นข้อความที่ไม่ได้ระบุในเดือน
                return ma - mb;
            });

            const lineCanvas = document.getElementById('welfare_chart_line');
            let trendBg = 'rgba(0, 255, 163, 0.2)';
            let trendBorderColor = '#00ffa3';
            let actualChartType = currentEwTrendChartType === 'area' ? 'line' : currentEwTrendChartType;
            let fillConfig = currentEwTrendChartType === 'area';
            let borderWidth = currentEwTrendChartType === 'bar' ? 0 : 3;
            let borderRadius = currentEwTrendChartType === 'bar' ? 6 : 0;

            if (lineCanvas) {
                const ctx = lineCanvas.getContext('2d');
                lineCanvas.classList.add('chart-flow-colors'); // เพิ่มแอนิเมชันสีวิ่ง
                
                if (currentEwTrendChartType === 'bar') {
                    trendBg = ctx.createLinearGradient(0, 0, 0, 300);
                    trendBg.addColorStop(0, 'rgba(0, 255, 163, 0.9)');
                    trendBg.addColorStop(1, 'rgba(0, 243, 255, 0.2)');
                    trendBorderColor = 'transparent';
                } else if (currentEwTrendChartType === 'area') {
                    trendBg = ctx.createLinearGradient(0, 0, 0, 300);
                    trendBg.addColorStop(0, 'rgba(0, 255, 163, 0.5)');
                    trendBg.addColorStop(1, 'rgba(0, 255, 163, 0.0)');
                } else {
                    trendBg = 'transparent'; // Line ธรรมดาพื้นหลังใส
                }
            }

            welfare_createChart('welfare_chart_line', actualChartType, {
                labels: sortedDates,
                datasets: [{
                    label: window.currentLang === 'th' ? 'ยอดเบิกจ่ายตามวัน (THB)' : 'Amount by Date (THB)',
                    data: sortedDates.map(date => dateSums[date]),
                    borderColor: trendBorderColor,
                    backgroundColor: trendBg,
                    borderWidth: borderWidth,
                    borderRadius: borderRadius,
                    fill: fillConfig,
                    tension: 0.4, // ทำให้กราฟเส้น/area โค้งมน
                    pointBackgroundColor: '#fff',
                    pointBorderColor: '#00ffa3',
                    pointRadius: currentEwTrendChartType === 'bar' ? 0 : 4,
                    pointHoverRadius: currentEwTrendChartType === 'bar' ? 0 : 6
                }]
            }, {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    x: { ticks: { color: 'rgba(255,255,255,0.6)', font: { family: 'Prompt' }, maxTicksLimit: 15 }, grid: { display: false } },
                    y: { ticks: { color: 'rgba(255,255,255,0.6)' }, grid: { color: 'rgba(255,255,255,0.05)' }, beginAtZero: true }
                }
            });
        }

        function welfare_renderTable(data) {
            const tbody = document.getElementById('ew-table-body');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="6" style="text-align: center; padding: 60px; color: rgba(255,255,255,0.4); font-family: var(--font-main);">${window.currentLang === 'th' ? 'ไม่พบข้อมูลที่ตรงกับเงื่อนไข' : 'No data found matching the criteria.'}</td></tr>`;
                return;
            }

            const fmt = (val) => val.toLocaleString('th-TH', {minimumFractionDigits: 2, maximumFractionDigits: 2});

            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="text-align: center; color: rgba(255,255,255,0.5); font-family: monospace;">${item.empId}</td>
                    <td style="font-weight: 500; color: #f8fafc;">${item.empName}</td>
                    <td style="color: rgba(255,255,255,0.7);">${item.dept}</td>
                    <td style="color: var(--color-primary); font-weight: 500;">${item.benefitType}</td>
                    <td style="text-align: right; font-family: var(--font-display); font-weight: 600; text-shadow: 0 0 10px rgba(0,243,255,0.2);">${fmt(item.amount)}</td>
                    <td style="text-align: center; color: rgba(255,255,255,0.7);">${item.useDate}</td>
                `;
                tbody.appendChild(tr);
            });
        }
        // ===== END WELFARE UPDATE (JS LOGIC) =====

        // ==========================================
        // INITIALIZATION
        // ==========================================
        window.onload = () => {
            ThemeSystem.init();
            applyLanguage();
            showPage('home');
        };
    </script>
</body>
</html>